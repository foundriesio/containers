(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2123],{"./public/app/plugins/datasource/prometheus/add_label_to_query.ts":(e,t,s)=>{"use strict";s.d(t,{F:()=>n});var r=s("./.yarn/__virtual__/lezer-promql-virtual-eaf88aa77a/3/opt/drone/yarncache/lezer-promql-npm-0.22.0-867da6afaa-cdce054700.zip/node_modules/lezer-promql/index.es.js"),i=s("./public/app/plugins/datasource/prometheus/querybuilder/PromQueryModeller.ts"),a=s("./public/app/plugins/datasource/prometheus/querybuilder/parsing.ts");function n(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"=";if(!t||!s)throw new Error("Need label to add to query.");const i=o(e);if(!i.length)return e;const a=l(t,s,r);return u(e,i,a)}function o(e){const t=r.E2.parse(e),s=[];return t.iterate({enter:(t,r,i,n)=>{if("VectorSelector"===t.name){const t=(0,a._)(e.substring(r,i));return s.push({query:t.query,from:r,to:i}),!1}}}),s}function l(e,t,s){return{label:e,op:s,value:t===1/0?"+Inf":t.toString()}}function u(e,t,s){const r=new i.K;let a="",n=0;for(let i=0;i<t.length;i++){const o=t[i],l=i===t.length-1,u=e.substring(n,o.from),h=l?e.substring(o.to):"";c(o.query.labels,s)||o.query.labels.push(s);a+=u+r.renderQuery(o.query)+h,n=o.to}return a}function c(e,t){return e.find((e=>e.label===t.label&&e.value===t.value))}},"./public/app/plugins/datasource/prometheus/datasource.tsx":(e,t,s)=>{"use strict";s.d(t,{cf:()=>Y,vQ:()=>J});var r=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),i=s("../../opt/drone/yarncache/lru-cache-npm-7.7.1-726274dc4d-f362c5a2cf.zip/node_modules/lru-cache/index.js"),a=s.n(i),n=(s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js")),o=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),l=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/util/pipe.js"),u=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/merge.js"),c=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js"),h=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),d=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),p=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/tap.js"),f=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/filter.js"),m=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),g=s("./packages/grafana-data/src/index.ts"),y=s("./packages/grafana-runtime/src/index.ts"),b=s("./packages/grafana-ui/src/index.ts"),O=s("./public/app/core/utils/explore.ts"),v=s("./public/app/features/alerting/unified/api/buildInfo.ts"),x=s("./public/app/features/dashboard/services/TimeSrv.ts"),_=s("./public/app/features/templating/template_srv.ts"),$=s("./public/app/types/unified-alerting-dto.ts"),k=s("./public/app/plugins/datasource/prometheus/add_label_to_query.ts"),w=s("./public/app/plugins/datasource/prometheus/language_provider.ts"),S=s("./public/app/plugins/datasource/prometheus/language_utils.ts"),P=s("./public/app/plugins/datasource/prometheus/legend.ts");class T{constructor(e,t){var s,r,i;i=void 0,(r="range")in(s=this)?Object.defineProperty(s,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[r]=i,this.datasource=e,this.query=t,this.datasource=e,this.query=t,this.datasource=e,this.query=t,this.range=(0,x.$t)().timeRange()}process(){if(this.query.match(/^label_names\(\)\s*$/))return this.labelNamesQuery();const e=this.query.match(/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/);if(e)return e[1]?this.labelValuesQuery(e[2],e[1]):this.labelValuesQuery(e[2]);const t=this.query.match(/^metrics\((.+)\)\s*$/);if(t)return this.metricNameQuery(t[1]);const s=this.query.match(/^query_result\((.+)\)\s*$/);return s?(0,n.n)(this.queryResultQuery(s[1])):this.metricNameAndLabelsQuery(this.query)}labelNamesQuery(){const e=this.datasource.getPrometheusTime(this.range.from,!1),t=this.datasource.getPrometheusTime(this.range.to,!0),s={start:e.toString(),end:t.toString()};return this.datasource.metadataRequest("/api/v1/labels",s).then((e=>(0,r.map)(e.data.data,(e=>({text:e})))))}labelValuesQuery(e,t){const s=this.datasource.getPrometheusTime(this.range.from,!1),i=this.datasource.getPrometheusTime(this.range.to,!0);let a;if(t){const n={"match[]":t,start:s.toString(),end:i.toString()};return a="/api/v1/series",this.datasource.metadataRequest(a,n).then((t=>{const s=(0,r.map)(t.data.data,(t=>t[e]||"")).filter((e=>""!==e));return(0,r.uniq)(s).map((e=>({text:e,expandable:!0})))}))}{const t={start:s.toString(),end:i.toString()};return a=`/api/v1/label/${e}/values`,this.datasource.metadataRequest(a,t).then((e=>(0,r.map)(e.data.data,(e=>({text:e})))))}}metricNameQuery(e){const t=this.datasource.getPrometheusTime(this.range.from,!1),s=this.datasource.getPrometheusTime(this.range.to,!0),i={start:t.toString(),end:s.toString()};return this.datasource.metadataRequest("/api/v1/label/__name__/values",i).then((t=>(0,r.chain)(t.data.data).filter((t=>new RegExp(e).test(t))).map((e=>({text:e,expandable:!0}))).value()))}queryResultQuery(e){const t=this.datasource.getPrometheusTime(this.range.to,!0),s={expr:e};return this.datasource.performInstantQuery(s,t).pipe((0,d.U)((e=>(0,r.map)(e.data.data.result,(e=>{let t=e.metric.__name__||"";return delete e.metric.__name__,t+="{"+(0,r.map)(e.metric,((e,t)=>t+'="'+e+'"')).join(",")+"}",t+=" "+e.value[1]+" "+1e3*e.value[0],{text:t,expandable:!0}})))))}metricNameAndLabelsQuery(e){const t=this.datasource.getPrometheusTime(this.range.from,!1),s=this.datasource.getPrometheusTime(this.range.to,!0),i={"match[]":e,start:t.toString(),end:s.toString()},a=this;return this.datasource.metadataRequest("/api/v1/series",i).then((e=>(0,r.map)(e.data.data,(e=>({text:a.datasource.getOriginalMetricName(e),expandable:!0})))))}}var Q=s("../../opt/drone/yarncache/d3-npm-5.15.0-0c7696026f-7342d82e55.zip/node_modules/d3/index.js"),C=s("./public/app/plugins/datasource/prometheus/types.ts");const j=["__name__"];function E(e,t,s){const[i,a]=(0,r.partition)(e.data,(e=>((e,t)=>{var s,r,i,a;if(t.app===g.CoreApp.Explore&&("vector"===(null===(s=e.meta)||void 0===s||null===(r=s.custom)||void 0===r?void 0:r.resultType)||"scalar"===(null===(i=e.meta)||void 0===i||null===(a=i.custom)||void 0===a?void 0:a.resultType)))return!0;const n=t.targets.find((t=>t.refId===e.refId));return"table"===(null==n?void 0:n.format)})(e,t))),n=function(e){if(0===e.length||1===e.length&&0===e[0].length)return e;const t=(0,r.groupBy)(e,"refId"),s=Object.keys(t);return s.map((r=>{const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e>1?`Value #${t}`:"Value"}(s.length,r),a=L({data:[],valueName:i}),n=z([]),o=[];t[r].forEach((e=>{var t;const s=null!==(t=e.fields[1].labels)&&void 0!==t?t:{};Object.keys(s).sort().forEach((e=>{if(!o.some((t=>t.name===e))){const t="le"===e;o.push({name:e,config:{filterable:!0},type:t?g.FieldType.number:g.FieldType.string,values:new g.ArrayVector})}}))})),t[r].forEach((e=>{e.fields[0].values.toArray().forEach((e=>n.values.add(e))),e.fields[1].values.toArray().forEach((t=>{var s;a.values.add(M(t));const r=null!==(s=e.fields[1].labels)&&void 0!==s?s:{};o.forEach((e=>e.values.add(I(r,e.name))))}))}));return{refId:r,fields:[n,...o,a],meta:Object.assign({},e[0].meta,{preferredVisualisationType:"table"}),length:n.values.length}}))}(i),[o,l]=(0,r.partition)(a,(e=>{var t,s;return"exemplar"===(null===(t=e.meta)||void 0===t||null===(s=t.custom)||void 0===s?void 0:s.resultType)})),{exemplarTraceIdDestinations:u}=s,c=o.map((e=>{if(null!=u&&u.length)for(const s of u){const r=e.fields.find((e=>e.name===s.name));if(r){var t;const e=A(s);r.config.links=null!==(t=r.config.links)&&void 0!==t&&t.length?[...r.config.links,...e]:e}}return Object.assign({},e,{meta:Object.assign({},e.meta,{dataTopic:g.DataTopic.Annotations})})})),[h,d]=(0,r.partition)(l,(e=>((e,t)=>{const s=t.targets.find((t=>t.refId===e.refId));return"heatmap"===(null==s?void 0:s.format)})(e,t))),p=R(D(h.sort(X))),f=d.map((e=>Object.assign({},e,{meta:Object.assign({},e.meta,{preferredVisualisationType:"graph"})})));return Object.assign({},e,{data:[...f,...n,...p,...c]})}function q(e,t){const s={format:t.target.format,step:t.query.step,legendFormat:t.target.legendFormat,start:t.query.start,end:t.query.end,query:t.query.expr,responseListLength:t.responseListLength,scopedVars:t.scopedVars,refId:t.target.refId,valueWithRefId:t.target.valueWithRefId,meta:{preferredVisualisationType:t.query.instant?"table":"graph"}},r=e.data.data;if((0,C.WS)(r)){var i;const e=[];r.forEach((t=>{const s=t.exemplars.map((e=>Object.assign({[g.TIME_SERIES_TIME_FIELD_NAME]:1e3*e.timestamp,[g.TIME_SERIES_VALUE_FIELD_NAME]:e.value},e.labels,t.seriesLabels)));e.push(...s)}));const n=function(e,t){const s=t.step||15,r={},i=[];for(const t of e){const e=String(Math.floor(t[g.TIME_SERIES_TIME_FIELD_NAME]/1e3/s)*s*1e3);r[e]||(r[e]=[]),r[e].push(t),i.push(t[g.TIME_SERIES_VALUE_FIELD_NAME])}const a=(0,Q.deviation)(i),n=Object.keys(r).sort(),o=[];for(const e of n){const t=r[e];if(1===t.length)o.push(t[0]);else{const e=t.map((e=>e[g.TIME_SERIES_VALUE_FIELD_NAME])).sort(Q.descending).reduce(((e,t)=>{if(0===e.length)e.push(t);else{const s=e[e.length-1];a&&s-t>=2*a&&e.push(t)}return e}),[]);o.push(...e.map((e=>t.find((t=>t[g.TIME_SERIES_VALUE_FIELD_NAME]===e)))))}}return o}(e,s),o=new g.ArrayDataFrame(n);if(o.meta={dataTopic:g.DataTopic.Annotations},null!==(i=t.exemplarTraceIdDestinations)&&void 0!==i&&i.length)for(const e of t.exemplarTraceIdDestinations){const t=o.fields.find((t=>t.name===e.name));if(t){var a;const s=A(e);t.config.links=null!==(a=t.config.links)&&void 0!==a&&a.length?[...t.config.links,...s]:s}}return[o]}if(null==r||!r.result)return[];if("scalar"===r.resultType)return[{meta:s.meta,refId:s.refId,length:1,fields:[z([r.result]),L({data:[r.result]})]}];if("table"===s.format){const e=function(e,t){if(!e||0===e.length)return{meta:t.meta,refId:t.refId,length:0,fields:[]};const s=t.responseListLength>1||t.valueWithRefId?`Value #${t.refId}`:"Value",r=z([]),i=Object.keys(e.reduce(((e,t)=>Object.assign({},e,t.metric)),{})).sort().map((e=>({name:e,config:{filterable:!0},type:"le"===e?g.FieldType.number:g.FieldType.string,values:new g.ArrayVector}))),a=L({data:[],valueName:s});return e.forEach((e=>{(0,C.el)(e)?e.values.forEach((t=>{r.values.add(1e3*t[0]),i.forEach((t=>t.values.add(I(e.metric,t.name)))),a.values.add(M(t[1]))})):(r.values.add(1e3*e.value[0]),i.forEach((t=>t.values.add(I(e.metric,t.name)))),a.values.add(M(e.value[1])))})),{meta:t.meta,refId:t.refId,length:r.values.length,fields:[r,...i,a]}}(r.result,s);return[e]}const n=[];return r.result.forEach((e=>n.push(function(e,t){const{name:s,labels:r}=function(e,t){if(null!=t&&t.legendFormat){return{name:(0,P.W)((0,y.getTemplateSrv)().replace(t.legendFormat,null==t?void 0:t.scopedVars),e),labels:e}}const{__name__:s}=e,r=function(e,t){if(null==e)return{};var s,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)s=a[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,j),i=(0,g.formatLabels)(r);let a=`${null!=s?s:""}${i}`;a||(a=t.query);return{name:a,labels:r}}(e.metric,t),i=[];if((0,C.el)(e)){const a=t.step?1e3*t.step:NaN;let n=1e3*t.start;const o=[];for(const t of e.values){let e=M(t[1]);isNaN(e)&&(e=null);const s=1e3*t[0];for(let e=n;e<s;e+=a)o.push([e,null]);n=s+a,o.push([s,e])}const l=1e3*t.end;for(let e=n;e<=l;e+=a)o.push([e,null]);i.push(z(o,!0)),i.push(L({data:o,parseValue:!1,labels:r,displayNameFromDS:s}))}else i.push(z([e.value])),i.push(L({data:[e.value],labels:r,displayNameFromDS:s}));return{meta:t.meta,refId:t.refId,length:i[0].values.length,fields:i,name:s}}(e,s)))),"heatmap"===s.format?R(D(n.sort(X))):n}function A(e){const t=[];if(e.datasourceUid){var s;const r=(0,y.getDataSourceSrv)().getInstanceSettings(e.datasourceUid);t.push({title:e.urlDisplayLabel||`Query with ${null==r?void 0:r.name}`,url:"",internal:{query:{query:"${__value.raw}",queryType:"traceId"},datasourceUid:e.datasourceUid,datasourceName:null!==(s=null==r?void 0:r.name)&&void 0!==s?s:"Data source not found"}})}return e.url&&t.push({title:e.urlDisplayLabel||`Go to ${e.url}`,url:e.url,targetBlank:!0}),t}function I(e,t){return e.hasOwnProperty(t)?"le"===t?M(e[t]):e[t]:""}function z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{name:g.TIME_SERIES_TIME_FIELD_NAME,type:g.FieldType.time,config:{},values:new g.ArrayVector(e.map((e=>t?e[0]:1e3*e[0])))}}function L(e){let{data:t,valueName:s=g.TIME_SERIES_VALUE_FIELD_NAME,parseValue:r=!0,labels:i,displayNameFromDS:a}=e;return{name:s,type:g.FieldType.number,display:(0,g.getDisplayProcessor)(),config:{displayNameFromDS:a},labels:i,values:new g.ArrayVector(t.map((e=>r?M(e[1]):e[1])))}}function R(e){if(0===e.length)return[];const t=e[0].fields.find((e=>e.type===g.FieldType.time)),s=e.map((e=>{let t=e.fields.find((e=>e.type===g.FieldType.number));return Object.assign({},t,{name:t.config.displayNameFromDS})}));return[Object.assign({},e[0],{meta:Object.assign({},e[0].meta,{type:g.DataFrameType.HeatmapBuckets}),fields:[t,...s]})]}function D(e){for(let t=e.length-1;t>0;t--){const s=e[t].fields.find((e=>e.name===g.TIME_SERIES_VALUE_FIELD_NAME)),r=e[t-1].fields.find((e=>e.name===g.TIME_SERIES_VALUE_FIELD_NAME));if(!s||!r)throw new Error("Prometheus heatmap transform error: data should be a time series");for(let e=0;e<s.values.length;e++){const t=r.values.get(e)||[0];s.values.toArray()[e]-=t}}return e}function X(e,t){let s,r;try{var i,a;s=M(null!==(i=e.name)&&void 0!==i?i:""),r=M(null!==(a=t.name)&&void 0!==a?a:"")}catch(e){return console.error(e),0}return s>r?1:s<r?-1:0}function M(e){switch(e){case"+Inf":return Number.POSITIVE_INFINITY;case"-Inf":return Number.NEGATIVE_INFINITY;default:return parseFloat(e)}}var F=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/from.js");class N extends g.StandardVariableSupport{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,y.getTemplateSrv)(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,x.$t)();super(),this.datasource=e,this.templateSrv=t,this.timeSrv=s,this.datasource=e,this.templateSrv=t,this.timeSrv=s,this.query=this.query.bind(this)}query(e){const t=e.targets[0].expr;if(!t)return(0,o.of)({data:[]});const s=Object.assign({},e.scopedVars,{__interval:{text:this.datasource.interval,value:this.datasource.interval},__interval_ms:{text:g.rangeUtil.intervalToMs(this.datasource.interval),value:g.rangeUtil.intervalToMs(this.datasource.interval)}},this.datasource.getRangeScopedVars(this.timeSrv.timeRange())),r=this.templateSrv.replace(t,s,this.datasource.interpolateQueryExpr),i=new T(this.datasource,r);return(0,F.D)(i.process()).pipe((0,d.U)((e=>({data:e}))))}toDataQuery(e){return{refId:"PrometheusDatasource-VariableQuery",expr:e.query}}}var G,V,B,U,W,H=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function Z(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Y="60s",K=["api/v1/query","api/v1/query_range","api/v1/series","api/v1/labels"];class J extends y.DataSourceWithBackend{constructor(e){var t,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_.J)(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,x.$t)(),o=arguments.length>3?arguments[3]:void 0;super(e),Z(this,"type",void 0),Z(this,"editorSrc",void 0),Z(this,"ruleMappings",void 0),Z(this,"url",void 0),Z(this,"id",void 0),Z(this,"directUrl",void 0),Z(this,"access",void 0),Z(this,"basicAuth",void 0),Z(this,"withCredentials",void 0),Z(this,"metricsNameCache",new(a())({max:10})),Z(this,"interval",void 0),Z(this,"queryTimeout",void 0),Z(this,"httpMethod",void 0),Z(this,"languageProvider",void 0),Z(this,"exemplarTraceIdDestinations",void 0),Z(this,"lookupsDisabled",void 0),Z(this,"customQueryParameters",void 0),Z(this,"exemplarsAvailable",void 0),Z(this,"subType",void 0),Z(this,"rulerEnabled",void 0),Z(this,"init",(async()=>{this.loadRules(),this.exemplarsAvailable=await this.areExemplarsAvailable()})),Z(this,"prepareTargets",((e,t,s)=>{const i=[],a=[],n=(0,r.cloneDeep)(e.targets);for(const o of n){if(!o.expr||o.hide)continue;o.requestId=e.panelId+o.refId;const n=this.languageProvider.histogramMetrics.find((e=>o.expr.includes(e)));if(e.app===g.CoreApp.Explore&&o.range===o.instant){const l=(0,r.cloneDeep)(o);l.format="table",l.instant=!0,l.range=!1,l.valueWithRefId=!0,delete l.maxDataPoints,l.requestId+="_instant";const u=(0,r.cloneDeep)(o);if(u.format="time_series",u.instant=!1,l.range=!0,o.exemplar){if(!n||n&&!a.some((e=>e.expr.includes(n)))){const n=(0,r.cloneDeep)(o);n.instant=!1,n.requestId+="_exemplar",i.push(this.createQuery(n,e,t,s)),a.push(n)}l.exemplar=!1,u.exemplar=!1}a.push(l,u),i.push(this.createQuery(l,e,t,s),this.createQuery(u,e,t,s))}else if(o.instant&&e.app===g.CoreApp.Explore){const n=(0,r.cloneDeep)(o);n.format="table",i.push(this.createQuery(n,e,t,s)),a.push(n)}else{if(o.exemplar&&!o.instant){if(!n||n&&!a.some((e=>e.expr.includes(n)))){const n=(0,r.cloneDeep)(o);n.requestId+="_exemplar",i.push(this.createQuery(n,e,t,s)),a.push(n)}o.exemplar=!1}i.push(this.createQuery(o,e,t,s)),a.push(o)}}return{queries:i,activeTargets:a}})),Z(this,"handleErrors",((e,t)=>{const s={message:e&&e.statusText||"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?s.message=e.data:e.data.error&&(s.message=(0,O.Xh)(e.data.error)):e.message?s.message=e.message:"string"==typeof e&&(s.message=e),s.status=e.status,s.statusText=e.statusText,s})),Z(this,"processAnnotationResponse",((e,t)=>{const s=(0,y.toDataQueryResponse)({data:t}).data;if(!s||!s.length)return[];const r=e.annotation,{tagKeys:i="",titleFormat:a="",textFormat:n=""}=r,o=1e3*g.rangeUtil.intervalToSeconds(r.step||Y),l=i.split(","),u=[];for(const t of s){const s=t.fields[0],i=t.fields[1],h=(null==i?void 0:i.labels)||{},d=Object.keys(h).filter((e=>l.includes(e))).map((e=>h[e])),p=[];let f=0;i.values.toArray().forEach((t=>{let r,i;const a=s.values.get(f);e.annotation.useValueForTime?(r=Math.floor(parseFloat(t)),i=1):(r=Math.floor(parseFloat(a)),i=parseFloat(t)),f++,p.push([r,i])}));const m=p.filter((e=>e[1]>=1)).map((e=>e[0]));let g=null;for(const e of m){var c;g&&(null!==(c=g.timeEnd)&&void 0!==c?c:0)+o>=e?g.timeEnd=e:(g&&u.push(g),g={time:e,timeEnd:e,annotation:r,title:(0,P.W)(a,h),tags:d,text:(0,P.W)(n,h)})}g&&(g.timeEnd=m[m.length-1],u.push(g))}return u})),this.templateSrv=i,this.timeSrv=n,this.templateSrv=i,this.timeSrv=n,this.type="prometheus",this.subType=$.T8.Prometheus,this.rulerEnabled=!1,this.editorSrc="app/features/prometheus/partials/query.editor.html",this.id=e.id,this.url=e.url,this.access=e.access,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.interval=e.jsonData.timeInterval||"15s",this.queryTimeout=e.jsonData.queryTimeout,this.httpMethod=e.jsonData.httpMethod||"POST",this.directUrl=null!==(t=e.jsonData.directUrl)&&void 0!==t?t:this.url,this.exemplarTraceIdDestinations=e.jsonData.exemplarTraceIdDestinations,this.ruleMappings={},this.languageProvider=null!=o?o:new w.ZP(this),this.lookupsDisabled=null!==(s=e.jsonData.disableMetricsLookup)&&void 0!==s&&s,this.customQueryParameters=new URLSearchParams(e.jsonData.customQueryParameters),this.variables=new N(this,this.templateSrv,this.timeSrv),this.exemplarsAvailable=!0}getQueryDisplayText(e){return e.expr}_addTracingHeaders(e,t){e.headers={};!this.url.match(/^http/)&&(e.headers["X-Dashboard-Id"]=t.dashboardId,e.headers["X-Panel-Id"]=t.panelId)}_request(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=t||{};for(const[e,s]of this.customQueryParameters)null==t[e]&&(t[e]=s);const i=(0,r.defaults)(s,{url:this.url+e,method:this.httpMethod,headers:{}});return"GET"===i.method?t&&Object.keys(t).length&&(i.url=i.url+(i.url.search(/\?/)>=0?"&":"?")+Object.entries(t).map((e=>{let[t,s]=e;return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`})).join("&")):(i.headers["Content-Type"]="application/x-www-form-urlencoded",i.data=t),(this.basicAuth||this.withCredentials)&&(i.withCredentials=!0),this.basicAuth&&(i.headers.Authorization=this.basicAuth),(0,y.getBackendSrv)().fetch(i)}async importFromAbstractQueries(e){return e.map((e=>this.languageProvider.importFromAbstractQuery(e)))}async exportToAbstractQueries(e){return e.map((e=>this.languageProvider.exportToAbstractQuery(e)))}async metadataRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(K.some((t=>e.includes(t))))try{return await(0,n.n)(this._request(e,t,{method:this.httpMethod,hideFromInspector:!0}))}catch(e){if("POST"!==this.httpMethod||405!==e.status)throw e;console.warn("Couldn't use configured POST HTTP method for this request. Trying to use GET method instead.")}return await(0,n.n)(this._request(e,t,{method:"GET",hideFromInspector:!0}))}interpolateQueryExpr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t.multi&&!t.includeAll)return ee(e);if("string"==typeof e)return te(e);const s=e.map((e=>te(e)));return 1===s.length?s[0]:"("+s.join("|")+")"}targetContainsTemplate(e){return this.templateSrv.containsTemplate(e.expr)}shouldRunExemplarQuery(e,t){if(e.exemplar){const s=this.languageProvider.histogramMetrics.find((t=>e.expr.includes(t))),r=t.targets.findIndex((t=>t.refId===e.refId)),i=t.targets.slice(0,r);return!(s&&(!s||i.some((e=>e.expr.includes(s)))))}return!1}processTargetV2(e,t){return Object.assign({},e,{queryType:C.V5.timeSeriesQuery,exemplar:this.shouldRunExemplarQuery(e,t),requestId:t.panelId+e.refId,utcOffsetSec:60*this.timeSrv.timeRange().to.utcOffset()})}query(e){if("proxy"===this.access){const t=e.targets.map((t=>this.processTargetV2(t,e)));return super.query(Object.assign({},e,{targets:t})).pipe((0,d.U)((t=>E(t,e,{exemplarTraceIdDestinations:this.exemplarTraceIdDestinations}))))}{const t=this.getPrometheusTime(e.range.from,!1),s=this.getPrometheusTime(e.range.to,!0),{queries:r,activeTargets:i}=this.prepareTargets(e,t,s);return r&&r.length?e.app===g.CoreApp.Explore?this.exploreQuery(r,i,s):this.panelsQuery(r,i,s,e.requestId,e.scopedVars):(0,o.of)({data:[],state:g.LoadingState.Done})}}exploreQuery(e,t,s){let r=e.length;const i=e.map(((i,a)=>{const n=t[a],o=(0,l.z)((0,p.b)((()=>r--)),(0,f.h)((e=>!e.cancelled)),(0,d.U)((t=>({data:q(t,{query:i,target:n,responseListLength:e.length,exemplarTraceIdDestinations:this.exemplarTraceIdDestinations}),key:i.requestId,state:0===r?g.LoadingState.Done:g.LoadingState.Loading}))));return this.runQuery(i,s,o)}));return(0,u.T)(...i)}panelsQuery(e,t,s,r,i){const a=e.map(((r,a)=>{const n=t[a],o=(0,l.z)((0,f.h)((e=>!e.cancelled)),(0,d.U)((t=>q(t,{query:r,target:n,responseListLength:e.length,scopedVars:i,exemplarTraceIdDestinations:this.exemplarTraceIdDestinations}))));return this.runQuery(r,s,o)}));return(0,c.D)(a).pipe((0,d.U)((e=>({data:e.reduce(((e,t)=>[...e,...t]),[]),key:r,state:g.LoadingState.Done}))))}runQuery(e,t,s){return e.instant?this.performInstantQuery(e,t).pipe(s):e.exemplar?this.getExemplars(e).pipe((0,m.K)((()=>(0,o.of)({data:[],state:g.LoadingState.Done}))),s):this.performTimeSeriesQuery(e,e.start,e.end).pipe(s)}createQuery(e,t,s,r){const i={hinting:e.hinting,instant:e.instant,exemplar:e.exemplar,step:0,expr:"",requestId:e.requestId,refId:e.refId,start:0,end:0},a=Math.ceil(r-s);let n=g.rangeUtil.intervalToSeconds(t.interval);const o=g.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval||t.interval,t.scopedVars)),l=e.interval?g.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval,t.scopedVars)):g.rangeUtil.intervalToSeconds(this.interval),u=e.intervalFactor||1,c=this.adjustInterval(n,o,a,u);let h=Object.assign({},t.scopedVars,this.getRangeScopedVars(t.range),this.getRateIntervalScopedVariable(c,l));n!==c&&(n=c,h=Object.assign({},t.scopedVars,Object.assign({__interval:{text:n+"s",value:n+"s"},__interval_ms:{text:1e3*n,value:1e3*n}},this.getRateIntervalScopedVariable(n,l),this.getRangeScopedVars(t.range)))),i.step=n;let d=e.expr;d=this.enhanceExprWithAdHocFilters(d),i.expr=this.templateSrv.replace(d,h,this.interpolateQueryExpr);const p=function(e,t,s,r){const i=Math.floor((t+r)/s)*s-r,a=Math.floor((e+r)/s)*s-r;return{end:i,start:a}}(s,r,i.step,60*this.timeSrv.timeRange().to.utcOffset());return i.start=p.start,i.end=p.end,this._addTracingHeaders(i,t),i}getRateIntervalScopedVariable(e,t){0===t&&(t=15);const s=Math.max(e+t,4*t);return{__rate_interval:{text:s+"s",value:s+"s"}}}adjustInterval(e,t,s,r){let i=s/11e3;return i>1&&(i=Math.ceil(i)),Math.max(e*r,t,i)}performTimeSeriesQuery(e,t,s){if(t>s)throw{message:"Invalid time range"};const r={query:e.expr,start:t,end:s,step:e.step};return this.queryTimeout&&(r.timeout=this.queryTimeout),this._request("/api/v1/query_range",r,{requestId:e.requestId,headers:e.headers}).pipe((0,m.K)((t=>t.cancelled?(0,o.of)(t):(0,h._)(this.handleErrors(t,e)))))}performInstantQuery(e,t){const s={query:e.expr,time:t};return this.queryTimeout&&(s.timeout=this.queryTimeout),this._request("/api/v1/query",s,{requestId:e.requestId,headers:e.headers}).pipe((0,m.K)((t=>t.cancelled?(0,o.of)(t):(0,h._)(this.handleErrors(t,e)))))}metricFindQuery(e){if(!e)return Promise.resolve([]);const t=Object.assign({__interval:{text:this.interval,value:this.interval},__interval_ms:{text:g.rangeUtil.intervalToMs(this.interval),value:g.rangeUtil.intervalToMs(this.interval)}},this.getRangeScopedVars(this.timeSrv.timeRange())),s=this.templateSrv.replace(e,t,this.interpolateQueryExpr);return new T(this,s).process()}getRangeScopedVars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeSrv.timeRange();const t=e.to.diff(e.from),s=Math.round(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:s,value:s},__range:{text:s+"s",value:s+"s"}}}async annotationQuery(e){const t=e.annotation,{expr:s=""}=t;if(!s)return Promise.resolve([]);const r={expr:s,range:!0,instant:!1,exemplar:!1,interval:e.annotation.step||Y,queryType:C.V5.timeSeriesQuery,refId:"X",datasource:this.getRef()};return await(0,n.n)((0,y.getBackendSrv)().fetch({url:"/api/ds/query",method:"POST",data:{from:(1e3*this.getPrometheusTime(e.range.from,!1)).toString(),to:(1e3*this.getPrometheusTime(e.range.to,!0)).toString(),queries:[this.applyTemplateVariables(r,{})]},requestId:`prom-query-${t.name}`}).pipe((0,d.U)((t=>this.processAnnotationResponse(e,t.data)))))}getExemplars(e){return this._request("/api/v1/query_exemplars",{query:e.expr,start:e.start.toString(),end:e.end.toString()},{requestId:e.requestId,headers:e.headers})}async getSubtitle(){const e=await this.getBuildInfo();return e?this.getBuildInfoMessage(e):null}async getTagKeys(e){if(null!=e&&e.series){const t=await Promise.all(e.series.map((e=>this.languageProvider.fetchSeriesLabels(e))));return[...new Set(...t.map((e=>Object.keys(e))))].map((e=>({text:e})))}{var t,s,r;const e=await this.metadataRequest("/api/v1/labels");return null!==(t=null==e||null===(s=e.data)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.map((e=>({text:e}))))&&void 0!==t?t:[]}}async getTagValues(){var e,t,s;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=await this.metadataRequest(`/api/v1/label/${r.key}/values`);return null!==(e=null==i||null===(t=i.data)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.map((e=>({text:e}))))&&void 0!==e?e:[]}async getBuildInfo(){try{return await(0,v.P)(this)}catch(e){return}}getBuildInfoMessage(e){var t,s;const r=G||(G=(0,H.jsx)(b.Badge,{color:"green",icon:"check",text:"Ruler API enabled"})),i=V||(V=(0,H.jsx)(b.Badge,{color:"orange",icon:"exclamation-triangle",text:"Ruler API not enabled"})),a=B||(B=(0,H.jsx)(b.Tooltip,{placement:"top",content:"Prometheus does not allow editing rules, connect to either a Mimir or Cortex datasource to manage alerts via Grafana.",children:(0,H.jsx)("div",{children:(0,H.jsx)(b.Badge,{color:"red",icon:"exclamation-triangle",text:"Ruler API not supported"})})})),n={[$.T8.Cortex]:"/public/app/plugins/datasource/prometheus/img/cortex_logo.svg",[$.T8.Mimir]:"/public/app/plugins/datasource/prometheus/img/mimir_logo.svg",[$.T8.Prometheus]:"/public/app/plugins/datasource/prometheus/img/prometheus_logo.svg"},o={[$.T8.Cortex]:"blue",[$.T8.Mimir]:"orange",[$.T8.Prometheus]:"red"},l=(0,H.jsx)(b.Badge,{text:(0,H.jsxs)("span",{children:[(0,H.jsx)("img",{style:{width:14,height:14,verticalAlign:"text-bottom"},src:n[null!==(t=e.application)&&void 0!==t?t:$.T8.Prometheus]})," ",e.application]}),color:o[null!==(s=e.application)&&void 0!==s?s:$.T8.Prometheus]});return(0,H.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"max-content max-content",rowGap:"0.5rem",columnGap:"2rem",marginTop:"1rem"},children:[U||(U=(0,H.jsx)("div",{children:"Type"})),(0,H.jsx)("div",{children:l}),(0,H.jsxs)(H.Fragment,{children:[W||(W=(0,H.jsx)("div",{children:"Ruler API"})),e.application===$.T8.Prometheus&&(0,H.jsx)("div",{children:a}),e.application!==$.T8.Prometheus&&(0,H.jsx)("div",{children:e.features.rulerApiEnabled?r:i})]})]})}async testDatasource(){const e=(new Date).getTime(),t={targets:[{refId:"test",expr:"1+1",instant:!0}],requestId:`${this.id}-health`,scopedVars:{},dashboardId:0,panelId:0,interval:"1m",intervalMs:6e4,maxDataPoints:1,range:{from:(0,g.dateTime)(e-1e3),to:(0,g.dateTime)(e)}},s=await this.getBuildInfo();return(0,n.n)(this.query(t)).then((e=>{return e&&e.data&&e.state===g.LoadingState.Done?{status:"success",message:"Data source is working",details:s&&{verboseMessage:this.getBuildInfoMessage(s)}}:{status:"error",message:`Error reading Prometheus: ${null==e||null===(t=e.error)||void 0===t?void 0:t.message}`};var t})).catch((e=>(console.error("Prometheus Error",e),{status:"error",message:e.message})))}interpolateVariablesInQueries(e,t){let s=e;return e&&e.length&&(s=e.map((e=>Object.assign({},e,{datasource:this.getRef(),expr:this.templateSrv.replace(e.expr,t,this.interpolateQueryExpr),interval:this.templateSrv.replace(e.interval,t)})))),s}getQueryHints(e,t){var s;return function(e,t,s){const i=[];if(e.trim().match(/^\w+_bucket$|^\w+_bucket{.*}$/)){const t="Selected metric has buckets.";i.push({type:"HISTOGRAM_QUANTILE",label:t,fix:{label:"Consider calculating aggregated quantile by adding histogram_quantile().",action:{type:"ADD_HISTOGRAM_QUANTILE",query:e}}})}if(-1===e.indexOf("rate(")&&-1===e.indexOf("increase(")){var a,n;const t=e.match(/\b(\w+_(total|sum|count))\b/);let r=t?t[1]:"";const l=null!==(a=null==s||null===(n=s.languageProvider)||void 0===n?void 0:n.metricsMetadata)&&void 0!==a?a:{},u=Object.keys(l);let c=!1;var o;if(u.length>0&&(r=null!==(o=u.find((t=>{if("counter"===l[t].type.toLowerCase()){const s=new RegExp(`\\b${t}\\b`);if(e.match(s))return c=!0,!0}return!1})))&&void 0!==o?o:""),r){const t=e.trim().match(/^\w+$|^\w+{.*}$/);let s,r=`Selected metric ${c?"is":"looks like"} a counter.`;t?s={label:"Consider calculating rate of counter by adding rate().",action:{type:"ADD_RATE",query:e}}:r=`${r} Consider calculating rate of counter by adding rate().`,i.push({type:"APPLY_RATE",label:r,fix:s})}}if(s&&s.ruleMappings){const t=s.ruleMappings,a=Object.keys(t).reduce(((s,r)=>e.search(r)>-1?Object.assign({},s,{[r]:t[r]}):s),{});if((0,r.size)(a)>0){const t="Query contains recording rules.";i.push({type:"EXPAND_RULES",label:t,fix:{label:"Expand rules",action:{type:"EXPAND_RULES",query:e,mapping:a}}})}}t&&t.length>=20&&e.trim().match(/^\w+$/)&&i.push({type:"ADD_SUM",label:"Many time series results returned.",fix:{label:"Consider aggregating with sum().",action:{type:"ADD_SUM",query:e,preventSubmit:!0}}});return i}(null!==(s=e.expr)&&void 0!==s?s:"",t,this)}getInitHints(){return function(e){const t=[];return e.directUrl.includes("/loki")&&!e.languageProvider.metrics.length&&t.push({label:"Using Loki as a Prometheus data source is no longer supported. You must use the Loki data source for your Loki instance.",type:"INFO"}),e.lookupsDisabled&&t.push({label:"Labels and metrics lookup was disabled in data source settings.",type:"INFO"}),t}(this)}async loadRules(){try{var e,t;const s=null===(e=(await this.metadataRequest("/api/v1/rules")).data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.groups;s&&(this.ruleMappings=function(e){return e.reduce(((e,t)=>t.rules.filter((e=>"recording"===e.type)).reduce(((e,t)=>Object.assign({},e,{[t.name]:t.query})),e)),{})}(s))}catch(e){console.log("Rules API is experimental. Ignore next error."),console.error(e)}}async areExemplarsAvailable(){try{return"success"===(await this.metadataRequest("/api/v1/query_exemplars",{query:"test"})).data.status}catch(e){return!1}}modifyQuery(e,t){var s;let r=null!==(s=e.expr)&&void 0!==s?s:"";switch(t.type){case"ADD_FILTER":r=(0,k.F)(r,t.key,t.value);break;case"ADD_FILTER_OUT":r=(0,k.F)(r,t.key,t.value,"!=");break;case"ADD_HISTOGRAM_QUANTILE":r=`histogram_quantile(0.95, sum(rate(${r}[$__rate_interval])) by (le))`;break;case"ADD_RATE":r=`rate(${r}[$__rate_interval])`;break;case"ADD_SUM":r=`sum(${r.trim()}) by ($1)`;break;case"EXPAND_RULES":t.mapping&&(r=(0,S.ll)(r,t.mapping))}return Object.assign({},e,{expr:r})}getPrometheusTime(e,t){return"string"==typeof e&&(e=g.dateMath.parse(e,t)),Math.ceil(e.valueOf()/1e3)}getTimeRangeParams(){const e=this.timeSrv.timeRange();return{start:this.getPrometheusTime(e.from,!1).toString(),end:this.getPrometheusTime(e.to,!0).toString()}}getOriginalMetricName(e){return function(e){const t=e.__name__||"";return delete e.__name__,`${t}{${Object.entries(e).map((e=>`${e[0]}="${e[1]}"`)).join(",")}}`}(e)}enhanceExprWithAdHocFilters(e){const t=this.templateSrv.getAdhocFilters(this.name).reduce(((e,t)=>{const{key:s,operator:r}=t;let{value:i}=t;return"=~"!==r&&"!~"!==r||(i=ee(i)),(0,k.F)(e,s,i,r)}),e);return t}filterQuery(e){return!(e.hide||!e.expr)}applyTemplateVariables(e,t){const s=(0,r.cloneDeep)(t);delete s.__interval,delete s.__interval_ms;const i=this.enhanceExprWithAdHocFilters(e.expr);return Object.assign({},e,{legendFormat:this.templateSrv.replace(e.legendFormat,s),expr:this.templateSrv.replace(i,s,this.interpolateQueryExpr),interval:this.templateSrv.replace(e.interval,s)})}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}interpolateString(e){return this.templateSrv.replace(e,void 0,this.interpolateQueryExpr)}}function ee(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}function te(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&"):e}},"./public/app/plugins/datasource/prometheus/language_provider.ts":(e,t,s)=>{"use strict";s.d(t,{UQ:()=>y,ZK:()=>f,ZP:()=>O});var r=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),i=s("../../opt/drone/yarncache/lru-cache-npm-7.7.1-726274dc4d-f362c5a2cf.zip/node_modules/lru-cache/index.js"),a=s.n(i),n=s("../../opt/drone/yarncache/prismjs-npm-1.27.0-ca4e1667c6-85c7f4a3e9.zip/node_modules/prismjs/prism.js"),o=s.n(n),l=s("./packages/grafana-data/src/index.ts"),u=s("./packages/grafana-ui/src/index.ts"),c=s("./public/app/plugins/datasource/prometheus/language_utils.ts"),h=s("./public/app/plugins/datasource/prometheus/promql.ts");function d(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const p=["job","instance"],f=1e4,m=e=>({label:e}),g=e=>(e.kind="function",e);function y(e,t){if(!t[e])return;const{type:s,help:r}=t[e];return`${s.toUpperCase()}: ${r}`}const b=/(="|!="|=~"|!~"|\{|\[|\(|\+|-|\/|\*|%|\^|\band\b|\bor\b|\bunless\b|==|>=|!=|<=|>|<|=|~|,)/;class O extends l.LanguageProvider{constructor(e,t){var s;super(),s=this,d(this,"histogramMetrics",void 0),d(this,"timeRange",void 0),d(this,"metrics",void 0),d(this,"metricsMetadata",void 0),d(this,"datasource",void 0),d(this,"labelKeys",[]),d(this,"labelsCache",new(a())({max:10})),d(this,"request",(async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return(await s.datasource.metadataRequest(e,r)).data.data}catch(e){console.error(e)}return t})),d(this,"start",(async()=>(this.datasource.lookupsDisabled||(await this.fetchLabels(),this.metrics=await this.fetchLabelValues("__name__")||[],await this.loadMetricsMetadata(),this.histogramMetrics=(0,c.NO)(this.metrics).sort()),[]))),d(this,"provideCompletionItems",(async function(e){let{prefix:t,text:r,value:i,labelKey:a,wrapperClasses:n}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l={suggestions:[]};if(!i)return l;const u=0===i.document.text.length,c=i.document.getTextsAtRange(i.selection),h=1===c.size?c.first().getText():null,d=h?h[i.selection.anchor.offset]:null,p=n.length>3,f=t&&!p,m=!d||")"===d,g=t&&!r.match(/^[\]})\s]+$/)&&m,y=/[+\-*/^%]/,b=r.match(y);return n.includes("context-range")?s.getRangeCompletionItems():n.includes("context-labels")?s.getLabelCompletionItems({prefix:t,text:r,value:i,labelKey:a,wrapperClasses:n}):n.includes("context-aggregation")?s.getAggregationCompletionItems(i):u?s.getEmptyCompletionItems(o):f&&m&&!b?s.getBeginningCompletionItems(o):f&&g?s.getTermCompletionItems():l})),d(this,"getBeginningCompletionItems",(e=>({suggestions:[...this.getEmptyCompletionItems(e).suggestions,...this.getTermCompletionItems().suggestions]}))),d(this,"getEmptyCompletionItems",(e=>{const{history:t}=e,s=[];if(t&&t.length){const e=(0,r.chain)(t).map((e=>e.query.expr)).filter().uniq().take(5).map(m).map((e=>function(e,t){const s=Date.now()-864e5,r=t.filter((t=>t.ts>s&&t.query===e.label)),i=r.length,a=r[0];let n=`Queried ${i} times in the last 24h.`;a&&(n=`${n} Last queried ${(0,l.dateTime)(a.ts).fromNow()}.`);return Object.assign({},e,{documentation:n})}(e,t))).value();s.push({searchFunctionType:u.SearchFunctionType.Prefix,skipSort:!0,label:"History",items:e})}return{suggestions:s}})),d(this,"getTermCompletionItems",(()=>{const{metrics:e,metricsMetadata:t}=this,s=[];return s.push({searchFunctionType:u.SearchFunctionType.Prefix,label:"Functions",items:h.r8.map(g)}),e&&e.length&&s.push({label:"Metrics",items:e.map((e=>function(e,t){const s={label:e};return t&&t[e]&&(s.documentation=y(e,t)),s}(e,t))),searchFunctionType:u.SearchFunctionType.Fuzzy}),{suggestions:s}})),d(this,"getAggregationCompletionItems",(async e=>{const t=[];let s;const r=e.document.getBlocks().reduce(((t,r)=>{if(void 0===t)return"";if(!r)return t;const i=null==r?void 0:r.getText();return e.anchorBlock.key===r.key&&(s=e.selection.anchor.offset+t.length),t+i}),""),i=r.lastIndexOf("(",s);let a=r.lastIndexOf("(",i-1),n=r.indexOf(")",a);if(-1===a){const e=r.indexOf(")",s);n=r.indexOf(")",e+1),a=r.lastIndexOf("(",n)}const o={suggestions:t,context:"context-aggregation"};if(-1===a)return o;const l=r.slice(a+1,n).replace(/\[[^\]]+\]$/,""),h=(0,c.rV)(l,l.length-2).selector,d=await this.getSeries(h),p=Object.keys(d);if(p.length>0){const e=(0,c.ZO)(p);t.push({label:`Labels${e}`,items:p.map(m),searchFunctionType:u.SearchFunctionType.Fuzzy})}return o})),d(this,"getLabelCompletionItems",(async e=>{let{text:t,wrapperClasses:s,labelKey:i,value:a}=e;if(!a)return{suggestions:[]};const n=[],o=a.anchorBlock.getText(),l=a.selection.anchor.offset,h=o.substr(l),d=o.substr(0,l),f=t.match(/^(=|=~|!=|!~)/),g=h.match(/^"?[,}]|$/),y=d.match(/(=|=~|!=|!~)$/)&&h.match(/^"/);if(!(f&&g)&&!(g&&!f)||y)return{suggestions:n};let b,O;try{O=(0,c.rV)(o,l),b=O.selector}catch{b="{}"}const v=b.includes("__name__="),x=O?O.labelKeys:[];let _,$={};if(b&&($=await this.getSeries(b,!v)),0===Object.keys($).length)return console.warn(`Server did not return any values for selector = ${b}`),{suggestions:n};if(t&&f||s.includes("attr-value")){if(i&&$[i]){_="context-label-values";const e=(0,c.ZO)($[i]);n.push({label:`Label values for "${i}"${e}`,items:$[i].map(m),searchFunctionType:u.SearchFunctionType.Fuzzy})}}else{const e=$?Object.keys($):v?null:p;if(e){const t=(0,r.difference)(e,x);if(t.length){_="context-labels";const e=t.map((e=>({label:e}))),s={label:`Labels${(0,c.ZO)(e)}`,items:e,searchFunctionType:u.SearchFunctionType.Fuzzy};n.push(s)}}}return{context:_,suggestions:n}})),d(this,"fetchLabelValues",(async e=>{const t=this.datasource.getTimeRangeParams(),s=`/api/v1/label/${this.datasource.interpolateString(e)}/values`;return await this.request(s,[],t)})),d(this,"fetchSeriesLabels",(async(e,t)=>{const s=this.datasource.interpolateString(e),r=this.datasource.getTimeRangeParams(),i=Object.assign({},r,{"match[]":s}),a=`/api/v1/series?${new URLSearchParams({"match[]":s,start:(0,c.s4)(parseInt(r.start,10)).toString(),end:(0,c.s4)(parseInt(r.end,10)).toString(),withName:t?"true":"false"}).toString()}`;let n=this.labelsCache.get(a);if(!n){const e=await this.request("/api/v1/series",[],i),{values:s}=(0,c.DY)(e,t);n=s,this.labelsCache.set(a,n)}return n})),d(this,"fetchSeries",(async e=>{const t=this.datasource.getTimeRangeParams(),s=Object.assign({},t,{"match[]":e});return await this.request("/api/v1/series",{},s)})),d(this,"fetchDefaultSeries",(0,r.once)((async()=>{const e=await Promise.all(p.map((e=>this.fetchLabelValues(e))));return p.reduce(((t,s,r)=>Object.assign({},t,{[s]:e[r]})),{})}))),this.datasource=e,this.histogramMetrics=[],this.timeRange={start:0,end:0},this.metrics=[],Object.assign(this,t)}cleanText(e){return e.split(b).pop().trimLeft().replace(/"$/,"").replace(/^"/,"")}get syntax(){return h.ZP}async loadMetricsMetadata(){this.metricsMetadata=(0,c.I4)(await this.request("/api/v1/metadata",{}))}getLabelKeys(){return this.labelKeys}getRangeCompletionItems(){return{context:"context-range",suggestions:[{label:"Range vector",items:[...h.Ty]}]}}importFromAbstractQuery(e){return(0,c.e5)(e)}exportToAbstractQuery(e){const t=e.expr;if(!t||0===t.length)return{refId:e.refId,labelMatchers:[]};const s=o().tokenize(t,h.ZP),r=(0,c.UO)(s),i=function(e,t){let s="";for(let e in t)if("string"==typeof t[e]){s=t[e];break}return s}(0,s);return i&&i.length>0&&r.push({name:"__name__",operator:l.AbstractLabelOperator.Equal,value:i}),{refId:e.refId,labelMatchers:r}}async getSeries(e,t){if(this.datasource.lookupsDisabled)return{};try{return"{}"===e?await this.fetchDefaultSeries():await this.fetchSeriesLabels(e,t)}catch(e){return console.error(e),{}}}async getLabelValues(e){return await this.fetchLabelValues(e)}async fetchLabels(){const e=this.datasource.getTimeRangeParams();this.labelFetchTs=Date.now().valueOf();const t=await this.request("/api/v1/labels",[],e);return Array.isArray(t)&&(this.labelKeys=t.slice().sort()),[]}}},"./public/app/plugins/datasource/prometheus/language_utils.ts":(e,t,s)=>{"use strict";s.d(t,{DY:()=>h,I4:()=>g,NO:()=>c,PL:()=>S,U9:()=>_,UO:()=>T,ZO:()=>v,e5:()=>P,ll:()=>m,o8:()=>y,rV:()=>f,s4:()=>b,tU:()=>$});var r=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),i=s("../../opt/drone/yarncache/prismjs-npm-1.27.0-ca4e1667c6-85c7f4a3e9.zip/node_modules/prismjs/prism.js"),a=s("./packages/grafana-data/src/index.ts"),n=s("./public/app/plugins/datasource/prometheus/add_label_to_query.ts"),o=s("./public/app/plugins/datasource/prometheus/language_provider.ts");const l=["__name__"];function u(e,t){if(null==e)return{};var s,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)s=a[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}const c=e=>{const t=new Set,s=new RegExp("_bucket($|:)");for(let r=0;r<e.length;r++){const i=e[r];s.test(i)&&t.add(i)}return[...t]};function h(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s={};e.forEach((e=>{const{__name__:r}=e,i=u(e,l);t&&(s.__name__=s.__name__||new Set,s.__name__.has(r)||s.__name__.add(r)),Object.keys(i).forEach((e=>{s[e]||(s[e]=new Set),s[e].has(i[e])||s[e].add(i[e])}))}));const r={};return O(Object.keys(s)).forEach((e=>{r[e]=O(Array.from(s[e]))})),{values:r,keys:Object.keys(r)}}const d=/\{[^}]*?(\}|$)/,p=/\b(\w+)(!?=~?)("[^"\n]*?")/g;function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e.match(d)){if(e.match(/^[A-Za-z:][\w:]*$/))return{selector:`{__name__="${e}"}`,labelKeys:["__name__"]};throw new Error("Query must contain a selector: "+e)}const s=e.slice(0,t),r=s.lastIndexOf("{"),i=s.lastIndexOf("}");if(-1===r)throw new Error("Not inside selector, missing open brace: "+s);if(i>-1&&i>r)throw new Error("Not inside selector, previous selector already closed: "+s);const a=e.slice(t),n=a.indexOf("}"),o=n+t,l=a.indexOf("{"),u=l+t;if(-1===o)throw new Error("Not inside selector, missing closing brace in suffix: "+a);if(l>-1&&u<o)throw new Error("Not inside selector, next selector opens before this one closed: "+a);const c=e.slice(r,o),h={};c.replace(p,((s,r,i,a)=>{const n=e.indexOf(s),o=n+r.length+i.length+1,l=n+r.length+i.length+a.length-1;return(t<o||t>l)&&(h[r]={value:a,operator:i}),""}));const f=e.slice(0,r),m=f.match(/[A-Za-z:][\w:]*$/);m&&(h.__name__={value:`"${m[0]}"`,operator:"="});const g=Object.keys(h).sort(),y=g.map((e=>`${e}${h[e].operator}${h[e].value}`)).join(","),b=["{",y,"}"].join("");return{labelKeys:g,selector:b}}function m(e,t){const s=Object.keys(t),r=new RegExp(`(\\s|^)(${s.join("|")})(\\s|$|\\(|\\[|\\{)`,"ig"),i=e.replace(r,((e,s,r,i)=>`${s}${t[r]}${i}`)).split(/(\+|\-|\*|\/|\%|\^)/),a=/(\)\{|\}\{|\]\{)/,o=i.map((e=>function(e,t){var s;const r=e.match(t);if(!r)return e;const i=null!==(s=r.index)&&void 0!==s?s:0,a=e.slice(0,i+1),o=e.slice(i+1),l=[];o.replace(p,((e,t,s,r)=>(l.push({key:t,operator:s,value:r}),"")));let u=a;return l.filter(Boolean).forEach((e=>{const t=e.value.slice(1,-1);u=(0,n.F)(u,e.key,t,e.operator)})),u}(e,a)));return o.join("")}function g(e){if(!e)return e;const t={},s={};for(const r in e){const i=e[r][0];t[r]=i,"histogram"===i.type&&(s[`${r}_bucket`]={type:"counter",help:`Cumulative counters for the observation buckets (${i.help})`},s[`${r}_count`]={type:"counter",help:`Count of events that have been observed for the histogram metric (${i.help})`},s[`${r}_sum`]={type:"counter",help:`Total sum of all observed values for the histogram metric (${i.help})`}),"summary"===i.type&&(s[`${r}_count`]={type:"counter",help:`Count of events that have been observed for the base metric (${i.help})`},s[`${r}_sum`]={type:"counter",help:`Total sum of all observed values for the base metric (${i.help})`})}const r={ALERTS:{type:"counter",help:"Time series showing pending and firing alerts. The sample value is set to 1 as long as the alert is in the indicated active (pending or firing) state."}};return Object.assign({},t,s,r)}function y(e){return b(e/1e3)}function b(e){return Math.floor(e/60)}function O(e){return e.slice(0,o.ZK)}function v(e){return e&&e.length>=o.ZK?`, limited to the first ${o.ZK} received items`:""}const x=/[*+?()|\\.\[\]{}^$]/g;function _(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function $(e){return _(e.replace(x,"\\$&"))}const k={"=":a.AbstractLabelOperator.Equal,"!=":a.AbstractLabelOperator.NotEqual,"=~":a.AbstractLabelOperator.EqualRegEx,"!~":a.AbstractLabelOperator.NotEqualRegEx},w=(0,r.invert)(k);function S(e){const t=e.labelMatchers.map((e=>{const t=w[e.operator];return t?`${e.name}${t}"${e.value}"`:""})).filter((e=>""!==e)).join(", ");return t?`{${t}}`:""}function P(e){return{refId:e.refId,expr:S(e),range:!0}}function T(e){const t=[];for(let s in e)if(e[s]instanceof i.Token){let r=e[s];if("context-labels"===r.type){let e="",s="",a="",n=r.content;for(let r in n)if("string"==typeof n[r]){let e;e=n[r],"="!==e&&"!="!==e&&"=~"!==e&&"!~"!==e||(a=e)}else if(n[r]instanceof i.Token)switch(n[r].type){case"label-key":e=n[r].content;break;case"label-value":s=n[r].content,s=s.substring(1,s.length-1);const i=k[a];i&&t.push({name:e,operator:i,value:s})}}}return t}},"./public/app/plugins/datasource/prometheus/querybuilder/PromQueryModeller.ts":(e,t,s)=>{"use strict";s.d(t,{K:()=>O,Z:()=>v});var r=s("./public/app/plugins/datasource/prometheus/promql.ts"),i=s("./public/app/plugins/datasource/prometheus/querybuilder/binaryScalarOperations.ts"),a=s("./public/app/plugins/datasource/prometheus/querybuilder/components/LabelParamEditor.tsx"),n=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/operationUtils.ts"),o=s("./public/app/plugins/datasource/prometheus/querybuilder/types.ts");function l(e){var t,s,r,i,a,l;return Object.assign({},e,{id:e.id,name:null!==(t=e.name)&&void 0!==t?t:(0,n.t7)(e.id),params:null!==(s=e.params)&&void 0!==s?s:[],defaultParams:null!==(r=e.defaultParams)&&void 0!==r?r:[],category:null!==(i=e.category)&&void 0!==i?i:o.C.Functions,renderer:null!==(a=e.renderer)&&void 0!==a?a:e.params?n.zJ:n.pS,addOperationHandler:null!==(l=e.addOperationHandler)&&void 0!==l?l:n.PP})}function u(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{id:e,name:(0,n.t7)(e),params:[(0,n.kq)(t)],defaultParams:[t?"$__rate_interval":"$__interval"],alternativesKey:"range function",category:o.C.RangeFunctions,renderer:h,addOperationHandler:d,changeTypeHandler:c}}function c(e,t){return("$__rate_interval"===e.params[0]&&"$__rate_interval"!==t.defaultParams[0]||"$__interval"===e.params[0]&&"$__interval"!==t.defaultParams[0])&&(e.params=t.defaultParams),e}function h(e,t,s){var r,i;let a=null!==(r=(null!==(i=e.params)&&void 0!==i?i:[])[0])&&void 0!==r?r:"5m";return`${t.id}(${s}[${a}])`}function d(e,t,s){const r={id:e.id,params:e.defaultParams};if(t.operations.length>0){if(s.getOperationDef(t.operations[0].id).addOperationHandler===d)return Object.assign({},t,{operations:[r,...t.operations.slice(1)]})}return Object.assign({},t,{operations:[r,...t.operations]})}function p(e,t){var s;return Object.assign({},t,{binaryQueries:[...null!==(s=t.binaryQueries)&&void 0!==s?s:[],{operator:"/",query:t}]})}function f(e,t,s){if("string"!=typeof e.params[1])throw"The separator must be a string";const r=`"${e.params[1]}"`;return`${e.id}(${s}, "${e.params[0]}", ${r}, "${e.params.slice(2).join(r)}")`}function m(e,t){const s={id:e.id,params:e.defaultParams};return Object.assign({},t,{operations:[...t.operations,s]})}function g(e){return{id:e,name:(0,n.t7)(e),params:[(0,n.kq)()],defaultParams:["$__interval"],alternativesKey:"overtime function",category:o.C.RangeFunctions,renderer:y,addOperationHandler:d}}function y(e,t,s){var r,i;let a=null!==(r=(null!==(i=e.params)&&void 0!==i?i:[])[0])&&void 0!==r?r:"$__interval";return`${t.id}(${s}[${a}])`}var b=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/LokiAndPromQueryModellerBase.ts");class O extends b.x{constructor(){super((()=>{const e=[{id:o.G.HistogramQuantile,name:"Histogram quantile",params:[{name:"Quantile",type:"number",options:[.99,.95,.9,.75,.5,.25]}],defaultParams:[.9],category:o.C.Functions,renderer:n.pS,addOperationHandler:n.PP},{id:o.G.LabelReplace,name:"Label replace",params:[{name:"Destination label",type:"string"},{name:"Replacement",type:"string"},{name:"Source label",type:"string"},{name:"Regex",type:"string"}],category:o.C.Functions,defaultParams:["","$1","","(.*)"],renderer:n.zJ,addOperationHandler:n.PP},{id:o.G.Ln,name:"Ln",params:[],defaultParams:[],category:o.C.Functions,renderer:n.pS,addOperationHandler:n.PP},u(o.G.Changes),u(o.G.Rate,!0),u(o.G.Irate),u(o.G.Increase,!0),u(o.G.Idelta),u(o.G.Delta),l({id:o.G.HoltWinters,params:[(0,n.kq)(),{name:"Smoothing Factor",type:"number"},{name:"Trend Factor",type:"number"}],defaultParams:["$__interval",.5,.5],alternativesKey:"range function",category:o.C.RangeFunctions,renderer:n.e8,addOperationHandler:d,changeTypeHandler:c}),l({id:o.G.PredictLinear,params:[(0,n.kq)(),{name:"Seconds from now",type:"number"}],defaultParams:["$__interval",60],alternativesKey:"range function",category:o.C.RangeFunctions,renderer:n.e8,addOperationHandler:d,changeTypeHandler:c}),l({id:o.G.QuantileOverTime,params:[(0,n.kq)(),{name:"Quantile",type:"number"}],defaultParams:["$__interval",.5],alternativesKey:"overtime function",category:o.C.RangeFunctions,renderer:n.NZ,addOperationHandler:d,changeTypeHandler:c}),...i.EX,{id:o.G.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:o.C.BinaryOps,renderer:(e,t,s)=>s,addOperationHandler:p},l({id:o.G.Absent}),l({id:o.G.Acos,category:o.C.Trigonometric}),l({id:o.G.Acosh,category:o.C.Trigonometric}),l({id:o.G.Asin,category:o.C.Trigonometric}),l({id:o.G.Asinh,category:o.C.Trigonometric}),l({id:o.G.Atan,category:o.C.Trigonometric}),l({id:o.G.Atanh,category:o.C.Trigonometric}),l({id:o.G.Ceil}),l({id:o.G.Clamp,name:"Clamp",params:[{name:"Minimum Scalar",type:"number"},{name:"Maximum Scalar",type:"number"}],defaultParams:[1,1]}),l({id:o.G.ClampMax,params:[{name:"Maximum Scalar",type:"number"}],defaultParams:[1]}),l({id:o.G.ClampMin,params:[{name:"Minimum Scalar",type:"number"}],defaultParams:[1]}),l({id:o.G.Cos,category:o.C.Trigonometric}),l({id:o.G.Cosh,category:o.C.Trigonometric}),l({id:o.G.DayOfMonth,category:o.C.Time}),l({id:o.G.DayOfWeek,category:o.C.Time}),l({id:o.G.DaysInMonth,category:o.C.Time}),l({id:o.G.Deg}),u(o.G.Deriv),l({id:o.G.Exp}),l({id:o.G.Floor}),l({id:o.G.Group}),l({id:o.G.Hour}),l({id:o.G.LabelJoin,params:[{name:"Destination Label",type:"string",editor:a.g},{name:"Separator",type:"string"},{name:"Source Label",type:"string",restParam:!0,optional:!0,editor:a.g}],defaultParams:["",",",""],renderer:f,addOperationHandler:m}),l({id:o.G.Log10}),l({id:o.G.Log2}),l({id:o.G.Minute}),l({id:o.G.Month}),l({id:o.G.Pi,renderer:e=>`${e.id}()`}),l({id:o.G.Quantile,params:[{name:"Value",type:"number"}],defaultParams:[1],renderer:n.pS}),l({id:o.G.Rad}),u(o.G.Resets),l({id:o.G.Round,category:o.C.Functions,params:[{name:"To Nearest",type:"number"}],defaultParams:[1]}),l({id:o.G.Scalar}),l({id:o.G.Sgn}),l({id:o.G.Sin,category:o.C.Trigonometric}),l({id:o.G.Sinh,category:o.C.Trigonometric}),l({id:o.G.Sort}),l({id:o.G.SortDesc}),l({id:o.G.Sqrt}),l({id:o.G.Stddev}),l({id:o.G.Tan,category:o.C.Trigonometric}),l({id:o.G.Tanh,category:o.C.Trigonometric}),l({id:o.G.Time,renderer:e=>`${e.id}()`}),l({id:o.G.Timestamp}),l({id:o.G.Vector,params:[{name:"Value",type:"number"}],defaultParams:[1],renderer:e=>`${e.id}(${e.params[0]})`}),l({id:o.G.Year}),...(0,n.IT)(o.G.Sum),...(0,n.IT)(o.G.Avg),...(0,n.IT)(o.G.Min),...(0,n.IT)(o.G.Max),...(0,n.IT)(o.G.Count),...(0,n.Z3)(o.G.TopK,{params:[{name:"K-value",type:"number"}],defaultParams:[5]}),...(0,n.Z3)(o.G.BottomK,{params:[{name:"K-value",type:"number"}],defaultParams:[5]}),...(0,n.Z3)(o.G.CountValues,{params:[{name:"Identifier",type:"string"}],defaultParams:["count"]}),g(o.G.SumOverTime),g(o.G.AvgOverTime),g(o.G.MinOverTime),g(o.G.MaxOverTime),g(o.G.CountOverTime),g(o.G.LastOverTime),g(o.G.PresentOverTime),g(o.G.AbsentOverTime),g(o.G.StddevOverTime)];for(const t of e){const e=r.r8.find((e=>e.insertText===t.id));e&&(t.documentation=e.documentation)}return e})),this.setOperationCategories([o.C.Aggregations,o.C.RangeFunctions,o.C.Functions,o.C.BinaryOps,o.C.Trigonometric,o.C.Time])}getQueryPatterns(){return[{name:"Rate then sum",operations:[{id:"rate",params:["$__rate_interval"]},{id:"sum",params:[]}]},{name:"Rate then sum by(label) then avg",operations:[{id:"rate",params:["$__rate_interval"]},{id:"__sum_by",params:[""]},{id:"avg",params:[]}]},{name:"Histogram quantile on rate",operations:[{id:"rate",params:["$__rate_interval"]},{id:"__sum_by",params:["le"]},{id:"histogram_quantile",params:[.95]}]},{name:"Histogram quantile on increase ",operations:[{id:"increase",params:["$__rate_interval"]},{id:"__max_by",params:["le"]},{id:"histogram_quantile",params:[.95]}]}]}}const v=new O},"./public/app/plugins/datasource/prometheus/querybuilder/binaryScalarOperations.ts":(e,t,s)=>{"use strict";s.d(t,{EX:()=>o,PX:()=>n,iQ:()=>a});var r=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/operationUtils.ts"),i=s("./public/app/plugins/datasource/prometheus/querybuilder/types.ts");const a=[{id:i.G.Addition,name:"Add scalar",sign:"+"},{id:i.G.Subtraction,name:"Subtract scalar",sign:"-"},{id:i.G.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:i.G.DivideBy,name:"Divide by scalar",sign:"/"},{id:i.G.Modulo,name:"Modulo by scalar",sign:"%"},{id:i.G.Exponent,name:"Exponent",sign:"^"},{id:i.G.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:i.G.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:i.G.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:i.G.LessThan,name:"Less than",sign:"<",comparison:!0},{id:i.G.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:i.G.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],n=a.reduce(((e,t)=>(e[t.sign]={id:t.id,comparison:t.comparison},e)),{}),o=a.map((e=>{const t=[{name:"Value",type:"number"}],s=[2];return e.comparison&&(t.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),s.push(!1)),{id:e.id,name:e.name,params:t,defaultParams:s,alternativesKey:"binary scalar operations",category:i.C.BinaryOps,renderer:(a=e.sign,function(e,t,s){let r=e.params[0],i="";return 2===e.params.length&&(i=e.params[1]?" bool":""),`${s} ${a}${i} ${r}`}),addOperationHandler:r.PP};var a}))},"./public/app/plugins/datasource/prometheus/querybuilder/components/LabelParamEditor.tsx":(e,t,s)=>{"use strict";s.d(t,{g:()=>c});var r=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=s("./packages/grafana-data/src/index.ts"),a=s("./packages/grafana-ui/src/index.ts"),n=s("./public/app/plugins/datasource/prometheus/datasource.tsx"),o=s("./public/app/plugins/datasource/prometheus/querybuilder/PromQueryModeller.ts"),l=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/operationUtils.ts"),u=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function c(e){let{onChange:t,index:s,operationIndex:c,value:h,query:d,datasource:p}=e;const[f,m]=(0,r.useState)({});return(0,u.jsx)(a.Select,{inputId:(0,l.i1)(c,s),menuShouldPortal:!0,autoFocus:""===h||void 0,openMenuOnFocus:!0,onOpenMenu:async()=>{m({isLoading:!0});const e=await async function(e,t){let s=e.labels;t instanceof n.vQ&&(s=[{label:"__name__",op:"=",value:e.metric},...e.labels]);const r=o.Z.renderLabels(s),i=await t.languageProvider.fetchSeriesLabels(r);return Object.keys(i).map((e=>({label:e,value:e})))}(d,p);m({options:e,isLoading:void 0})},isLoading:f.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:f.options,value:(0,i.toOption)(h),onChange:e=>t(s,e.value)})}},"./public/app/plugins/datasource/prometheus/querybuilder/parsing.ts":(e,t,s)=>{"use strict";s.d(t,{_:()=>n});var r=s("./.yarn/__virtual__/lezer-promql-virtual-eaf88aa77a/3/opt/drone/yarncache/lezer-promql-npm-0.22.0-867da6afaa-cdce054700.zip/node_modules/lezer-promql/index.es.js"),i=s("./public/app/plugins/datasource/prometheus/querybuilder/binaryScalarOperations.ts"),a=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/parsingUtils.ts");function n(e){const t=(0,a.bU)(e),s=r.E2.parse(t).topNode,i={query:{metric:"",labels:[],operations:[]},errors:[]};try{o(t,s,i)}catch(e){console.error(e),i.errors.push({text:e.message})}return function(e){if(0===e.labels.length&&0===e.operations.length&&!e.metric)return!0;return!1}(i.query)&&(i.errors=[]),i}function o(e,t,s){const r=s.query;switch(t.name){case"MetricIdentifier":r.metric=(0,a.KF)(e,t);break;case"LabelMatcher":{r.labels.push(function(e,t){const s=(0,a.KF)(e,t.getChild("LabelName")),r=(0,a.KF)(e,t.getChild("MatchOp")),i=(0,a.KF)(e,t.getChild("StringLiteral")).replace(/"/g,"");return{label:s,op:r,value:i}}(e,t));const i=t.getChild(a.GQ);i&&s.errors.push((0,a.wf)(e,i));break}case"FunctionCall":!function(e,t,s){const r=s.query,i=t.getChild("FunctionIdentifier"),n=(0,a.KF)(e,i),o=t.getChild("FunctionCallBody").getChild("FunctionCallArgs"),c=[];let h="";if(l.includes(n)||n.endsWith("_over_time")){let s=(0,a.KF)(e,t).match(/\[(.+)\]/);null!=s&&s[1]&&(h=s[1],c.push(s[1]))}const d={id:n,params:c};if(r.operations.unshift(d),o){if((0,a.KF)(e,o)===h+"]")return;u(e,o,s,d)}}(e,t,s);break;case"AggregateExpr":!function(e,t,s){const r=s.query,i=t.getChild("AggregateOp");let n=(0,a.KF)(e,i);const o=t.getChild("AggregateModifier"),l=[];if(o){o.getChild("By")&&n&&(n=`__${n}_by`);o.getChild("Without")&&(n=`__${n}_without`),l.push(...(0,a.ff)(e,o,"GroupingLabel"))}const c=t.getChild("FunctionCallBody").getChild("FunctionCallArgs"),h={id:n,params:[]};r.operations.unshift(h),u(e,c,s,h),h.params.push(...l)}(e,t,s);break;case"BinaryExpr":!function(e,t,s){const r=s.query,n=t.firstChild,l=(0,a.KF)(e,n.nextSibling),u=function(e,t){if(!t)return;if(t.getChild("Bool"))return{isBool:!0,isMatcher:!1};{var s;const r=t.getChild("OnOrIgnoring");if(!r)return;return{isMatcher:!0,isBool:!1,matches:(0,a.KF)(e,null===(s=r.getChild("GroupingLabels"))||void 0===s?void 0:s.getChild("GroupingLabelList")),matchType:r.getChild("On")?"on":"ignoring"}}}(e,t.getChild("BinModifiers")),c=t.lastChild,h=i.PX[l],d=n.getChild("NumberLiteral"),p=c.getChild("NumberLiteral"),f=c.getChild("BinaryExpr");d||o(e,n,s);if(p)r.operations.push((0,a.Es)(h,e,c,!(null==u||!u.isBool)));else if(f){const t=(0,a.ge)(c);"NumberLiteral"===(null==t?void 0:t.name)&&r.operations.push((0,a.Es)(h,e,t,!(null==u||!u.isBool))),o(e,c,s)}else{r.binaryQueries=r.binaryQueries||[];const t={operator:l,query:{metric:"",labels:[],operations:[]}};null!=u&&u.isMatcher&&(t.vectorMatchesType=u.matchType,t.vectorMatches=u.matches),r.binaryQueries.push(t),o(e,c,{query:t.query,errors:s.errors})}}(e,t,s);break;case a.GQ:if(function(e){var t,s,r;return"Expr"===(null===(t=e.prevSibling)||void 0===t?void 0:t.name)&&"VectorSelector"===(null===(s=e.prevSibling)||void 0===s||null===(r=s.firstChild)||void 0===r?void 0:r.name)}(t))break;s.errors.push((0,a.wf)(e,t));break;default:{"ParenExpr"===t.name&&s.errors.push((0,a.wf)(e,t));let r=t.firstChild;for(;r;)o(e,r,s),r=r.nextSibling}}}const l=["changes","rate","irate","increase","delta"];function u(e,t,s,r){if(t)switch(t.name){case"Expr":case"FunctionCallArgs":{let i=t.firstChild;for(;i;)u(e,i,s,r),i=i.nextSibling;break}case"NumberLiteral":r.params.push(parseFloat((0,a.KF)(e,t)));break;case"StringLiteral":r.params.push((0,a.KF)(e,t).replace(/"/g,""));break;default:o(e,t,s)}}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/AutoSizeInput.tsx":(e,t,s)=>{"use strict";s.d(t,{H:()=>o});var r=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=s("./packages/grafana-ui/src/index.ts"),a=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const n=["defaultValue","minWidth","maxWidth","onCommitChange","onKeyDown","onBlur"];const o=r.forwardRef(((e,t)=>{const{defaultValue:s="",minWidth:o=10,maxWidth:l,onCommitChange:u,onKeyDown:c,onBlur:h}=e,d=function(e,t){if(null==e)return{};var s,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)s=a[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,n),[p,f]=r.useState(s),[m,g]=r.useState(o);return(0,r.useEffect)((()=>{g(function(e,t,s){if(!e)return t;const r=3,a=(0,i.measureText)(e.toString(),14).width/8+r;if(t&&a<t)return t;if(s&&a>s)return a;return a}(p.toString(),o,l))}),[p,l,o]),(0,a.jsx)(i.Input,Object.assign({},d,{ref:t,value:p.toString(),onChange:e=>{f(e.currentTarget.value)},width:m,onBlur:e=>{u&&u(e),h&&h(e)},onKeyDown:e=>{"Enter"===e.key&&u&&u(e),c&&c(e)},"data-testid":"autosize-input"}))}));o.displayName="AutoSizeInput"},"./public/app/plugins/datasource/prometheus/querybuilder/shared/LabelFilters.tsx":(e,t,s)=>{"use strict";s.d(t,{P:()=>h});var r=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),i=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),a=s("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/3/opt/drone/yarncache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),n=s("./packages/grafana-data/src/index.ts"),o=s("./packages/grafana-ui/src/index.ts"),l=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function u(e){var t;let{item:s,defaultOp:r,onChange:u,onDelete:h,onGetLabelNames:d,onGetLabelValues:p}=e;const[f,m]=(0,i.useState)({}),g=()=>s.op===c[0].label,y=e=>e?e.indexOf("|")>0?e.split("|"):[e]:[];return(0,l.jsx)("div",{"data-testid":"prometheus-dimensions-filter-item",children:(0,l.jsxs)(a.InputGroup,{children:[(0,l.jsx)(o.Select,{inputId:"prometheus-dimensions-filter-item-key",width:"auto",value:s.label?(0,n.toOption)(s.label):null,allowCustomValue:!0,onOpenMenu:async()=>{m({isLoadingLabelNames:!0});const e=await d(s);m({labelNames:e,isLoadingLabelNames:void 0})},isLoading:f.isLoadingLabelNames,options:f.labelNames,onChange:e=>{var t;e.label&&u(Object.assign({},s,{op:null!==(t=s.op)&&void 0!==t?t:r,label:e.label}))}}),(0,l.jsx)(o.Select,{value:(0,n.toOption)(null!==(t=s.op)&&void 0!==t?t:r),options:c,width:"auto",onChange:e=>{null!=e.value&&u(Object.assign({},s,{op:e.value}))}}),(0,l.jsx)(o.Select,{inputId:"prometheus-dimensions-filter-item-value",width:"auto",value:g()?y(null==s?void 0:s.value).map(n.toOption):y(null==s?void 0:s.value).map(n.toOption)[0],allowCustomValue:!0,onOpenMenu:async()=>{m({isLoadingLabelValues:!0});const e=await p(s);m(Object.assign({},f,{labelValues:e,isLoadingLabelValues:void 0}))},isMulti:g(),isLoading:f.isLoadingLabelValues,options:[...y(null==s?void 0:s.value).map(n.toOption),...null!==(b=f.labelValues)&&void 0!==b?b:[]],onChange:e=>{if(e.value){var t;u(Object.assign({},s,{value:e.value,op:null!==(t=s.op)&&void 0!==t?t:r}))}else{var i;const t=e.map((e=>e.label)).join("|");u(Object.assign({},s,{value:t,op:null!==(i=s.op)&&void 0!==i?i:r}))}}}),(0,l.jsx)(a.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:h})]})});var b}const c=[{label:"=~",value:"=~"},{label:"=",value:"="},{label:"!=",value:"!="},{label:"!~",value:"!~"}];function h(e){let{labelsFilters:t,onChange:s,onGetLabelNames:n,onGetLabelValues:o}=e;const[c,h]=(0,i.useState)([{op:"="}]);(0,i.useEffect)((()=>{t.length>0?h(t):h([{op:"="}])}),[t]);return(0,l.jsx)(a.EditorFieldGroup,{children:(0,l.jsx)(a.EditorField,{label:"Labels",children:(0,l.jsx)(a.EditorList,{items:c,onChange:e=>{h(e);const i=e.filter((e=>null!=e.label&&null!=e.value));(0,r.isEqual)(i,t)||s(i)},renderItem:(e,t,s)=>(0,l.jsx)(u,{item:e,defaultOp:"=",onChange:t,onDelete:s,onGetLabelNames:n,onGetLabelValues:o})})})})}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/LokiAndPromQueryModellerBase.ts":(e,t,s)=>{"use strict";s.d(t,{x:()=>n});var r=s("./packages/grafana-data/src/index.ts"),i=s("./public/app/plugins/datasource/prometheus/querybuilder/types.ts");function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class n{constructor(e){a(this,"operationsRegisty",void 0),a(this,"categories",[]),this.operationsRegisty=new r.Registry(e)}setOperationCategories(e){this.categories=e}getOperationsForCategory(e){return this.operationsRegisty.list().filter((t=>t.category===e&&!t.hideFromList))}getAlternativeOperations(e){return this.operationsRegisty.list().filter((t=>t.alternativesKey===e))}getCategories(){return this.categories}getOperationDef(e){return this.operationsRegisty.getIfExists(e)}renderOperations(e,t){for(const s of t){const t=this.operationsRegisty.getIfExists(s.id);if(!t)throw new Error(`Could not find operation ${s.id} in the registry`);e=t.renderer(s,t,e)}return e}renderBinaryQueries(e,t){if(t)for(const s of t)e=`${this.renderBinaryQuery(e,s)}`;return e}renderBinaryQuery(e,t){let s=e+` ${t.operator} `;return t.vectorMatches&&(s+=`${t.vectorMatchesType}(${t.vectorMatches}) `),s+this.renderQuery(t.query,!0)}renderLabels(e){if(0===e.length)return"";let t="{";for(const s of e)"{"!==t&&(t+=", "),t+=`${s.label}${s.op}"${s.value}"`;return t+"}"}renderQuery(e,t){var s,r,i;let a=`${null!==(s=e.metric)&&void 0!==s?s:""}${this.renderLabels(e.labels)}`;return a=this.renderOperations(a,e.operations),!t&&this.hasBinaryOp(e)&&Boolean(null===(r=e.binaryQueries)||void 0===r?void 0:r.length)&&(a=`(${a})`),a=this.renderBinaryQueries(a,e.binaryQueries),t&&(this.hasBinaryOp(e)||Boolean(null===(i=e.binaryQueries)||void 0===i?void 0:i.length))&&(a=`(${a})`),a}hasBinaryOp(e){return void 0!==e.operations.find((e=>{const t=this.getOperationDef(e.id);return(null==t?void 0:t.category)===i.C.BinaryOps}))}}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox.tsx":(e,t,s)=>{"use strict";s.d(t,{B:()=>o});var r=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=(s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s("./packages/grafana-data/src/index.ts")),a=s("./packages/grafana-ui/src/index.ts"),n=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function o(e){let{title:t,stepNumber:s,markdown:r,children:o}=e;const u=(0,a.useStyles2)(l);return(0,n.jsxs)("div",{className:u.box,children:[(0,n.jsx)("div",{className:u.stepNumber,children:s}),(0,n.jsxs)("div",{className:u.boxInner,children:[(0,n.jsx)("div",{className:u.header,children:(0,n.jsx)("span",{children:t})}),(0,n.jsxs)("div",{className:u.body,children:[r&&(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:(0,i.renderMarkdown)(r)}}),o]})]})]})}const l=e=>({box:(0,r.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.borderRadius(),position:"relative",marginBottom:e.spacing(.5)}),boxInner:(0,r.css)({marginLeft:e.spacing(4)}),stepNumber:(0,r.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,r.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,r.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})})},"./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationList.tsx":(e,t,s)=>{"use strict";s.d(t,{P:()=>Q});var r,i=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),a=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=s("./.yarn/__virtual__/react-beautiful-dnd-virtual-27e4b658e7/3/opt/drone/yarncache/react-beautiful-dnd-npm-13.1.0-fcf5568b1c-12b7e9fbe8.zip/node_modules/react-beautiful-dnd/dist/react-beautiful-dnd.esm.js"),o=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useMountedState.js"),l=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js"),u=s("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/3/opt/drone/yarncache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),c=s("./packages/grafana-ui/src/index.ts"),h=s("./.yarn/__virtual__/react-popper-tooltip-virtual-d9d7047333/3/opt/drone/yarncache/react-popper-tooltip-npm-4.3.1-91318ee546-82ae84c3b7.zip/node_modules/react-popper-tooltip/dist/esm/react-popper-tooltip.js"),d=s("./packages/grafana-data/src/index.ts"),p=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const f=a.memo((e=>{let{def:t,operation:s}=e;const i=(0,c.useStyles2)(m),[n,o]=(0,a.useState)(!1),{getTooltipProps:l,setTooltipRef:d,setTriggerRef:f,visible:y}=(0,h.O)({placement:"top",visible:n,offset:[0,16],onVisibleChange:o,interactive:!0,trigger:["click"]});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.Button,{title:"Click to show description",ref:f,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),y&&(0,p.jsx)(c.Portal,{children:(0,p.jsxs)("div",Object.assign({ref:d},l(),{className:i.docBox,children:[(0,p.jsxs)("div",{className:i.docBoxHeader,children:[(0,p.jsx)("span",{children:t.renderer(s,t,"<expr>")}),r||(r=(0,p.jsx)(u.FlexItem,{grow:1})),(0,p.jsx)(c.Button,{icon:"times",onClick:()=>o(!1),fill:"text",variant:"secondary",title:"Remove operation"})]}),(0,p.jsx)("div",{className:i.docBoxBody,dangerouslySetInnerHTML:{__html:g(t,s)}})]}))})]})}));f.displayName="OperationDocs";const m=e=>({docBox:(0,i.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.borderRadius(),zIndex:e.zIndex.tooltip}),docBoxHeader:(0,i.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,i.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,i.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,i.css)({opacity:0,color:e.colors.text.secondary})});function g(e,t){var s;return(0,d.renderMarkdown)(e.explainHandler?e.explainHandler(t,e):null!==(s=e.documentation)&&void 0!==s?s:"no docs")}var y;const b=a.memo((e=>{var t;let{operation:s,def:r,index:i,onChange:n,onRemove:o,queryModeller:l,dragHandleProps:h}=e;const d=(0,c.useStyles2)(O),[m,g]=(0,a.useState)({}),b=()=>{if(m.isOpen)g(Object.assign({},m,{isOpen:!1}));else{const e=l.getAlternativeOperations(r.alternativesKey).map((e=>({label:e.name,value:e})));g({isOpen:!0,alternatives:e})}};return(0,p.jsxs)("div",{className:d.header,children:[!m.isOpen&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",Object.assign({},h,{children:null!==(t=r.name)&&void 0!==t?t:r.id})),y||(y=(0,p.jsx)(u.FlexItem,{grow:1})),(0,p.jsxs)("div",{className:`${d.operationHeaderButtons} operation-header-show-on-hover`,children:[(0,p.jsx)(c.Button,{icon:"angle-down",size:"sm",onClick:b,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),(0,p.jsx)(f,{def:r,operation:s}),(0,p.jsx)(c.Button,{icon:"times",size:"sm",onClick:()=>o(i),fill:"text",variant:"secondary",title:"Remove operation"})]})]}),m.isOpen&&(0,p.jsx)("div",{className:d.selectWrapper,children:(0,p.jsx)(c.Select,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:m.alternatives,isOpen:!0,onCloseMenu:b,onChange:e=>{if(e.value){const t=l.getOperationDef(e.value.id);let a=Object.assign({},s,{id:e.value.id});n(i,r.changeTypeHandler?r.changeTypeHandler(a,t):a)}}})})]})}));b.displayName="OperationHeader";const O=e=>({header:(0,i.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center","&:hover .operation-header-show-on-hover":(0,i.css)({opacity:1})}),operationHeaderButtons:(0,i.css)({opacity:0,transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short})}),selectWrapper:(0,i.css)({paddingRight:e.spacing(2)})});var v=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/AutoSizeInput.tsx"),x=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/operationUtils.ts");function _(e){return e.editor?e.editor:e.options?w:"boolean"===e.type?k:$}function $(e){var t;return(0,p.jsx)(v.H,{id:(0,x.i1)(e.operationIndex,e.index),defaultValue:null===(t=e.value)||void 0===t?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,onCommitChange:t=>{e.onChange(e.index,t.currentTarget.value)}})}function k(e){return(0,p.jsx)(c.Checkbox,{id:(0,x.i1)(e.operationIndex,e.index),value:e.value,onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function w(e){var t,s;let{paramDef:r,value:i,index:a,operationIndex:n,onChange:o}=e,l=r.options;null!==(t=l[0])&&void 0!==t&&t.label||(l=r.options.map((e=>({label:e.toString(),value:e}))));let u=null!==(s=l.find((e=>e.value===i)))&&void 0!==s?s:(0,d.toOption)(i);return(0,p.jsx)(c.Select,{id:(0,x.i1)(n,a),menuShouldPortal:!0,value:u,options:l,placeholder:r.placeholder,allowCustomValue:!0,onChange:e=>o(a,e.value)})}function S(e){let{operation:t,index:s,onRemove:r,onChange:o,onRunQuery:l,queryModeller:h,query:d,datasource:f,highlight:m}=e;const g=(0,c.useStyles2)(T),y=h.getOperationDef(t.id),O=function(e){const[t,s]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{let t;return e?t=setTimeout((()=>{s(!1)}),1):s(!0),()=>clearTimeout(t)}),[e]),t&&e}(m);if(!y)return(0,p.jsxs)("span",{children:["Operation ",t.id," not found"]});const v=(e,r)=>{const i=Object.assign({},t,{params:[...t.params]});i.params[e]=r,P(y,i,s,e,o)},$=()=>{const e=Object.assign({},t,{params:[...t.params,""]});P(y,e,s,t.params.length,o)},k=e=>{const r=Object.assign({},t,{params:[...t.params.slice(0,e),...t.params.slice(e+1)]});P(y,r,s,e,o)},w=[];for(let e=0;e<t.params.length;e++){const r=y.params[Math.min(y.params.length-1,e)],i=_(r);w.push((0,p.jsxs)("div",{className:g.paramRow,children:[!r.hideName&&(0,p.jsxs)("div",{className:g.paramName,children:[(0,p.jsx)("label",{htmlFor:(0,x.i1)(s,e),children:r.name}),r.description&&(0,p.jsx)(c.Tooltip,{placement:"top",content:r.description,theme:"info",children:(0,p.jsx)(c.Icon,{name:"info-circle",size:"sm",className:g.infoIcon})})]}),(0,p.jsx)("div",{className:g.paramValue,children:(0,p.jsxs)(u.Stack,{gap:.5,direction:"row",alignItems:"center",wrap:!1,children:[(0,p.jsx)(i,{index:e,paramDef:r,value:t.params[e],operation:t,operationIndex:s,onChange:v,onRunQuery:l,query:d,datasource:f}),r.restParam&&(t.params.length>y.params.length||r.optional)&&(0,p.jsx)(c.Button,{"data-testid":`operations.${s}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${r.name}`,onClick:()=>k(e)})]})})]},`${e}-1`))}let S;if(y.params.length>0){const e=y.params[y.params.length-1];e.restParam&&(S=function(e,t,s,r,i){return(0,p.jsx)("div",{className:i.restParam,children:(0,p.jsx)(c.Button,{size:"sm",icon:"plus",title:`Add ${e.name}`,variant:"secondary",onClick:t,"data-testid":`operations.${s}.add-rest-param`,children:e.name})},`${r}-2`)}(e,$,s,t.params.length,g))}return(0,p.jsx)(n._l,{draggableId:`operation-${s}`,index:s,children:e=>(0,p.jsxs)("div",Object.assign({className:(0,i.cx)(g.card,O&&g.cardHighlight),ref:e.innerRef},e.draggableProps,{"data-testid":`operations.${s}.wrapper`,children:[(0,p.jsx)(b,{operation:t,dragHandleProps:e.dragHandleProps,def:y,index:s,onChange:o,onRemove:r,queryModeller:h}),(0,p.jsx)("div",{className:g.body,children:w}),S,s<d.operations.length-1&&(0,p.jsxs)("div",{className:g.arrow,children:[(0,p.jsx)("div",{className:g.arrowLine}),(0,p.jsx)("div",{className:g.arrowArrow})]})]}))})}function P(e,t,s,r,i){e.paramChangedHandler?i(s,e.paramChangedHandler(r,t,e)):i(s,t)}const T=e=>({card:(0,i.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,display:"flex",flexDirection:"column",cursor:"grab",borderRadius:e.shape.borderRadius(1),marginBottom:e.spacing(1),position:"relative",transition:"all 1s ease-in 0s"}),cardHighlight:(0,i.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,i.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,i.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,i.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,i.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,i.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,i.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,i.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,i.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,i.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function Q(e){let{query:t,datasource:s,queryModeller:r,onChange:i,onRunQuery:h}=e;const d=(0,c.useStyles2)(C),{operations:f}=t,m=function(e){const t=(0,o.Z)(),s=(0,l.Z)(e);if(!t())return e.map((()=>!1));if(!s)return e.map((()=>!0));let r=[];if(s.length-1===e.length&&e.every((e=>s.includes(e))))return e.map((()=>!1));if(s.length+1===e.length&&s.every((t=>e.includes(t)))){const t=e.find((e=>!s.includes(e)));r=e.map((e=>e===t))}else r=e.map(((e,t)=>{var r,i,a;return i=e.id,a=null===(r=s[t])||void 0===r?void 0:r.id,!(i===a||`__${i}_by`===a||i===`__${a}_by`)}));return r}(f),[g,y]=(0,a.useState)(!1),b=(e,s)=>{const r=[...f];r.splice(e,1,s),i(Object.assign({},t,{operations:r}))},O=e=>{const s=[...f.slice(0,e),...f.slice(e+1)];i(Object.assign({},t,{operations:s}))},v=r.getCategories().map((e=>({value:e,label:e,items:r.getOperationsForCategory(e).map((e=>({value:e.id,label:e.name,isLeaf:!0})))})));return(0,p.jsx)(u.Stack,{gap:1,direction:"column",children:(0,p.jsxs)(u.Stack,{gap:1,children:[f.length>0&&(0,p.jsx)(n.Z5,{onDragEnd:e=>{if(!e.destination)return;const s=[...f],r=s[e.source.index];s.splice(e.source.index,1),s.splice(e.destination.index,0,r),i(Object.assign({},t,{operations:s}))},children:(0,p.jsx)(n.bK,{droppableId:"sortable-field-mappings",direction:"horizontal",children:e=>(0,p.jsxs)("div",Object.assign({className:d.operationList,ref:e.innerRef},e.droppableProps,{children:[f.map(((e,i)=>(0,p.jsx)(S,{queryModeller:r,index:i,operation:e,query:t,datasource:s,onChange:b,onRemove:O,onRunQuery:h,highlight:m[i]},e.id+i))),e.placeholder]}))})}),(0,p.jsx)("div",{className:d.addButton,children:g?(0,p.jsx)(c.Cascader,{options:v,onSelect:e=>{const s=r.getOperationDef(e);s&&(i(s.addOperationHandler(s,t,r)),y(!1))},onBlur:()=>{y(!1)},autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):(0,p.jsx)(c.Button,{icon:"plus",variant:"secondary",onClick:()=>y(!0),title:"Add operation",children:"Operations"})})]})})}const C=e=>({heading:(0,i.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,i.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,i.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})})},"./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationListExplained.tsx":(e,t,s)=>{"use strict";s.d(t,{V:()=>a});s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var r=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox.tsx"),i=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function a(e){let{query:t,queryModeller:s,stepNumber:a}=e;return(0,i.jsx)(i.Fragment,{children:t.operations.map(((e,t)=>{var n;const o=s.getOperationDef(e.id);if(!o)return`Operation ${e.id} not found`;const l=o.renderer(e,o,"<expr>"),u=o.explainHandler?o.explainHandler(e,o):null!==(n=o.documentation)&&void 0!==n?n:"no docs";return(0,i.jsx)(r.B,{stepNumber:t+a,title:l,markdown:u},t)}))})}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationsEditorRow.tsx":(e,t,s)=>{"use strict";s.d(t,{B:()=>o});var r=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=(s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/3/opt/drone/yarncache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js")),a=s("./packages/grafana-ui/src/index.ts"),n=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function o(e){let{children:t}=e;const s=(0,a.useStyles2)(l);return(0,n.jsx)("div",{className:s.root,children:(0,n.jsx)(i.Stack,{gap:1,children:t})})}const l=e=>({root:(0,r.css)({padding:e.spacing(1,1,0,1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})})},"./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryEditorModeToggle.tsx":(e,t,s)=>{"use strict";s.d(t,{k:()=>l});var r=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=(s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s("./packages/grafana-ui/src/index.ts")),a=s("./public/app/plugins/datasource/prometheus/querybuilder/shared/types.ts"),n=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const o=[{label:"Explain",value:a.c.Explain},{label:"Builder",value:a.c.Builder,component:()=>(0,n.jsx)(i.Tag,{className:(0,r.css)({fontSize:10,padding:"1px 5px",verticalAlign:"text-bottom"}),name:"Beta",colorIndex:1})},{label:"Code",value:a.c.Code}];function l(e){let{mode:t,onChange:s}=e;return(0,n.jsx)("div",{"data-testid":"QueryEditorModeToggle",children:(0,n.jsx)(i.RadioButtonGroup,{options:o,size:"sm",value:t,onChange:s})})}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryOptionGroup.tsx":(e,t,s)=>{"use strict";s.d(t,{d:()=>l});var r=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=(s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useToggle.js")),a=s("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/3/opt/drone/yarncache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),n=s("./packages/grafana-ui/src/index.ts"),o=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function l(e){let{title:t,children:s,collapsedInfo:r}=e;const[l,c]=(0,i.Z)(!1),h=(0,n.useStyles2)(u);return(0,o.jsxs)(a.Stack,{gap:0,direction:"column",children:[(0,o.jsxs)("div",{className:h.header,onClick:c,title:"Click to edit options",children:[(0,o.jsx)("div",{className:h.toggle,children:(0,o.jsx)(n.Icon,{name:l?"angle-down":"angle-right"})}),(0,o.jsx)("h6",{className:h.title,children:t}),!l&&(0,o.jsx)("div",{className:h.description,children:r.map(((e,t)=>(0,o.jsx)("span",{children:e},t)))})]}),l&&(0,o.jsx)("div",{className:h.body,children:s})]})}const u=e=>({switchLabel:(0,r.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}}),header:(0,r.css)({display:"flex",cursor:"pointer",alignItems:"baseline",color:e.colors.text.primary,"&:hover":{background:e.colors.emphasize(e.colors.background.primary,.03)}}),title:(0,r.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,r.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,r.css)({display:"flex",paddingTop:e.spacing(2),gap:e.spacing(2),flexWrap:"wrap"}),toggle:(0,r.css)({color:e.colors.text.secondary,marginRight:`${e.spacing(1)}`})})},"./public/app/plugins/datasource/prometheus/querybuilder/shared/operationUtils.ts":(e,t,s)=>{"use strict";s.d(t,{IT:()=>b,NZ:()=>d,PP:()=>f,Z3:()=>O,e8:()=>h,i1:()=>g,kq:()=>y,pS:()=>l,t7:()=>m,zJ:()=>u});var r=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),i=s("../../opt/drone/yarncache/pluralize-npm-8.0.0-f5f044ed52-08931d4a6a.zip/node_modules/pluralize/pluralize.js"),a=s.n(i),n=s("./public/app/plugins/datasource/prometheus/querybuilder/components/LabelParamEditor.tsx"),o=s("./public/app/plugins/datasource/prometheus/querybuilder/types.ts");function l(e,t,s){const r=p(e,t,s),i=e.id+"(";return s&&r.push(s),i+r.join(", ")+")"}function u(e,t,s){const r=p(e,t,s),i=e.id+"(";return s&&r.unshift(s),i+r.join(", ")+")"}function c(e,t,s,r){var i,a;if(t.params.length<2)throw`Cannot render a function with params of length [${t.params.length}]`;let n=null!==(i=(null!==(a=e.params)&&void 0!==a?a:[])[0])&&void 0!==i?i:"5m";const o=p(Object.assign({},e,{params:e.params.slice(1)}),Object.assign({},t,{params:t.params.slice(1),defaultParams:t.defaultParams.slice(1)}),s),l=e.id+"(";return s&&(r?o.push(`${s}[${n}]`):o.unshift(`${s}[${n}]`)),l+o.join(", ")+")"}function h(e,t,s){return c(e,t,s,!1)}function d(e,t,s){return c(e,t,s,!0)}function p(e,t,s){var r;return(null!==(r=e.params)&&void 0!==r?r:[]).map(((e,s)=>"string"===t.params[s].type?'"'+e+'"':e))}function f(e,t){const s={id:e.id,params:e.defaultParams};return Object.assign({},t,{operations:[...t.operations,s]})}function m(e){return(0,r.capitalize)(e.replace(/_/g," "))}function g(e,t){return`operations.${e}.param.${t}`}function y(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={name:"Range",type:"string",options:[{label:"$__interval",value:"$__interval"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"1h",value:"1h"},{label:"24h",value:"24h"}]};return e&&t.options.unshift({label:"$__rate_interval",value:"$__rate_interval"}),t}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[Object.assign({id:e,name:m(e),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],alternativesKey:"plain aggregations",category:o.C.Aggregations,renderer:l,paramChangedHandler:w(`__${e}_by`),explainHandler:_(e,""),addOperationHandler:f},t),Object.assign({id:`__${e}_by`,name:`${m(e)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:n.g}],defaultParams:[""],alternativesKey:"aggregations by",category:o.C.Aggregations,renderer:v(e),paramChangedHandler:k(e),explainHandler:_(e,"by"),addOperationHandler:f,hideFromList:!0},t),Object.assign({id:`__${e}_without`,name:`${m(e)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:n.g}],defaultParams:[""],alternativesKey:"aggregations by",category:o.C.Aggregations,renderer:x(e),paramChangedHandler:k(e),explainHandler:_(e,"without"),addOperationHandler:f,hideFromList:!0},t)];return s}function O(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=b(e,s);return r[0].params.unshift(...t.params),r[1].params.unshift(...t.params),r[2].params.unshift(...t.params),r[0].defaultParams=t.defaultParams,r[1].defaultParams=[...t.defaultParams,""],r[2].defaultParams=[...t.defaultParams,""],r[1].renderer=$(e),r[2].renderer=$(e),r}function v(e){return function(t,s,r){return`${e} by(${t.params.join(", ")}) (${r})`}}function x(e){return function(t,s,r){return`${e} without(${t.params.join(", ")}) (${r})`}}function _(e,t){return function(s){const r=s.params.map((e=>`\`${e}\``)).join(" and "),i=a()("label",s.params.length);switch(t){case"by":return`Calculates ${e} over dimensions while preserving ${i} ${r}.`;case"without":return`Calculates ${e} over the dimensions ${r}. All other labels are preserved.`;default:return`Calculates ${e} over the dimensions.`}}}function $(e){return function(t,s,r){const i=t.params.slice(0,-1),a=t.params.slice(1);return`${e} by(${a.join(", ")}) (${i.map((function(e){return"string"==typeof e?`"${e}"`:e})).join(", ")}, ${r})`}}function k(e){return function(t,s,r){return s.params.length<r.params.length?Object.assign({},s,{id:e}):s}}function w(e){return function(t,s,r){return s.params.length===r.params.length?Object.assign({},s,{id:e}):s}}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/parsingUtils.ts":(e,t,s)=>{"use strict";s.d(t,{Es:()=>c,GQ:()=>r,KF:()=>u,bU:()=>o,ff:()=>h,ge:()=>i,wf:()=>a});const r="⚠";function i(e){return e.firstChild?i(e.firstChild):e}function a(e,t){var s;return{text:u(e,t),from:t.from,to:t.to,parentType:null===(s=t.parent)||void 0===s?void 0:s.name}}const n=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function o(e){return e.replace(n,((e,t,s,r,i,a,n)=>{const o=r||n;let l=t,u="0";return s&&(l=s,u="1"),i&&(l=i,u="2"),`__V_${u}__`+l+"__V__"+(o?"__F__"+o+"__F__":"")}))}const l=[(e,t)=>`$${e}`,(e,t)=>`[[${e}${t?`:${t}`:""}]]`,(e,t)=>`\${${e}${t?`:${t}`:""}}`];function u(e,t){return t?function(e){return e.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,((e,t,s,r)=>l[parseInt(t,10)](s,r)))}(e.substring(t.from,t.to)):""}function c(e,t,s,r){const i=[parseFloat(u(t,s))];return e.comparison&&i.push(r),{id:e.id,params:i}}function h(e,t,s){if(t.name===s)return[u(e,t)];const r=[];let i=0,a=t.childAfter(i);for(;a;)r.push(...h(e,a,s)),i=a.to,a=t.childAfter(i);return r}},"./public/app/plugins/datasource/prometheus/querybuilder/shared/types.ts":(e,t,s)=>{"use strict";let r;s.d(t,{c:()=>r}),function(e){e.Code="code",e.Builder="builder",e.Explain="explain"}(r||(r={}))},"./public/app/plugins/datasource/prometheus/querybuilder/types.ts":(e,t,s)=>{"use strict";let r,i;s.d(t,{C:()=>r,G:()=>i}),function(e){e.Aggregations="Aggregations",e.RangeFunctions="Range functions",e.Functions="Functions",e.BinaryOps="Binary operations",e.Trigonometric="Trigonometric",e.Time="Time Functions"}(r||(r={})),function(e){e.Abs="abs",e.Absent="absent",e.AbsentOverTime="absent_over_time",e.Acos="acos",e.Acosh="acosh",e.Asin="asin",e.Asinh="asinh",e.Atan="atan",e.Atanh="atanh",e.Avg="avg",e.AvgOverTime="avg_over_time",e.BottomK="bottomk",e.Ceil="ceil",e.Changes="changes",e.Clamp="clamp",e.ClampMax="clamp_max",e.ClampMin="clamp_min",e.Cos="cos",e.Cosh="cosh",e.Count="count",e.CountOverTime="count_over_time",e.CountScalar="count_scalar",e.CountValues="count_values",e.DayOfMonth="day_of_month",e.DayOfWeek="day_of_week",e.DaysInMonth="days_in_month",e.Deg="deg",e.Delta="delta",e.Deriv="deriv",e.DropCommonLabels="drop_common_labels",e.Exp="exp",e.Floor="floor",e.Group="group",e.HistogramQuantile="histogram_quantile",e.HoltWinters="holt_winters",e.Hour="hour",e.Idelta="idelta",e.Increase="increase",e.Irate="irate",e.LabelJoin="label_join",e.LabelReplace="label_replace",e.Last="last",e.LastOverTime="last_over_time",e.Ln="ln",e.Log10="log10",e.Log2="log2",e.Max="max",e.MaxOverTime="max_over_time",e.Min="min",e.MinOverTime="min_over_time",e.Minute="minute",e.Month="month",e.Pi="pi",e.PredictLinear="predict_linear",e.Present="present",e.PresentOverTime="present_over_time",e.Quantile="quantile",e.QuantileOverTime="quantile_over_time",e.Rad="rad",e.Rate="rate",e.Resets="resets",e.Round="round",e.Scalar="scalar",e.Sgn="sgn",e.Sin="sin",e.Sinh="sinh",e.Sort="sort",e.SortDesc="sort_desc",e.Sqrt="sqrt",e.Stddev="stddev",e.StddevOverTime="stddev_over_time",e.Sum="sum",e.SumOverTime="sum_over_time",e.Tan="tan",e.Tanh="tanh",e.Time="time",e.Timestamp="timestamp",e.TopK="topk",e.Vector="vector",e.Year="year",e.Addition="__addition",e.Subtraction="__subtraction",e.MultiplyBy="__multiply_by",e.DivideBy="__divide_by",e.Modulo="__modulo",e.Exponent="__exponent",e.NestedQuery="__nested_query",e.EqualTo="__equal_to",e.NotEqualTo="__not_equal_to",e.GreaterThan="__greater_than",e.LessThan="__less_than",e.GreaterOrEqual="__greater_or_equal",e.LessOrEqual="__less_or_equal"}(i||(i={}))},"./public/app/plugins/datasource/prometheus/types.ts":(e,t,s)=>{"use strict";let r,i;function a(e){return"values"in e}function n(e){return!(null==e||!Array.isArray(e))&&(!!e.length&&"exemplars"in e[0])}s.d(t,{V5:()=>r,WS:()=>n,el:()=>a,pD:()=>i}),function(e){e.timeSeriesQuery="timeSeriesQuery"}(r||(r={})),function(e){e.Auto="__auto",e.Verbose="__verbose",e.Custom="__custom"}(i||(i={}))},"./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js":(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var r=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");function i(e){var t=(0,r.useRef)();return(0,r.useEffect)((function(){t.current=e})),t.current}},"./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useToggle.js":(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=function(e,t){return"boolean"==typeof t?t:!e};const a=function(e){return(0,r.useReducer)(i,e)}},"../../opt/drone/yarncache/lru-cache-npm-7.7.1-726274dc4d-f362c5a2cf.zip/node_modules/lru-cache/index.js":e=>{const t="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,s="undefined"!=typeof AbortController?AbortController:Object.assign(class{constructor(){this.signal=new s.AbortSignal}abort(){this.signal.aborted=!0}},{AbortSignal:class{constructor(){this.aborted=!1}}}),r=new Set,i=(e,t)=>{const s=`LRU_CACHE_OPTION_${e}`;n(s)&&o(s,`${e} option`,`options.${t}`,d)},a=(e,t)=>{const s=`LRU_CACHE_METHOD_${e}`;if(n(s)){const{prototype:r}=d,{get:i}=Object.getOwnPropertyDescriptor(r,e);o(s,`${e} method`,`cache.${t}()`,i)}},n=e=>"object"==typeof process&&process&&!r.has(e),o=(e,t,s,i)=>{r.add(e);const a=`The ${t} is deprecated. Please use ${s} instead.`;process.emitWarning(a,"DeprecationWarning",e,i)},l=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),u=e=>l(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?c:null:null;class c extends Array{constructor(e){super(e),this.fill(0)}}class h{constructor(e){const t=e?u(e):Array;this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class d{constructor(e={}){const{max:t=0,ttl:s,ttlResolution:a=1,ttlAutopurge:o,updateAgeOnGet:c,allowStale:p,dispose:f,disposeAfter:m,noDisposeOnSet:g,noUpdateTTL:y,maxSize:b=0,sizeCalculation:O,fetchMethod:v}=e,{length:x,maxAge:_,stale:$}=e instanceof d?{}:e;if(0!==t&&!l(t))throw new TypeError("max option must be a nonnegative integer");const k=t?u(t):Array;if(!k)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=b,this.sizeCalculation=O||x,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculating set to non-function")}if(this.fetchMethod=v||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new k(t),this.prev=new k(t),this.head=0,this.tail=0,this.free=new h(t),this.initialFill=1,this.size=0,"function"==typeof f&&(this.dispose=f),"function"==typeof m?(this.disposeAfter=m,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!g,this.noUpdateTTL=!!y,0!==this.maxSize){if(!l(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!p||!!$,this.updateAgeOnGet=!!c,this.ttlResolution=l(a)||0===a?a:1,this.ttlAutopurge=!!o,this.ttl=s||_||0,this.ttl){if(!l(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(n(e)){r.add(e);const t="TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.";process.emitWarning(t,"UnboundedCacheWarning",e,d)}}$&&i("stale","allowStale"),_&&i("maxAge","ttl"),x&&i("length","sizeCalculation")}getRemainingTTL(e){return this.has(e)?1/0:0}initializeTTLTracking(){this.ttls=new c(this.max),this.starts=new c(this.max),this.setItemTTL=(e,s)=>{if(this.starts[e]=0!==s?t.now():0,this.ttls[e]=s,0!==s&&this.ttlAutopurge){const t=setTimeout((()=>{this.isStale(e)&&this.delete(this.keyList[e])}),s+1);t.unref&&t.unref()}},this.updateItemAge=e=>{this.starts[e]=0!==this.ttls[e]?t.now():0};let e=0;const s=()=>{const s=t.now();if(this.ttlResolution>0){e=s;const t=setTimeout((()=>e=0),this.ttlResolution);t.unref&&t.unref()}return s};this.getRemainingTTL=t=>{const r=this.keyMap.get(t);return void 0===r?0:0===this.ttls[r]||0===this.starts[r]?1/0:this.starts[r]+this.ttls[r]-(e||s())},this.isStale=t=>0!==this.ttls[t]&&0!==this.starts[t]&&(e||s())-this.starts[t]>this.ttls[t]}updateItemAge(e){}setItemTTL(e,t){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new c(this.max),this.removeItemSize=e=>this.calculatedSize-=this.sizes[e],this.requireSize=(e,t,s,r)=>{if(r&&!s&&(s=r(t,e)),!l(s))throw new TypeError("size must be positive integer");return s},this.addItemSize=(e,t,s,r)=>{this.sizes[e]=r;const i=this.maxSize-this.sizes[e];for(;this.calculatedSize>i;)this.evict();this.calculatedSize+=this.sizes[e]},this.delete=e=>{if(0!==this.size){const t=this.keyMap.get(e);void 0!==t&&(this.calculatedSize-=this.sizes[t])}return d.prototype.delete.call(this,e)}}removeItemSize(e){}addItemSize(e,t,s,r){}requireSize(e,t,s,r){if(s||r)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(const e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(const e of this.indexes())yield this.keyList[e]}*rkeys(){for(const e of this.rindexes())yield this.keyList[e]}*values(){for(const e of this.indexes())yield this.valList[e]}*rvalues(){for(const e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const s of this.indexes())if(e(this.valList[s],this.keyList[s],this))return this.get(this.keyList[s],t)}forEach(e,t=this){for(const s of this.indexes())e.call(t,this.valList[s],this.keyList[s],this)}rforEach(e,t=this){for(const s of this.rindexes())e.call(t,this.valList[s],this.keyList[s],this)}get prune(){return a("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const e=[];for(const t of this.indexes()){const s=this.keyList[t],r={value:this.valList[t]};this.ttls&&(r.ttl=this.ttls[t]),this.sizes&&(r.size=this.sizes[t]),e.unshift([s,r])}return e}load(e){this.clear();for(const[t,s]of e)this.set(t,s.value,s)}dispose(e,t,s){}set(e,t,{ttl:s=this.ttl,noDisposeOnSet:r=this.noDisposeOnSet,size:i=0,sizeCalculation:a=this.sizeCalculation,noUpdateTTL:n=this.noUpdateTTL}={}){i=this.requireSize(e,t,i,a);let o=0===this.size?void 0:this.keyMap.get(e);if(void 0===o)o=this.newIndex(),this.keyList[o]=e,this.valList[o]=t,this.keyMap.set(e,o),this.next[this.tail]=o,this.prev[o]=this.tail,this.tail=o,this.size++,this.addItemSize(o,t,e,i),n=!1;else{const s=this.valList[o];t!==s&&(this.isBackgroundFetch(s)?s.__abortController.abort():r||(this.dispose(s,e,"set"),this.disposeAfter&&this.disposed.push([s,e,"set"])),this.removeItemSize(o),this.valList[o]=t,this.addItemSize(o,t,e,i)),this.moveToTail(o)}if(0===s||0!==this.ttl||this.ttls||this.initializeTTLTracking(),n||this.setItemTTL(o,s),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max?this.evict():0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(),e}}evict(){const e=this.head,t=this.keyList[e],s=this.valList[e];return this.isBackgroundFetch(s)?s.__abortController.abort():(this.dispose(s,t,"evict"),this.disposeAfter&&this.disposed.push([s,t,"evict"])),this.removeItemSize(e),this.head=this.next[e],this.keyMap.delete(t),this.size--,e}has(e){return this.keyMap.has(e)&&!this.isStale(this.keyMap.get(e))}peek(e,{allowStale:t=this.allowStale}={}){const s=this.keyMap.get(e);if(void 0!==s&&(t||!this.isStale(s)))return this.valList[s]}backgroundFetch(e,t,s){const r=void 0===t?void 0:this.valList[t];if(this.isBackgroundFetch(r))return r;const i=new AbortController,a={signal:i.signal,options:s},n=Promise.resolve(this.fetchMethod(e,r,a)).then((t=>(i.signal.aborted||this.set(e,t,a.options),t)));return n.__abortController=i,n.__staleWhileFetching=r,void 0===t?(this.set(e,n,a.options),t=this.keyMap.get(e)):this.valList[t]=n,n}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,ttl:r=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:a=0,sizeCalculation:n=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL}={}){if(!this.fetchMethod)return this.get(e,{allowStale:t,updateAgeOnGet:s});const l={allowStale:t,updateAgeOnGet:s,ttl:r,noDisposeOnSet:i,size:a,sizeCalculation:n,noUpdateTTL:o};let u=this.keyMap.get(e);if(void 0===u)return this.backgroundFetch(e,u,l);{const r=this.valList[u];if(this.isBackgroundFetch(r))return t&&void 0!==r.__staleWhileFetching?r.__staleWhileFetching:r;if(!this.isStale(u))return this.moveToTail(u),s&&this.updateItemAge(u),r;const i=this.backgroundFetch(e,u,l);return t&&void 0!==i.__staleWhileFetching?i.__staleWhileFetching:i}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet}={}){const r=this.keyMap.get(e);if(void 0!==r){const i=this.valList[r],a=this.isBackgroundFetch(i);if(this.isStale(r))return a?t?i.__staleWhileFetching:void 0:(this.delete(e),t?i:void 0);if(a)return;return this.moveToTail(r),s&&this.updateItemAge(r),i}}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return a("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const s=this.keyMap.get(e);if(void 0!==s)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(s);const t=this.valList[s];this.isBackgroundFetch(t)?t.__abortController.abort():(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[s]=null,this.valList[s]=null,s===this.tail?this.tail=this.prev[s]:s===this.head?this.head=this.next[s]:(this.next[this.prev[s]]=this.next[s],this.prev[this.next[s]]=this.prev[s]),this.size--,this.free.push(s)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort();else{const s=this.keyList[e];this.dispose(t,s,"delete"),this.disposeAfter&&this.disposed.push([t,s,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return a("reset","clear"),this.clear}get length(){return((e,t)=>{const s=`LRU_CACHE_PROPERTY_${e}`;if(n(s)){const{prototype:r}=d,{get:i}=Object.getOwnPropertyDescriptor(r,e);o(s,`${e} property`,`cache.${t}`,i)}})("length","size"),this.size}}e.exports=d},"./.yarn/__virtual__/lezer-promql-virtual-eaf88aa77a/3/opt/drone/yarncache/lezer-promql-npm-0.22.0-867da6afaa-cdce054700.zip/node_modules/lezer-promql/index.es.js":(e,t,s)=>{"use strict";s.d(t,{E2:()=>o});var r=s("../../opt/drone/yarncache/@lezer-lr-npm-0.15.8-8c481c39cd-e741225d6a.zip/node_modules/@lezer/lr/dist/index.js");const i={inf:146,nan:147,bool:1,ignoring:2,on:3,group_left:4,group_right:5,offset:6},a={avg:8,atan2:7,bottomk:9,count:10,count_values:11,group:12,max:13,min:14,quantile:15,stddev:16,stdvar:17,sum:18,topk:19,by:20,without:21,and:22,or:23,unless:24,start:25,end:26},n={__proto__:null,absent_over_time:307,absent:309,abs:311,acos:313,acosh:315,asin:317,asinh:319,atan:321,atanh:323,avg_over_time:325,ceil:327,changes:329,clamp:331,clamp_max:333,clamp_min:335,cos:337,cosh:339,count_over_time:341,days_in_month:343,day_of_month:345,day_of_week:347,deg:349,delta:351,deriv:353,exp:355,floor:357,histogram_quantile:359,holt_winters:361,hour:363,idelta:365,increase:367,irate:369,label_replace:371,label_join:373,last_over_time:375,ln:377,log10:379,log2:381,max_over_time:383,min_over_time:385,minute:387,month:389,pi:391,predict_linear:393,present_over_time:395,quantile_over_time:397,rad:399,rate:401,resets:403,round:405,scalar:407,sgn:409,sin:411,sinh:413,sort:415,sort_desc:417,sqrt:419,stddev_over_time:421,stdvar_over_time:423,sum_over_time:425,tan:427,tanh:429,timestamp:431,time:433,vector:435,year:437},o=r.WQ.deserialize({version:13,states:"6[OYQPOOO&{QPOOOOQO'#C{'#C{O'QQPO'#CzQ']QQOOOOQO'#De'#DeO'WQPO'#DdOOQO'#E}'#E}O(jQPO'#FTOYQPO'#FPOYQPO'#FSOOQO'#FV'#FVO.fQSO'#FWO.nQQO'#FUOOQO'#FU'#FUOOQO'#Cy'#CyOOQO'#Df'#DfOOQO'#Dh'#DhOOQO'#Di'#DiOOQO'#Dj'#DjOOQO'#Dk'#DkOOQO'#Dl'#DlOOQO'#Dm'#DmOOQO'#Dn'#DnOOQO'#Do'#DoOOQO'#Dp'#DpOOQO'#Dq'#DqOOQO'#Dr'#DrOOQO'#Ds'#DsOOQO'#Dt'#DtOOQO'#Du'#DuOOQO'#Dv'#DvOOQO'#Dw'#DwOOQO'#Dx'#DxOOQO'#Dy'#DyOOQO'#Dz'#DzOOQO'#D{'#D{OOQO'#D|'#D|OOQO'#D}'#D}OOQO'#EO'#EOOOQO'#EP'#EPOOQO'#EQ'#EQOOQO'#ER'#EROOQO'#ES'#ESOOQO'#ET'#ETOOQO'#EU'#EUOOQO'#EV'#EVOOQO'#EW'#EWOOQO'#EX'#EXOOQO'#EY'#EYOOQO'#EZ'#EZOOQO'#E['#E[OOQO'#E]'#E]OOQO'#E^'#E^OOQO'#E_'#E_OOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsOOQO'#Et'#EtOOQO'#Eu'#EuOOQO'#Ev'#EvOOQO'#Ew'#EwOOQO'#Ex'#ExOOQO'#Ey'#EyOOQO'#Ez'#EzQOQPOOO0XQPO'#C|O0^QPO'#DRO'WQPO,59fO0eQQO,59fO2RQPO,59oO2RQPO,59oO2RQPO,59oO2RQPO,59oO2RQPO,59oO7}QQO,5;gO8SQQO,5;jO8[QPO,5;yOOQO,5:O,5:OOOQO,5;i,5;iO8sQQO,5;kO8zQQO,5;nO:bQPO'#FYO:pQPO,5;rOOQO'#FX'#FXOOQO,5;r,5;rOOQO,5;p,5;pO:xQSO'#C}OOQO,59h,59hO;QQPO,59mO;YQQO'#DSOOQO,59m,59mOOQO1G/Q1G/QO0XQPO'#DWOAVQPO'#DVOAaQPO'#DVOYQPO1G/ZOYQPO1G/ZOYQPO1G/ZOYQPO1G/ZOYQPO1G/ZOAkQSO1G1ROOQO1G1U1G1UOAsQQO1G1UOAxQPO'#E}OOQO'#Fa'#FaOOQO1G1e1G1eOBTQPO1G1eOOQO1G1V1G1VOOQO'#FZ'#FZOBYQPO,5;tOB_QSO1G1^OOQO1G1^1G1^OOQO'#DP'#DPOBgQPO,59iOOQO'#DO'#DOOOQO,59i,59iOYQPO,59nOOQO1G/X1G/XOOQO,59r,59rOH_QPO,59qOHfQPO,59qOI}QQO7+$uOJ_QQO7+$uOKsQQO7+$uOLZQQO7+$uOMrQQO7+$uOOQO7+&m7+&mON]QQO7+&sOOQO7+&p7+&pONeQPO7+'POOQO1G1`1G1`OOQO1G1_1G1_OOQO7+&x7+&xONjQSO1G/TOOQO1G/T1G/TONrQQO1G/YOOQO1G/]1G/]ON|QPO1G/]OOQO<<J_<<J_O!&oQPO<<J_OOQO<<Jk<<JkOOQO1G/U1G/UOOQO7+$o7+$oOOQO7+$w7+$wOOQOAN?yAN?y",stateData:"!&t~O$ZOSkOS~OWQOXQOYQOZQO[QO]QO^QO_QO`QOaQObQOcQO!ZZO#t_O$WVO$XVO$[XO$_`O$`aO$abO$bcO$cdO$deO$efO$fgO$ghO$hiO$ijO$jkO$klO$lmO$mnO$noO$opO$pqO$qrO$rsO$stO$tuO$uvO$vwO$wxO$xyO$yzO$z{O${|O$|}O$}!OO%O!PO%P!QO%Q!RO%R!SO%S!TO%T!UO%U!VO%V!WO%W!XO%X!YO%Y!ZO%Z![O%[!]O%]!^O%^!_O%_!`O%`!aO%a!bO%b!cO%c!dO%d!eO%e!fO%f!gO%g!hO%h!iO%i!jO%j!kO%k!lO%l!mO%m!nO%n!oO%o!pO%p!qO%q!rO%r!sO%uWO%vWO%wVO%y[O~O!ZZO~Od!uOe!uO$[!vO~OU#POV!yOf!|Og!}Oh!|Ox!yO{!yO|!yO}!yO!O!zO!P!zO!Q!{O!R!{O!S!{O!T!{O!U!{O!V!{O$S#QO%s#OO~O$W#SO$X#SO%w#SOW#wXX#wXY#wXZ#wX[#wX]#wX^#wX_#wX`#wXa#wXb#wXc#wX!Z#wX#t#wX$W#wX$X#wX$[#wX$_#wX$`#wX$a#wX$b#wX$c#wX$d#wX$e#wX$f#wX$g#wX$h#wX$i#wX$j#wX$k#wX$l#wX$m#wX$n#wX$o#wX$p#wX$q#wX$r#wX$s#wX$t#wX$u#wX$v#wX$w#wX$x#wX$y#wX$z#wX${#wX$|#wX$}#wX%O#wX%P#wX%Q#wX%R#wX%S#wX%T#wX%U#wX%V#wX%W#wX%X#wX%Y#wX%Z#wX%[#wX%]#wX%^#wX%_#wX%`#wX%a#wX%b#wX%c#wX%d#wX%e#wX%f#wX%g#wX%h#wX%i#wX%j#wX%k#wX%l#wX%m#wX%n#wX%o#wX%p#wX%q#wX%r#wX%u#wX%v#wX%w#wX%y#wX~Ot#VO%z#YO~O%y[OU#xXV#xXf#xXg#xXh#xXx#xX{#xX|#xX}#xX!O#xX!P#xX!Q#xX!R#xX!S#xX!T#xX!U#xX!V#xX$S#xX$V#xX%s#xX$^#xX$]#xX~O$[#[O~O$^#`O~PYOd!uOe!uOUnaVnafnagnahnaxna{na|na}na!Ona!Pna!Qna!Rna!Sna!Tna!Una!Vna$Sna$Vna%sna$^na$]na~OP#dOQ#bOR#bOWyPXyPYyPZyP[yP]yP^yP_yP`yPayPbyPcyP!ZyP#tyP$WyP$XyP$[yP$_yP$`yP$ayP$byP$cyP$dyP$eyP$fyP$gyP$hyP$iyP$jyP$kyP$lyP$myP$nyP$oyP$pyP$qyP$ryP$syP$tyP$uyP$vyP$wyP$xyP$yyP$zyP${yP$|yP$}yP%OyP%PyP%QyP%RyP%SyP%TyP%UyP%VyP%WyP%XyP%YyP%ZyP%[yP%]yP%^yP%_yP%`yP%ayP%byP%cyP%dyP%eyP%fyP%gyP%hyP%iyP%jyP%kyP%lyP%myP%nyP%oyP%pyP%qyP%ryP%uyP%vyP%wyP%yyP~O#p#jO~O!P#lO#p#kO~Oi#nOj#nO$WVO$XVO%u#mO%v#mO%wVO~O$^#qO~P']Ox!yOU#vaV#vaf#vag#vah#va{#va|#va}#va!O#va!P#va!Q#va!R#va!S#va!T#va!U#va!V#va$S#va$V#va%s#va$^#va$]#va~O!V#rO$O#rO$P#rO$Q#rO~O$]#tO%z#uO~Ot#vO$^#yO~O$]#zO$^#{O~O$]vX$^vX~P']OWyXXyXYyXZyX[yX]yX^yX_yX`yXayXbyXcyX!ZyX#tyX$WyX$XyX$[yX$_yX$`yX$ayX$byX$cyX$dyX$eyX$fyX$gyX$hyX$iyX$jyX$kyX$lyX$myX$nyX$oyX$pyX$qyX$ryX$syX$tyX$uyX$vyX$wyX$xyX$yyX$zyX${yX$|yX$}yX%OyX%PyX%QyX%RyX%SyX%TyX%UyX%VyX%WyX%XyX%YyX%ZyX%[yX%]yX%^yX%_yX%`yX%ayX%byX%cyX%dyX%eyX%fyX%gyX%hyX%iyX%jyX%kyX%lyX%myX%nyX%oyX%pyX%qyX%ryX%uyX%vyX%wyX%yyX~OS#}OT#}O~P;dOQ#bOR#bO~P;dO%t$UO%x$VO~O#p$WO~O$W#SO$X#SO%w#SO~O$[$XO~O#t$YO~Ot#VO%z$[O~O$]$]O$^$^O~OWyaXyaYyaZya[ya]ya^ya_ya`yaayabyacya!Zya#tya$Wya$Xya$_ya$`ya$aya$bya$cya$dya$eya$fya$gya$hya$iya$jya$kya$lya$mya$nya$oya$pya$qya$rya$sya$tya$uya$vya$wya$xya$yya$zya${ya$|ya$}ya%Oya%Pya%Qya%Rya%Sya%Tya%Uya%Vya%Wya%Xya%Yya%Zya%[ya%]ya%^ya%_ya%`ya%aya%bya%cya%dya%eya%fya%gya%hya%iya%jya%kya%lya%mya%nya%oya%pya%qya%rya%uya%vya%wya%yya~O$[#[O~PBoOS$aOT$aO$[ya~PBoOx!yOUwqfwqgwqhwq!Owq!Pwq!Qwq!Rwq!Swq!Twq!Uwq!Vwq$Swq$Vwq%swq$^wq$]wq~OVwq{wq|wq}wq~PHsOV!yO{!yO|!yO}!yO~PHsOV!yOx!yO{!yO|!yO}!yO!O!zO!P!zOUwqfwqgwqhwq$Swq$Vwq%swq$^wq$]wq~O!Qwq!Rwq!Swq!Twq!Uwq!Vwq~PJoO!Q!{O!R!{O!S!{O!T!{O!U!{O!V!{O~PJoOV!yOf!|Oh!|Ox!yO{!yO|!yO}!yO!O!zO!P!zO!Q!{O!R!{O!S!{O!T!{O!U!{O!V!{O~OUwqgwq$Swq$Vwq%swq$^wq$]wq~PLqO#p$cO%t$bO~O$^$dO~Ot#vO$^$fO~O$]vi$^vi~P']O$[#[OWyiXyiYyiZyi[yi]yi^yi_yi`yiayibyicyi!Zyi#tyi$Wyi$Xyi$_yi$`yi$ayi$byi$cyi$dyi$eyi$fyi$gyi$hyi$iyi$jyi$kyi$lyi$myi$nyi$oyi$pyi$qyi$ryi$syi$tyi$uyi$vyi$wyi$xyi$yyi$zyi${yi$|yi$}yi%Oyi%Pyi%Qyi%Ryi%Syi%Tyi%Uyi%Vyi%Wyi%Xyi%Yyi%Zyi%[yi%]yi%^yi%_yi%`yi%ayi%byi%cyi%dyi%eyi%fyi%gyi%hyi%iyi%jyi%kyi%lyi%myi%nyi%oyi%pyi%qyi%ryi%uyi%vyi%wyi%yyi~O%t$hO~O",goto:"(u$UPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$V$u%R%_%e%q%tP%z&T$uP&W&gPPPPPPPPPPP$u&q&}P&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}&}$uP'Z$u$uP$u$u'j$u'v(V(f(i(oPPP$uP(rQSOQ#TXQ#UYQ#_!vQ$P#eQ$Q#fQ$R#gQ$S#hQ$T#iR$_#ze_OXY!v#e#f#g#h#i#zeROXY!v#e#f#g#h#i#zQ!wRR#a!xQ#]!uQ#|#bQ$`#}R$g$aR#w#[Q#x#[R$e$]Q!xRQ#RUR#a!wR#^!vQ#e!yQ#f!zQ#g!{Q#h!|R#i!}Y#c!y!z!{!|!}R$O#deUOXY!v#e#f#g#h#i#zeTOXY!v#e#f#g#h#i#zd_OXY!v#e#f#g#h#i#zR#o#QeYOXY!v#e#f#g#h#i#zd]OXY!v#e#f#g#h#i#zR!tPd^OXY!v#e#f#g#h#i#zR#Z]R#W[Q#X[R$Z#tR#s#VR#p#Q",nodeNames:"⚠ Bool Ignoring On GroupLeft GroupRight Offset Atan2 Avg Bottomk Count CountValues Group Max Min Quantile Stddev Stdvar Sum Topk By Without And Or Unless Start End LineComment PromQL Expr AggregateExpr AggregateOp AggregateModifier GroupingLabels GroupingLabelList GroupingLabel LabelName FunctionCallBody FunctionCallArgs BinaryExpr Pow BinModifiers OnOrIgnoring Mul Div Mod Add Sub Eql Gte Gtr Lte Lss Neq FunctionCall FunctionIdentifier AbsentOverTime Identifier Absent Abs Acos Acosh Asin Asinh Atan Atanh AvgOverTime Ceil Changes Clamp ClampMax ClampMin Cos Cosh CountOverTime DaysInMonth DayOfMonth DayOfWeek Deg Delta Deriv Exp Floor HistogramQuantile HoltWinters Hour Idelta Increase Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MaxOverTime MinOverTime Minute Month Pi PredictLinear PresentOverTime QuantileOverTime Rad Rate Resets Round Scalar Sgn Sin Sinh Sort SortDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Tan Tanh Timestamp Time Vector Year MatrixSelector Duration NumberLiteral OffsetExpr ParenExpr StringLiteral SubqueryExpr UnaryExpr UnaryOp VectorSelector MetricIdentifier LabelMatchers LabelMatchList LabelMatcher MatchOp EqlSingle EqlRegex NeqRegex StepInvariantExpr At AtModifierPreprocessors MetricName",maxTerm:226,skippedNodes:[0,27],repeatNodeCount:0,tokenData:"1R~RwX^#lpq#lqr$ars$tst%huv%swx%xxy&gyz&lz{&q{|&v|}&}}!O'S!O!P'Z!P!Q(Z!Q!R(`!R![)W![!]-r!^!_.n!_!`.{!`!a/b!b!c/o!c!}/t!}#O0[#P#Q0a#Q#R0f#R#S/t#S#T0k#T#o/t#o#p0w#q#r0|#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~#qY$Z~X^#lpq#l#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~$dQ!_!`$j#r#s$o~$oO!V~~$tO$Q~~$yU#t~OY$tZr$trs%]s#O$t#O#P%b#P~$t~%bO#t~~%ePO~$t~%mQk~OY%hZ~%h~%xO}~~%}U#t~OY%xZw%xwx%]x#O%x#O#P&a#P~%x~&dPO~%x~&lO$[~~&qO$^~~&vO{~R&}O%vP!OQ~'SO$]~R'ZO%uP!PQP'^P!Q!['aP'fR%wP!Q!['a!g!h'o#X#Y'oP'rR{|'{}!O'{!Q![(RP(OP!Q![(RP(WP%wP!Q![(R~(`O|~R(eZ%wP!O!P'a!Q![)W!g!h'o#W#X){#X#Y'o#[#]*d#a#b*x#g#h+l#k#l+}#l#m-W#m#n,iR)]Y%wP!O!P'a!Q![)W!g!h'o#W#X){#X#Y'o#[#]*d#a#b*x#g#h+l#k#l+}#m#n,iQ*QP#pQ!Q![*TQ*WS!Q![*T#[#]*d#a#b*x#g#h+lQ*iP#pQ!Q![*lQ*oR!Q![*l#a#b*x#g#h+lQ*}Q#pQ!Q![+T#g#h+gQ+WR!Q![+T#a#b+a#g#h+lQ+dP#g#h+gQ+lO#pQQ+qP#pQ!Q![+tQ+wQ!Q![+t#a#b+aQ,SP#pQ!Q![,VQ,YT!Q![,V#W#X){#[#]*d#a#b*x#g#h+lQ,nP#pQ!Q![,qQ,tU!Q![,q#W#X){#[#]*d#a#b*x#g#h+l#k#l+}P-ZR!Q![-d!c!i-d#T#Z-dP-iR%wP!Q![-d!c!i-d#T#Z-dV-yT%xS!ZR!Q![.Y![!].Y!c!}.Y#R#S.Y#T#o.YR._T!ZR!Q![.Y![!].Y!c!}.Y#R#S.Y#T#o.Y~.sP!U~!_!`.v~.{O!T~~/QQ$OP!_!`/W#r#s/]Q/]O!QQ~/bO$P~~/gP!S~!_!`/j~/oO!R~~/tO$S~V/{T!ZRtS!Q![/t![!].Y!c!}/t#R#S/t#T#o/t~0aO%s~~0fO%t~~0kOx~~0nRO#S0k#S#T%]#T~0k~0|O%y~~1RO%z~",tokenizers:[0,1,2],topRules:{PromQL:[0,28],MetricName:[1,144]},specialized:[{term:57,get:(e,t)=>((e,t)=>i[e.toLowerCase()]||-1)(e)<<1},{term:57,get:(e,t)=>((e,t)=>a[e.toLowerCase()]||-1)(e)<<1|1},{term:57,get:e=>n[e]||-1}],tokenPrec:0})},"../../opt/drone/yarncache/@lezer-lr-npm-0.15.8-8c481c39cd-e741225d6a.zip/node_modules/@lezer/lr/dist/index.js":(e,t,s)=>{"use strict";s.d(t,{WQ:()=>W});const r=1024;let i=0;class a{constructor(e,t){this.from=e,this.to=t}}class n{constructor(e={}){this.id=i++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=l.match(e)),t=>{let s=e(t);return void 0===s?null:[this,s]}}}n.closedBy=new n({deserialize:e=>e.split(" ")}),n.openedBy=new n({deserialize:e=>e.split(" ")}),n.group=new n({deserialize:e=>e.split(" ")}),n.contextHash=new n({perNode:!0}),n.lookAhead=new n({perNode:!0}),n.mounted=new n({perNode:!0});const o=Object.create(null);class l{constructor(e,t,s,r=0){this.name=e,this.props=t,this.id=s,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):o,s=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),r=new l(e.name||"",t,e.id,s);if(e.props)for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}return r}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(n.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let s in e)for(let r of s.split(" "))t[r]=e[s];return e=>{for(let s=e.prop(n.group),r=-1;r<(s?s.length:0);r++){let i=t[r<0?e.name:s[r]];if(i)return i}}}}l.none=new l("",Object.create(null),0,8);class u{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let s of this.types){let r=null;for(let t of e){let e=t(s);e&&(r||(r=Object.assign({},s.props)),r[e[0].id]=e[1])}t.push(r?new l(s.name,r,s.id,s.flags):s)}return new u(t)}}const c=new WeakMap,h=new WeakMap;class d{constructor(e,t,s,r,i){if(this.type=e,this.children=t,this.positions=s,this.length=r,this.props=null,i&&i.length){this.props=Object.create(null);for(let[e,t]of i)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=this.prop(n.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let s=e.toString();s&&(t&&(t+=","),t+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e,t=0){let s=null!=e&&c.get(this)||this.topNode,r=new _(s);return null!=e&&(r.moveTo(e,t),c.set(this,r._tree)),r}fullCursor(){return new _(this.topNode,1)}get topNode(){return new b(this,0,0,null)}resolve(e,t=0){let s=y(c.get(this)||this.topNode,e,t,!1);return c.set(this,s),s}resolveInner(e,t=0){let s=y(h.get(this)||this.topNode,e,t,!0);return h.set(this,s),s}iterate(e){let{enter:t,leave:s,from:r=0,to:i=this.length}=e;for(let e=this.cursor(),a=()=>e.node;;){let n=!1;if(e.from<=i&&e.to>=r&&(e.type.isAnonymous||!1!==t(e.type,e.from,e.to,a))){if(e.firstChild())continue;e.type.isAnonymous||(n=!0)}for(;n&&s&&s(e.type,e.from,e.to,a),n=e.type.isAnonymous,!e.nextSibling();){if(!e.parent())return;n=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:S(l.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,s)=>new d(this.type,e,t,s,this.propValues)),e.makeTree||((e,t,s)=>new d(l.none,e,t,s)))}static build(e){return function(e){var t;let{buffer:s,nodeSet:i,maxBufferLength:a=r,reused:o=[],minRepeatType:l=i.types.length}=e,u=Array.isArray(s)?new p(s,s.length):s,c=i.types,h=0,m=0;function g(e,t,s,r,n){let{id:d,start:p,end:_,size:$}=u,k=m;for(;$<0;){if(u.next(),-1==$){let t=o[d];return s.push(t),void r.push(p-e)}if(-3==$)return void(h=d);if(-4==$)return void(m=d);throw new RangeError(`Unrecognized record size: ${$}`)}let w,P,T=c[d],Q=p-e;if(_-p<=a&&(P=v(u.pos-t,n))){let t=new Uint16Array(P.size-P.skip),s=u.pos-P.size,r=t.length;for(;u.pos>s;)r=x(P.start,t,r);w=new f(t,_-P.start,i),Q=P.start-e}else{let e=u.pos-$;u.next();let t=[],s=[],r=d>=l?d:-1,i=0,n=_;for(;u.pos>e;)r>=0&&u.id==r&&u.size>=0?(u.end<=n-a&&(b(t,s,p,i,u.end,n,r,k),i=t.length,n=u.end),u.next()):g(p,e,t,s,r);if(r>=0&&i>0&&i<t.length&&b(t,s,p,i,p,n,r,k),t.reverse(),s.reverse(),r>-1&&i>0){let e=y(T);w=S(T,t,s,0,t.length,0,_-p,e,e)}else w=O(T,t,s,_-p,k-_)}s.push(w),r.push(Q)}function y(e){return(t,s,r)=>{let i,a,o=0,l=t.length-1;if(l>=0&&(i=t[l])instanceof d){if(!l&&i.type==e&&i.length==r)return i;(a=i.prop(n.lookAhead))&&(o=s[l]+i.length+a)}return O(e,t,s,r,o)}}function b(e,t,s,r,a,n,o,l){let u=[],c=[];for(;e.length>r;)u.push(e.pop()),c.push(t.pop()+s-a);e.push(O(i.types[o],u,c,n-a,l-n)),t.push(a-s)}function O(e,t,s,r,i=0,a){if(h){let e=[n.contextHash,h];a=a?[e].concat(a):[e]}if(i>25){let e=[n.lookAhead,i];a=a?[e].concat(a):[e]}return new d(e,t,s,r,a)}function v(e,t){let s=u.fork(),r=0,i=0,n=0,o=s.end-a,c={size:0,start:0,skip:0};e:for(let a=s.pos-e;s.pos>a;){let e=s.size;if(s.id==t&&e>=0){c.size=r,c.start=i,c.skip=n,n+=4,r+=4,s.next();continue}let u=s.pos-e;if(e<0||u<a||s.start<o)break;let h=s.id>=l?4:0,d=s.start;for(s.next();s.pos>u;){if(s.size<0){if(-3!=s.size)break e;h+=4}else s.id>=l&&(h+=4);s.next()}i=d,r+=e,n+=h}return(t<0||r==e)&&(c.size=r,c.start=i,c.skip=n),c.size>4?c:void 0}function x(e,t,s){let{id:r,start:i,end:a,size:n}=u;if(u.next(),n>=0&&r<l){let o=s;if(n>4){let r=u.pos-(n-4);for(;u.pos>r;)s=x(e,t,s)}t[--s]=o,t[--s]=a-e,t[--s]=i-e,t[--s]=r}else-3==n?h=r:-4==n&&(m=r);return s}let _=[],$=[];for(;u.pos>0;)g(e.start||0,e.bufferStart||0,_,$,-1);let k=null!==(t=e.length)&&void 0!==t?t:_.length?$[0]+_[0].length:0;return new d(c[e.topID],_.reverse(),$.reverse(),k)}(e)}}d.empty=new d(l.none,[],[],0);class p{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new p(this.buffer,this.index)}}class f{constructor(e,t,s){this.buffer=e,this.length=t,this.set=s}get type(){return l.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],s=this.buffer[e+3],r=this.set.types[t],i=r.name;if(/\W/.test(i)&&!r.isError&&(i=JSON.stringify(i)),s==(e+=4))return i;let a=[];for(;e<s;)a.push(this.childString(e)),e=this.buffer[e+3];return i+"("+a.join(",")+")"}findChild(e,t,s,r,i){let{buffer:a}=this,n=-1;for(let o=e;o!=t&&!(m(i,r,a[o+1],a[o+2])&&(n=o,s>0));o=a[o+3]);return n}slice(e,t,s,r){let i=this.buffer,a=new Uint16Array(t-e);for(let r=e,n=0;r<t;)a[n++]=i[r++],a[n++]=i[r++]-s,a[n++]=i[r++]-s,a[n++]=i[r++]-e;return new f(a,r-s,this.set)}}function m(e,t,s,r){switch(e){case-2:return s<t;case-1:return r>=t&&s<t;case 0:return s<t&&r>t;case 1:return s<=t&&r>t;case 2:return r>t;case 4:return!0}}function g(e,t){let s=e.childBefore(t);for(;s;){let t=s.lastChild;if(!t||t.to!=s.to)break;t.type.isError&&t.from==t.to?(e=s,s=t.prevSibling):s=t}return e}function y(e,t,s,r){for(var i;e.from==e.to||(s<1?e.from>=t:e.from>t)||(s>-1?e.to<=t:e.to<t);){let t=!r&&e instanceof b&&e.index<0?null:e.parent;if(!t)return e;e=t}if(r)for(let r=e,a=r.parent;a;r=a,a=r.parent)r instanceof b&&r.index<0&&(null===(i=a.enter(t,s,!0))||void 0===i?void 0:i.from)!=r.from&&(e=a);for(;;){let i=e.enter(t,s,r);if(!i)return e;e=i}}class b{constructor(e,t,s,r){this.node=e,this._from=t,this.index=s,this._parent=r}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(e,t,s,r,i=0){for(let a=this;;){for(let{children:o,positions:l}=a.node,u=t>0?o.length:-1;e!=u;e+=t){let u=o[e],c=l[e]+a._from;if(m(r,s,c,c+u.length))if(u instanceof f){if(2&i)continue;let n=u.findChild(0,u.buffer.length,t,s-c,r);if(n>-1)return new x(new v(a,u,e,c),null,n)}else if(1&i||!u.type.isAnonymous||$(u)){let o;if(!(1&i)&&u.props&&(o=u.prop(n.mounted))&&!o.overlay)return new b(o.tree,c,e,a);let l=new b(u,c,e,a);return 1&i||!l.type.isAnonymous?l:l.nextChild(t<0?u.children.length-1:0,t,s,r)}}if(1&i||!a.type.isAnonymous)return null;if(e=a.index>=0?a.index+t:t<0?-1:a._parent.node.children.length,a=a._parent,!a)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this.node.children.length-1,-1,e,-2)}enter(e,t,s=!0,r=!0){let i;if(s&&(i=this.node.prop(n.mounted))&&i.overlay){let s=e-this.from;for(let{from:e,to:r}of i.overlay)if((t>0?e<=s:e<s)&&(t<0?r>=s:r>s))return new b(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r?0:2)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new _(this)}get tree(){return this.node}toTree(){return this.node}resolve(e,t=0){return y(this,e,t,!1)}resolveInner(e,t=0){return y(this,e,t,!0)}enterUnfinishedNodesBefore(e){return g(this,e)}getChild(e,t=null,s=null){let r=O(this,e,t,s);return r.length?r[0]:null}getChildren(e,t=null,s=null){return O(this,e,t,s)}toString(){return this.node.toString()}}function O(e,t,s,r){let i=e.cursor,a=[];if(!i.firstChild())return a;if(null!=s)for(;!i.type.is(s);)if(!i.nextSibling())return a;for(;;){if(null!=r&&i.type.is(r))return a;if(i.type.is(t)&&a.push(i.node),!i.nextSibling())return null==r?a:[]}}class v{constructor(e,t,s,r){this.parent=e,this.buffer=t,this.index=s,this.start=r}}class x{constructor(e,t,s){this.context=e,this._parent=t,this.index=s,this.type=e.buffer.set.types[e.buffer.buffer[s]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,s){let{buffer:r}=this.context,i=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,s);return i<0?null:new x(this.context,this,i)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,s,r=!0){if(!r)return null;let{buffer:i}=this.context,a=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return a<0?null:new x(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new x(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new x(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get cursor(){return new _(this)}get tree(){return null}toTree(){let e=[],t=[],{buffer:s}=this.context,r=this.index+4,i=s.buffer[this.index+3];if(i>r){let a=s.buffer[this.index+1],n=s.buffer[this.index+2];e.push(s.slice(r,i,a,n)),t.push(0)}return new d(this.type,e,t,this.to-this.from)}resolve(e,t=0){return y(this,e,t,!1)}resolveInner(e,t=0){return y(this,e,t,!0)}enterUnfinishedNodesBefore(e){return g(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,s=null){let r=O(this,e,t,s);return r.length?r[0]:null}getChildren(e,t=null,s=null){return O(this,e,t,s)}}class _{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof b)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:s,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=s+r.buffer[e+1],this.to=s+r.buffer[e+2],!0}yield(e){return!!e&&(e instanceof b?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,s){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,s,this.mode));let{buffer:r}=this.buffer,i=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,s);return!(i<0)&&(this.stack.push(this.index),this.yieldBuf(i))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,s=!0,r=!0){return this.buffer?!!r&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,s&&!(1&this.mode),r))}parent(){if(!this.buffer)return this.yieldNode(1&this.mode?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=1&this.mode?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,s=this.stack.length-1;if(e<0){let e=s<0?0:this.stack[s]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(s<0?t.buffer.length:t.buffer[this.stack[s]+3]))return this.yieldBuf(e)}return s<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,s,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(r.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:s}=r)}else({index:t,_parent:s}=this._tree);for(;s;({index:t,_parent:s}=s))if(t>-1)for(let r=t+e,i=e<0?-1:s.node.children.length;r!=i;r+=e){let e=s.node.children[r];if(1&this.mode||e instanceof f||!e.type.isAnonymous||$(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,s=0;if(e&&e.context==this.buffer)e:for(let r=this.index,i=this.stack.length;i>=0;){for(let a=e;a;a=a._parent)if(a.index==r){if(r==this.index)return a;t=a,s=i+1;break e}r=this.stack[--i]}for(let e=s;e<this.stack.length;e++)t=new x(this.buffer,t,this.stack[e]);return this.bufferNode=new x(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree.node}}function $(e){return e.children.some((e=>e instanceof f||!e.type.isAnonymous||$(e)))}const k=new WeakMap;function w(e,t){if(!e.isAnonymous||t instanceof f||t.type!=e)return 1;let s=k.get(t);if(null==s){s=1;for(let r of t.children){if(r.type!=e||!(r instanceof d)){s=1;break}s+=w(e,r)}k.set(t,s)}return s}function S(e,t,s,r,i,a,n,o,l){let u=0;for(let s=r;s<i;s++)u+=w(e,t[s]);let c=Math.ceil(1.5*u/8),h=[],d=[];return function t(s,r,i,n,o){for(let u=i;u<n;){let i=u,p=r[u],f=w(e,s[u]);for(u++;u<n;u++){let t=w(e,s[u]);if(f+t>=c)break;f+=t}if(u==i+1){if(f>c){let e=s[i];t(e.children,e.positions,0,e.children.length,r[i]+o);continue}h.push(s[i])}else{let t=r[u-1]+s[u-1].length-p;h.push(S(e,s,r,i,u,p,t,null,l))}d.push(p+o-a)}}(t,s,r,i,0),(o||l)(h,d,n)}class P{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new n({perNode:!0});class T{constructor(e,t,s,r,i,a,n,o,l,u=0,c){this.p=e,this.stack=t,this.state=s,this.reducePos=r,this.pos=i,this.score=a,this.buffer=n,this.bufferBase=o,this.curContext=l,this.lookAhead=u,this.parent=c}toString(){return`[${this.stack.filter(((e,t)=>t%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,s=0){let r=e.parser.context;return new T(e,[],t,s,s,0,[],0,r?new Q(r,r.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){let t=e>>19,s=65535&e,{parser:r}=this.p,i=r.dynamicPrecedence(s);if(i&&(this.score+=i),0==t)return this.pushState(r.getGoto(this.state,s,!0),this.reducePos),s<r.minRepeatTerm&&this.storeNode(s,this.reducePos,this.reducePos,4,!0),void this.reduceContext(s,this.reducePos);let a=this.stack.length-3*(t-1)-(262144&e?6:0),n=this.stack[a-2],o=this.stack[a-1],l=this.bufferBase+this.buffer.length-o;if(s<r.minRepeatTerm||131072&e){let e=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(s,n,e,l+4,!0)}if(262144&e)this.state=this.stack[a];else{let e=this.stack[a-3];this.state=r.getGoto(e,s,!0)}for(;this.stack.length>a;)this.stack.pop();this.reduceContext(s,n)}storeNode(e,t,s,r=4,i=!1){if(0==e){let e=this,r=this.buffer.length;if(0==r&&e.parent&&(r=e.bufferBase-e.parent.bufferBase,e=e.parent),r>0&&0==e.buffer[r-4]&&e.buffer[r-1]>-1){if(t==s)return;if(e.buffer[r-2]>=t)return void(e.buffer[r-2]=s)}}if(i&&this.pos!=s){let i=this.buffer.length;if(i>0&&0!=this.buffer[i-4])for(;i>0&&this.buffer[i-2]>s;)this.buffer[i]=this.buffer[i-4],this.buffer[i+1]=this.buffer[i-3],this.buffer[i+2]=this.buffer[i-2],this.buffer[i+3]=this.buffer[i-1],i-=4,r>4&&(r-=4);this.buffer[i]=e,this.buffer[i+1]=t,this.buffer[i+2]=s,this.buffer[i+3]=r}else this.buffer.push(e,t,s,r)}shift(e,t,s){let r=this.pos;if(131072&e)this.pushState(65535&e,this.pos);else if(0==(262144&e)){let i=e,{parser:a}=this.p;(s>this.pos||t<=a.maxNode)&&(this.pos=s,a.stateFlag(i,1)||(this.reducePos=s)),this.pushState(i,r),this.shiftContext(t,r),t<=a.maxNode&&this.buffer.push(t,r,s,4)}else this.pos=s,this.shiftContext(t,r),t<=this.p.parser.maxNode&&this.buffer.push(t,r,s,4)}apply(e,t,s){65536&e?this.reduce(e):this.shift(e,t,s)}useNode(e,t){let s=this.p.reused.length-1;(s<0||this.p.reused[s]!=e)&&(this.p.reused.push(e),s++);let r=this.pos;this.reducePos=this.pos=r+e.length,this.pushState(t,r),this.buffer.push(s,r,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let s=e.buffer.slice(t),r=e.bufferBase+t;for(;e&&r==e.bufferBase;)e=e.parent;return new T(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,s,r,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let s=e<=this.p.parser.maxNode;s&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,s?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new j(this);;){let s=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==(65536&s))return!0;if(0==s)return!1;t.reduce(s)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let s=[];for(let r,i=0;i<t.length;i+=2)(r=t[i+1])!=this.state&&this.p.parser.hasAction(r,e)&&s.push(t[i],r);if(this.stack.length<120)for(let e=0;s.length<8&&e<t.length;e+=2){let r=t[e+1];s.some(((e,t)=>1&t&&e==r))||s.push(t[e],r)}t=s}let s=[];for(let e=0;e<t.length&&s.length<4;e+=2){let r=t[e+1];if(r==this.state)continue;let i=this.split();i.storeNode(0,i.pos,i.pos,4,!0),i.pushState(r,this.pos),i.shiftContext(t[e],this.pos),i.score-=200,s.push(i)}return s}forceReduce(){let e=this.p.parser.stateSlot(this.state,5);if(0==(65536&e))return!1;let{parser:t}=this.p;if(!t.validAction(this.state,e)){let s=e>>19,r=65535&e,i=this.stack.length-3*s;if(i<0||t.getGoto(this.stack[i],r,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reduce(e),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new Q(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class Q{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}var C;!function(e){e[e.Insert=200]="Insert",e[e.Delete=190]="Delete",e[e.Reduce=100]="Reduce",e[e.MaxNext=4]="MaxNext",e[e.MaxInsertStackDepth=300]="MaxInsertStackDepth",e[e.DampenInsertStackDepth=120]="DampenInsertStackDepth"}(C||(C={}));class j{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,s=e>>19;0==s?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(s-1);let r=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=r}}class E{constructor(e,t,s){this.stack=e,this.pos=t,this.index=s,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new E(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new E(this.stack,this.pos,this.index)}}class q{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const A=new q;class I{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=A,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let s=this.range,r=this.rangeIndex,i=this.pos+e;for(;i<s.from;){if(!r)return null;let e=this.ranges[--r];i-=s.from-e.to,s=e}for(;t<0?i>s.to:i>=s.to;){if(r==this.ranges.length-1)return null;let e=this.ranges[++r];i+=e.from-s.to,s=e}return i}peek(e){let t,s,r=this.chunkOff+e;if(r>=0&&r<this.chunk.length)t=this.pos+e,s=this.chunk.charCodeAt(r);else{let r=this.resolveOffset(e,1);if(null==r)return-1;if(t=r,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)s=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,r=this.range;for(;r.to<=t;)r=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>r.to&&(this.chunk2=this.chunk2.slice(0,r.to-t)),s=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),s}acceptToken(e,t=0){let s=t?this.resolveOffset(t,-1):this.pos;if(null==s||s<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=s}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=A,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let s="";for(let r of this.ranges){if(r.from>=t)break;r.to>e&&(s+=this.input.read(Math.max(r.from,e),Math.min(r.to,t)))}return s}}class z{constructor(e,t){this.data=e,this.id=t}token(e,t){!function(e,t,s,r){let i=0,a=1<<r,{parser:n}=s.p,{dialect:o}=n;e:for(;0!=(a&e[i]);){let s=e[i+1];for(let r=i+3;r<s;r+=2)if((e[r+1]&a)>0){let s=e[r];if(o.allows(s)&&(-1==t.token.value||t.token.value==s||n.overrides(s,t.token.value))){t.acceptToken(s);break}}for(let r=t.next,a=0,n=e[i+2];a<n;){let o=a+n>>1,l=s+o+(o<<1),u=e[l],c=e[l+1];if(r<u)n=o;else{if(!(r>=c)){i=e[l+2],t.advance();continue e}a=o+1}}break}}(this.data,e,t,this.id)}}z.prototype.contextual=z.prototype.fallback=z.prototype.extend=!1;function L(e,t=Uint16Array){if("string"!=typeof e)return e;let s=null;for(let r=0,i=0;r<e.length;){let a=0;for(;;){let t=e.charCodeAt(r++),s=!1;if(126==t){a=65535;break}t>=92&&t--,t>=34&&t--;let i=t-32;if(i>=46&&(i-=46,s=!0),a+=i,s)break;a*=46}s?s[i++]=a:s=new t(a)}return s}const R="undefined"!=typeof process&&/\bparse\b/.test(process.env.LOG);let D=null;var X,M;function F(e,t,s){let r=e.fullCursor();for(r.moveTo(t);;)if(!(s<0?r.childBefore(t):r.childAfter(t)))for(;;){if((s<0?r.to<t:r.from>t)&&!r.type.isError)return s<0?Math.max(0,Math.min(r.to-1,t-25)):Math.min(e.length,Math.max(r.from+1,t+25));if(s<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return s<0?0:e.length}}!function(e){e[e.Margin=25]="Margin"}(X||(X={}));class N{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?F(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?F(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let s=this.trees[t],r=this.index[t];if(r==s.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let i=s.children[r],a=this.start[t]+s.positions[r];if(a>e)return this.nextStart=a,null;if(i instanceof d){if(a==e){if(a<this.safeFrom)return null;let e=a+i.length;if(e<=this.safeTo){let t=i.prop(n.lookAhead);if(!t||e+t<this.fragment.to)return i}}this.index[t]++,a+i.length>=Math.max(this.safeFrom,e)&&(this.trees.push(i),this.start.push(a),this.index.push(0))}else this.index[t]++,this.nextStart=a+i.length}}}class G{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new q))}getActions(e){let t=0,s=null,{parser:r}=e.p,{tokenizers:i}=r,a=r.stateSlot(e.state,3),n=e.curContext?e.curContext.hash:0,o=0;for(let r=0;r<i.length;r++){if(0==(1<<r&a))continue;let l=i[r],u=this.tokens[r];if((!s||l.fallback)&&((l.contextual||u.start!=e.pos||u.mask!=a||u.context!=n)&&(this.updateCachedToken(u,l,e),u.mask=a,u.context=n),u.lookAhead>u.end+25&&(o=Math.max(u.lookAhead,o)),0!=u.value)){let r=t;if(u.extended>-1&&(t=this.addActions(e,u.extended,u.end,t)),t=this.addActions(e,u.value,u.end,t),!l.extend&&(s=u,t>r))break}}for(;this.actions.length>t;)this.actions.pop();return o&&e.setLookAhead(o),s||e.pos!=this.stream.end||(s=new q,s.value=e.p.parser.eofTerm,s.start=s.end=e.pos,t=this.addActions(e,s.value,s.end,t)),this.mainToken=s,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new q,{pos:s,p:r}=e;return t.start=s,t.end=Math.min(s+1,r.stream.end),t.value=s==r.stream.end?r.parser.eofTerm:0,t}updateCachedToken(e,t,s){if(t.token(this.stream.reset(s.pos,e),s),e.value>-1){let{parser:t}=s.p;for(let r=0;r<t.specialized.length;r++)if(t.specialized[r]==e.value){let i=t.specializers[r](this.stream.read(e.start,e.end),s);if(i>=0&&s.p.parser.dialect.allows(i>>1)){0==(1&i)?e.value=i>>1:e.extended=i>>1;break}}}else e.value=0,e.end=Math.min(s.p.stream.end,s.pos+1)}putAction(e,t,s,r){for(let t=0;t<r;t+=3)if(this.actions[t]==e)return r;return this.actions[r++]=e,this.actions[r++]=t,this.actions[r++]=s,r}addActions(e,t,s,r){let{state:i}=e,{parser:a}=e.p,{data:n}=a;for(let e=0;e<2;e++)for(let o=a.stateSlot(i,e?2:1);;o+=3){if(65535==n[o]){if(1!=n[o+1]){0==r&&2==n[o+1]&&(r=this.putAction(H(n,o+2),t,s,r));break}o=H(n,o+2)}n[o]==t&&(r=this.putAction(H(n,o+1),t,s,r))}return r}}!function(e){e[e.Distance=5]="Distance",e[e.MaxRemainingPerStep=3]="MaxRemainingPerStep",e[e.MinBufferLengthPrune=500]="MinBufferLengthPrune",e[e.ForceReduceLimit=10]="ForceReduceLimit",e[e.CutDepth=15e3]="CutDepth",e[e.CutTo=9e3]="CutTo"}(M||(M={}));class V{constructor(e,t,s,r){this.parser=e,this.input=t,this.ranges=r,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new I(t,r),this.tokens=new G(e,this.stream),this.topTerm=e.top[1];let{from:i}=r[0];this.stacks=[T.start(this,e.top[0],i)],this.fragments=s.length&&this.stream.end-i>4*e.bufferLength?new N(s,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,s=this.stacks,r=this.minStackPos,i=this.stacks=[];for(let a=0;a<s.length;a++){let n=s[a];for(;;){if(this.tokens.mainToken=null,n.pos>r)i.push(n);else{if(this.advanceStack(n,i,s))continue;{e||(e=[],t=[]),e.push(n);let s=this.tokens.getMainToken(n);t.push(s.value,s.end)}}break}}if(!i.length){let t=e&&function(e){let t=null;for(let s of e){let e=s.p.stoppedAt;(s.pos==s.p.stream.end||null!=e&&s.pos>e)&&s.p.parser.stateFlag(s.state,2)&&(!t||t.score<s.score)&&(t=s)}return t}(e);if(t)return this.stackToTree(t);if(this.parser.strict)throw R&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+r);this.recovering||(this.recovering=5)}if(this.recovering&&e){let s=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,i);if(s)return this.stackToTree(s.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(i.length>e)for(i.sort(((e,t)=>t.score-e.score));i.length>e;)i.pop();i.some((e=>e.reducePos>r))&&this.recovering--}else if(i.length>1)e:for(let e=0;e<i.length-1;e++){let t=i[e];for(let s=e+1;s<i.length;s++){let r=i[s];if(t.sameState(r)||t.buffer.length>500&&r.buffer.length>500){if(!((t.score-r.score||t.buffer.length-r.buffer.length)>0)){i.splice(e--,1);continue e}i.splice(s--,1)}}}this.minStackPos=i[0].pos;for(let e=1;e<i.length;e++)i[e].pos<this.minStackPos&&(this.minStackPos=i[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,s){let r=e.pos,{parser:i}=this,a=R?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&r>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,s=t?e.curContext.hash:0;for(let o=this.fragments.nodeAt(r);o;){let r=this.parser.nodeSet.types[o.type.id]==o.type?i.getGoto(e.state,o.type.id):-1;if(r>-1&&o.length&&(!t||(o.prop(n.contextHash)||0)==s))return e.useNode(o,r),R&&console.log(a+this.stackID(e)+` (via reuse of ${i.getName(o.type.id)})`),!0;if(!(o instanceof d)||0==o.children.length||o.positions[0]>0)break;let l=o.children[0];if(!(l instanceof d&&0==o.positions[0]))break;o=l}}let o=i.stateSlot(e.state,4);if(o>0)return e.reduce(o),R&&console.log(a+this.stackID(e)+` (via always-reduce ${i.getName(65535&o)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let n=0;n<l.length;){let o=l[n++],u=l[n++],c=l[n++],h=n==l.length||!s,d=h?e:e.split();if(d.apply(o,u,c),R&&console.log(a+this.stackID(d)+` (via ${0==(65536&o)?"shift":`reduce of ${i.getName(65535&o)}`} for ${i.getName(u)} @ ${r}${d==e?"":", split"})`),h)return!0;d.pos>r?t.push(d):s.push(d)}return!1}advanceFully(e,t){let s=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>s)return B(e,t),!0}}runRecovery(e,t,s){let r=null,i=!1;for(let a=0;a<e.length;a++){let n=e[a],o=t[a<<1],l=t[1+(a<<1)],u=R?this.stackID(n)+" -> ":"";if(n.deadEnd){if(i)continue;if(i=!0,n.restart(),R&&console.log(u+this.stackID(n)+" (restarted)"),this.advanceFully(n,s))continue}let c=n.split(),h=u;for(let e=0;c.forceReduce()&&e<10;e++){if(R&&console.log(h+this.stackID(c)+" (via force-reduce)"),this.advanceFully(c,s))break;R&&(h=this.stackID(c)+" -> ")}for(let e of n.recoverByInsert(o))R&&console.log(u+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,s);this.stream.end>n.pos?(l==n.pos&&(l++,o=0),n.recoverByDelete(o,l),R&&console.log(u+this.stackID(n)+` (via recover-delete ${this.parser.getName(o)})`),B(n,s)):(!r||r.score<n.score)&&(r=n)}return r}stackToTree(e){return e.close(),d.build({buffer:E.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(D||(D=new WeakMap)).get(e);return t||D.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function B(e,t){for(let s=0;s<t.length;s++){let r=t[s];if(r.pos==e.pos&&r.sameState(e))return void(t[s].score<e.score&&(t[s]=e))}t.push(e)}class U{constructor(e,t,s){this.source=e,this.flags=t,this.disabled=s}allows(e){return!this.disabled||0==this.disabled[e]}}class W extends class{startParse(e,t,s){return"string"==typeof e&&(e=new P(e)),s=s?s.length?s.map((e=>new a(e.from,e.to))):[new a(0,0)]:[new a(0,e.length)],this.createParse(e,t||[],s)}parse(e,t,s){let r=this.startParse(e,t,s);for(;;){let e=r.advance();if(e)return e}}}{constructor(e){if(super(),this.wrappers=[],13!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (13)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let s=0;s<e.repeatNodeCount;s++)t.push("");let s=Object.keys(e.topRules).map((t=>e.topRules[t][1])),i=[];for(let e=0;e<t.length;e++)i.push([]);function a(e,t,s){i[e].push([t,t.deserialize(String(s))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];for(let s=1;s<t.length;){let r=t[s++];if(r>=0)a(r,e,t[s++]);else{let i=t[s+-r];for(let n=-r;n>0;n--)a(t[s++],e,i);s++}}}this.nodeSet=new u(t.map(((t,r)=>l.define({name:r>=this.minRepeatTerm?void 0:t,id:r,props:i[r],top:s.indexOf(r)>-1,error:0==r,skipped:e.skippedNodes&&e.skippedNodes.indexOf(r)>-1})))),this.strict=!1,this.bufferLength=r;let n=L(e.tokenData);if(this.context=e.context,this.specialized=new Uint16Array(e.specialized?e.specialized.length:0),this.specializers=[],e.specialized)for(let t=0;t<e.specialized.length;t++)this.specialized[t]=e.specialized[t].term,this.specializers[t]=e.specialized[t].get;this.states=L(e.states,Uint32Array),this.data=L(e.stateData),this.goto=L(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new z(n,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,s){let r=new V(this,e,t,s);for(let i of this.wrappers)r=i(r,e,t,s);return r}getGoto(e,t,s=!1){let r=this.goto;if(t>=r[0])return-1;for(let i=r[t+1];;){let t=r[i++],a=1&t,n=r[i++];if(a&&s)return n;for(let s=i+(t>>1);i<s;i++)if(r[i]==e)return n;if(a)return-1}}hasAction(e,t){let s=this.data;for(let r=0;r<2;r++)for(let i,a=this.stateSlot(e,r?2:1);;a+=3){if(65535==(i=s[a])){if(1!=s[a+1]){if(2==s[a+1])return H(s,a+2);break}i=s[a=H(s,a+2)]}if(i==t||0==i)return H(s,a+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){if(t==this.stateSlot(e,4))return!0;for(let s=this.stateSlot(e,1);;s+=3){if(65535==this.data[s]){if(1!=this.data[s+1])return!1;s=H(this.data,s+2)}if(t==H(this.data,s+1))return!0}}nextStates(e){let t=[];for(let s=this.stateSlot(e,1);;s+=3){if(65535==this.data[s]){if(1!=this.data[s+1])break;s=H(this.data,s+2)}if(0==(1&this.data[s+2])){let e=this.data[s+1];t.some(((t,s)=>1&s&&t==e))||t.push(this.data[s],e)}}return t}overrides(e,t){let s=Z(this.data,this.tokenPrecTable,t);return s<0||Z(this.data,this.tokenPrecTable,e)<s}configure(e){let t=Object.assign(Object.create(W.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let s=this.topRules[e.top];if(!s)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=s}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let s=e.tokenizers.find((e=>e.from==t));return s?s.to:t}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),s=t.map((()=>!1));if(e)for(let r of e.split(" ")){let e=t.indexOf(r);e>=0&&(s[e]=!0)}let r=null;for(let e=0;e<t.length;e++)if(!s[e])for(let s,i=this.dialects[t[e]];65535!=(s=this.data[i++]);)(r||(r=new Uint8Array(this.maxTerm+1)))[s]=1;return new U(e,s,r)}static deserialize(e){return new W(e)}}function H(e,t){return e[t]|e[t+1]<<16}function Z(e,t,s){for(let r,i=t;65535!=(r=e[i]);i++)if(r==s)return i-t;return-1}}}]);
//# sourceMappingURL=2123.b208037f6b1954dc031d.js.map