"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4886],{"./public/app/features/alerting/unified/components/alert-groups/MatcherFilter.tsx":(e,a,t)=>{t.d(a,{F:()=>u});var n,s,r,i=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),l=(t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),t("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/0/cache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js")),o=t("./packages/grafana-ui/src/index.ts"),c=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const u=e=>{let{className:a,onFilterChange:t,defaultQueryString:i,queryString:u}=e;const d=(0,o.useStyles2)(p),m=n||(n=(0,c.jsx)(o.Icon,{name:"search"}));return(0,c.jsxs)("div",{className:a,children:[(0,c.jsx)(o.Label,{children:(0,c.jsxs)(l.Stack,{gap:.5,children:[s||(s=(0,c.jsx)("span",{children:"Search by label"})),(0,c.jsx)(o.Tooltip,{content:r||(r=(0,c.jsxs)("div",{children:["Filter alerts using label querying, ex:",(0,c.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'})]})),children:(0,c.jsx)(o.Icon,{className:d.icon,name:"info-circle",size:"sm"})})]})}),(0,c.jsx)(o.Input,{placeholder:"Search",defaultValue:i,value:u,onChange:e=>{const a=e.target;t(a.value)},"data-testid":"search-query-input",prefix:m,className:d.inputWidth})]})},p=e=>({icon:i.css`
    margin-right: ${e.spacing(.5)};
  `,inputWidth:i.css`
    width: 340px;
    flex-grow: 0;
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsActionButtons.tsx":(e,a,t)=>{t.d(a,{f:()=>U});var n=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),i=t("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),l=t("./packages/grafana-data/src/index.ts"),o=t("./packages/grafana-runtime/src/index.ts"),c=t("./packages/grafana-ui/src/index.ts"),u=t("./public/app/core/copy/appNotification.ts"),p=t("./public/app/core/services/context_srv.ts"),d=t("./public/app/types/index.ts"),m=t("./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts"),f=t("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),g=t("./public/app/features/alerting/unified/state/actions.ts"),h=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");var x,b=t("./public/app/features/alerting/unified/components/AlertLabel.tsx"),v=t("./public/app/features/alerting/unified/components/DynamicTable.tsx"),j=t("./public/app/features/alerting/unified/components/rules/AlertStateTag.tsx"),y=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const _=e=>{let{alertId:a}=e;const{loading:t,error:n,result:i=[]}=function(e){const a=(0,r.useDispatch)(),t=(0,h._)((e=>e.managedAlertStateHistory));return(0,s.useEffect)((()=>{a((0,g.Ms)(e))}),[a,e]),t}(a);if(t&&!n)return x||(x=(0,y.jsx)(c.LoadingPlaceholder,{text:"Loading history..."}));if(n&&!t)return(0,y.jsx)(c.Alert,{title:"Failed to fetch alert state history",children:n.message});const l=[{id:"state",label:"State",size:"max-content",renderCell:w},{id:"value",label:"",size:"auto",renderCell:S},{id:"timestamp",label:"Time",size:"max-content",renderCell:z}],o=i.reduce(((e,a,t)=>(e.push({id:String(a.id),state:a.newState,text:a.text,data:a.data,timestamp:a.updated}),function(e,a){const t=a[e],n=a[e+1];if(!n)return!1;return n.newState===t.prevState}(t,i)||e.push({id:(0,f.uniqueId)(),state:a.prevState}),e)),[]).map((e=>({id:e.id,data:e})));return(0,y.jsx)(v.t,{cols:l,items:o})};function S(e){var a,t;const n=null!==(a=null===(t=e.data.data)||void 0===t?void 0:t.evalMatches)&&void 0!==a?a:[];return(0,y.jsxs)(y.Fragment,{children:[e.data.text,(0,y.jsx)(k,{children:n.map((e=>(0,y.jsx)(b.i,{labelKey:e.metric,value:String(e.value)},e.metric)))})]})}function w(e){return(0,y.jsx)(j.l,{state:e.data.state})}function z(e){return(0,y.jsx)("div",{className:R,children:e.data.timestamp&&(0,y.jsx)("span",{children:(0,l.dateTimeFormat)(e.data.timestamp)})})}const k=e=>{let{children:a}=e;const{wrapper:t}=(0,c.useStyles)(C);return(0,y.jsx)("div",{className:t,children:a})},R=n.css`
  display: flex;
  align-items: flex-end;
  flex-direction: column;
`,C=e=>({wrapper:n.css`
    & > * {
      margin-right: ${e.spacing.xs};
    }
  `});var N,q,D=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),$=t("./public/app/features/alerting/unified/utils/constants.ts"),E=t("./public/app/features/alerting/unified/utils/datasource.ts"),F=t("./public/app/features/alerting/unified/utils/misc.ts"),M=t("./public/app/features/alerting/unified/utils/rule-id.ts"),I=t("./public/app/features/alerting/unified/utils/rules.ts");const U=e=>{var a,t;let{rule:n,rulesSource:f}=e;const h=(0,r.useDispatch)(),x=(0,i.TH)(),b=(0,u.iG)(),v=(0,c.useStyles2)(A),{namespace:j,group:S,rulerRule:w}=n,[z,k]=(0,s.useState)(),R=function(e){if(!e)return!1;return null!=e.grafana_alert}(n.rulerRule)&&null!==(a=n.rulerRule.grafana_alert.id)&&void 0!==a?a:"",{StateHistoryModal:C,showStateHistoryModal:U}=function(e){var a;const[t,n]=(0,s.useState)(!1);return{StateHistoryModal:(0,s.useMemo)((()=>(0,y.jsx)(c.Modal,{isOpen:t,onDismiss:()=>n(!1),closeOnBackdropClick:!0,closeOnEscape:!0,title:"State history",children:a||(a=(0,y.jsx)(_,{alertId:e}))})),[e,t]),showStateHistoryModal:()=>n(!0),hideStateHistoryModal:()=>n(!1)}}(R),L=(0,E.HY)(f)?f:null===(t=(0,D.Xy)(f.jsonData.alertmanagerUid))||void 0===t?void 0:t.name,B=(0,E.EG)(f),H=p.Vt.hasPermission(d.bW.DataSourcesExplore),V=[],O=[],T=(0,I.Jq)(S),{isEditable:G,isRemovable:P}=(0,m.M)(B,w),W=x.pathname+x.search,Z=x.pathname.endsWith("/view");const J=()=>{if(z&&z.rulerRule){const e=M.Zk((0,E.EG)(z.namespace.rulesSource),z.namespace.name,z.group.name,z.rulerRule);h((0,g.hS)(e,{navigateTo:Z?"/alerting/list":void 0})),k(void 0)}},Y=()=>{if((0,E.jq)(f)){const{appUrl:e,appSubUrl:a}=o.config;return`${""!==a?`${e}${a}/`:o.config.appUrl}alerting/${`${encodeURIComponent(f.name)}/${encodeURIComponent(n.name)}`}/find`}return window.location.href.split("?")[0]};if((0,E.jq)(f)&&H&&!T&&V.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",variant:"primary",icon:"chart-line",target:"__blank",href:(0,F.mH)(f.name,n.query),children:"See graph"},"explore")),n.annotations[$.q6.runbookURL]&&V.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",variant:"primary",icon:"book",target:"__blank",href:n.annotations[$.q6.runbookURL],children:"View runbook"},"runbook")),n.annotations[$.q6.dashboardUID]){const e=n.annotations[$.q6.dashboardUID];if(e){V.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(e)}`,children:"Go to dashboard"},"dashboard"));const a=n.annotations[$.q6.panelID];a&&V.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(e)}?viewPanel=${encodeURIComponent(a)}`,children:"Go to panel"},"panel"))}}if(L&&p.Vt.hasAccess(d.bW.AlertingInstanceCreate,p.Vt.isEditor)&&V.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",icon:"bell-slash",target:"__blank",href:(0,F.Vv)(L,n),children:"Silence"},"silence")),R&&V.push((0,y.jsxs)(s.Fragment,{children:[(0,y.jsx)(c.Button,{className:v.button,size:"xs",icon:"history",onClick:()=>U(),children:"Show state history"}),C]},"history")),Z||O.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",variant:"secondary",icon:"eye",href:(0,F.V2)(f,n,W),children:"View"},"view")),G&&w&&!T){const e=(0,E.EG)(f),a=M.Zk(e,j.name,S.name,w),t=l.urlUtil.renderUrl(`${o.config.appSubUrl}/alerting/${encodeURIComponent(M.$V(a))}/edit`,{returnTo:W});Z&&O.push((0,y.jsx)(c.ClipboardButton,{onClipboardCopy:()=>{b.success("URL copied!")},onClipboardError:e=>{b.error("Error while copying URL",e.text)},className:v.button,size:"sm",getText:Y,children:"Copy link to rule"},"copy")),O.push((0,y.jsx)(c.LinkButton,{className:v.button,size:"xs",variant:"secondary",icon:"pen",href:t,children:"Edit"},"edit"))}return P&&w&&!T&&O.push((0,y.jsx)(c.Button,{className:v.button,size:"xs",type:"button",variant:"secondary",icon:"trash-alt",onClick:()=>k(n),children:"Delete"},"delete")),V.length||O.length?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:v.wrapper,children:[(0,y.jsx)(c.HorizontalGroup,{width:"auto",children:V.length?V:N||(N=(0,y.jsx)("div",{}))}),(0,y.jsx)(c.HorizontalGroup,{width:"auto",children:O.length?O:q||(q=(0,y.jsx)("div",{}))})]}),!!z&&(0,y.jsx)(c.ConfirmModal,{isOpen:!0,title:"Delete rule",body:"Deleting this rule will permanently remove it from your alert rule list. Are you sure you want to delete this rule?",confirmText:"Yes, delete",icon:"exclamation-triangle",onConfirm:J,onDismiss:()=>k(void 0)})]}):null};const A=e=>({wrapper:n.css`
    padding: ${e.spacing(2)} 0;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    flex-wrap: wrap;
    border-bottom: solid 1px ${e.colors.border.medium};
  `,button:n.css`
    height: 24px;
    margin-top: ${e.spacing(1)};
    font-size: ${e.typography.size.sm};
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsAnnotations.tsx":(e,a,t)=>{t.d(a,{J:()=>l});var n=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=(t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),t("./packages/grafana-ui/src/index.ts")),r=t("./public/app/features/alerting/unified/components/AnnotationDetailsField.tsx"),i=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function l(e){const{annotations:a}=e,t=(0,s.useStyles2)(o);return 0===a.length?null:(0,i.jsx)("div",{className:t.annotations,children:a.map((e=>{let[a,t]=e;return(0,i.jsx)(r.a,{annotationKey:a,value:t},a)}))})}const o=()=>({annotations:n.css`
    margin-top: 46px;
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsDataSources.tsx":(e,a,t)=>{t.d(a,{C:()=>d});var n=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=t("./packages/grafana-runtime/src/index.ts"),i=t("./packages/grafana-ui/src/index.ts"),l=t("./public/app/features/expressions/ExpressionDatasource.ts"),o=t("./public/app/features/alerting/unified/utils/datasource.ts"),c=t("./public/app/features/alerting/unified/utils/rules.ts"),u=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),p=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function d(e){const{rulesSource:a,rule:t}=e,n=(0,i.useStyles2)(m),d=(0,s.useMemo)((()=>{if((0,o.jq)(a))return[{name:a.name,icon:a.meta.info.logos.small}];if((0,c.Pc)(t.rulerRule)){const{data:e}=t.rulerRule.grafana_alert,a=e.reduce(((e,a)=>{const t=(0,r.getDataSourceSrv)().getInstanceSettings(a.datasourceUid);return t&&t.uid!==l.Yq?(e[t.name]={name:t.name,icon:t.meta.info.logos.small},e):e}),{});return Object.values(a)}return[]}),[t,a]);return 0===d.length?null:(0,p.jsx)(u.C,{label:"Data source",children:d.map(((e,a)=>{let{name:t,icon:s}=e;return(0,p.jsxs)("div",{children:[s&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("img",{alt:`${t} datasource logo`,className:n.dataSourceIcon,src:s})," "]}),t]},t)}))})}function m(e){const a=e.spacing(2);return{dataSourceIcon:n.css`
      width: ${a};
      height: ${a};
    `}}},"./public/app/features/alerting/unified/components/rules/RuleDetailsExpression.tsx":(e,a,t)=>{t.d(a,{C:()=>x});var n=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=t("./public/app/features/alerting/unified/utils/datasource.ts"),i=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),l=t("./.yarn/cache/prismjs-npm-1.27.0-ca4e1667c6-85c7f4a3e9.zip/node_modules/prismjs/prism.js"),o=t("./.yarn/__virtual__/@grafana-slate-react-virtual-047372596b/0/cache/@grafana-slate-react-npm-0.22.10-grafana-510bc0576d-3417c53d9d.zip/node_modules/@grafana/slate-react/lib/slate-react.es.js"),c=t("./packages/grafana-ui/src/index.ts"),u=t("./public/app/plugins/datasource/loki/syntax.ts"),p=t("./public/app/plugins/datasource/prometheus/promql.ts"),d=t("./public/app/features/alerting/unified/components/Well.tsx"),m=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const f=e=>{let{language:a,expr:t}=e;const n=(0,s.useMemo)((()=>[(0,c.SlatePrism)({onlyIn:e=>"code_block"===e.type,getSyntax:()=>a},Object.assign({},l.languages,{[a]:"logql"===a?u.ZP:p.ZP}))]),[a]),r=(0,s.useMemo)((()=>(0,c.makeValue)(t)),[t]);return(0,m.jsx)(o.ML,{plugins:n,value:r,readOnly:!0})},g=e=>{let{expression:a,rulesSource:t}=e;const s=(0,c.useStyles)(h);return(0,m.jsx)(d.t,{className:(0,n.cx)(s.well,"slate-query-field"),children:(0,r.jq)(t)?(0,m.jsx)(f,{expr:a,language:t.type===r.ye.Loki?"logql":"promql"}):a})},h=e=>({well:n.css`
    font-family: ${e.typography.fontFamily.monospace};
  `});function x(e){const{annotations:a,rulesSource:t,rule:s}=e,l=b();return(0,r.jq)(t)?(0,m.jsx)(i.C,{label:"Expression",horizontal:!0,className:(0,n.cx)({[l.exprRow]:!!a.length}),children:(0,m.jsx)(g,{expression:s.query,rulesSource:t})}):null}const b=()=>({exprRow:n.css`
    margin-bottom: 46px;
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsMatchingInstances.tsx":(e,a,t)=>{t.d(a,{M:()=>x});var n,s=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=t("./packages/grafana-ui/src/index.ts"),l=t("./public/app/features/alerting/unified/components/alert-groups/MatcherFilter.tsx"),o=t("./public/app/types/unified-alerting-dto.ts"),c=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const u=e=>{let{className:a,onStateFilterChange:t,stateFilter:s}=e;const r=Object.values(o.bj).map((e=>({label:e,value:e})));return(0,c.jsxs)("div",{className:a,children:[n||(n=(0,c.jsx)(i.Label,{children:"State"})),(0,c.jsx)(i.RadioButtonGroup,{options:r,value:s,onChange:t,onClick:e=>{e===s&&t(void 0)}})]})};var p=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),d=t("./public/app/features/alerting/unified/utils/misc.ts"),m=t("./public/app/plugins/panel/alertlist/types.ts"),f=t("./public/app/features/alerting/unified/utils/rules.ts"),g=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),h=t("./public/app/features/alerting/unified/components/rules/AlertInstancesTable.tsx");function x(e){const{promRule:a}=e,[t,n]=(0,r.useState)(),[o,x]=(0,r.useState)(),[v]=(0,r.useState)(Math.floor(100*Math.random())),j=`queryString-${v}`,y=(0,i.useStyles)(b),_=(0,r.useMemo)((()=>{var e;return(0,f.x_)(a)&&null!==(e=a.alerts)&&void 0!==e&&e.length?function(e,a,t){let n=[...t];if(e){const a=(0,p.Zh)(e||"");n=n.filter((e=>{let{labels:t}=e;return(0,p.eD)(t,a)}))}a&&(n=n.filter((e=>e.state===a)));return n}(t,o,(0,d.Zl)(m.As.Importance,a.alerts)):[]}),[a,o,t]);return(0,f.x_)(a)?(0,c.jsxs)(g.C,{label:"Matching instances",horizontal:!0,children:[(0,c.jsx)("div",{className:(0,s.cx)(y.flexRow,y.spaceBetween),children:(0,c.jsxs)("div",{className:y.flexRow,children:[(0,c.jsx)(l.F,{className:y.rowChild,defaultQueryString:t,onFilterChange:e=>n(e)},j),(0,c.jsx)(u,{className:y.rowChild,stateFilter:o,onStateFilterChange:x})]})}),(0,c.jsx)(h.o,{instances:_})]}):null}const b=e=>({flexRow:s.css`
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      width: 100%;
      flex-wrap: wrap;
      margin-bottom: ${e.spacing.sm};
    `,spaceBetween:s.css`
      justify-content: space-between;
    `,rowChild:s.css`
      margin-right: ${e.spacing.sm};
    `})},"./public/app/features/alerting/unified/components/rules/RuleHealth.tsx":(e,a,t)=>{t.d(a,{V:()=>o});var n,s,r=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=(t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),t("./packages/grafana-ui/src/index.ts")),l=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const o=e=>{let{rule:a}=e;const t=(0,i.useStyles2)(c);return"err"===a.health||"error"===a.health?(0,l.jsx)(i.Tooltip,{theme:"error",content:a.lastError||"No error message provided.",children:(0,l.jsxs)("div",{className:t.warn,children:[n||(n=(0,l.jsx)(i.Icon,{name:"exclamation-triangle"})),s||(s=(0,l.jsx)("span",{children:"error"}))]})}):(0,l.jsx)(l.Fragment,{children:a.health})},c=e=>({warn:r.css`
    display: inline-flex;
    flex-direction: row;
    color: ${e.colors.warning.text};
    & > * + * {
      margin-left: ${e.spacing(1)};
    }
  `})},"./public/app/features/alerting/unified/components/rules/RuleState.tsx":(e,a,t)=>{t.d(a,{p:()=>m});var n,s,r=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),l=t("./packages/grafana-data/src/index.ts"),o=t("./packages/grafana-ui/src/index.ts"),c=t("./public/app/types/unified-alerting-dto.ts"),u=t("./public/app/features/alerting/unified/utils/rules.ts"),p=t("./public/app/features/alerting/unified/components/rules/AlertStateTag.tsx"),d=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const m=e=>{let{rule:a,isDeleting:t,isCreating:r}=e;const m=(0,o.useStyles2)(f),{promRule:g}=a,h=(0,i.useMemo)((()=>{var e;if(g&&(0,u.x_)(g)&&null!==(e=g.alerts)&&void 0!==e&&e.length&&g.state!==c.x_.Inactive){const e=(0,u.ub)(g);if(e)return(0,d.jsxs)("span",{title:String(e),className:m.for,children:["for"," ",(0,l.intervalToAbbreviatedDurationString)({start:e,end:new Date},!1)]})}return null}),[g,m]);return t?n||(n=(0,d.jsxs)(o.HorizontalGroup,{align:"flex-start",children:[(0,d.jsx)(o.Spinner,{}),"deleting"]})):r?s||(s=(0,d.jsxs)(o.HorizontalGroup,{align:"flex-start",children:[" ",(0,d.jsx)(o.Spinner,{}),"creating"]})):g&&(0,u.x_)(g)?(0,d.jsxs)(o.HorizontalGroup,{align:"flex-start",children:[(0,d.jsx)(p.l,{state:g.state}),h]}):g&&(0,u.OP)(g)?(0,d.jsx)(d.Fragment,{children:"Recording rule"}):(0,d.jsx)(d.Fragment,{children:"n/a"})},f=e=>({for:r.css`
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    padding-top: 2px;
  `})},"./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts":(e,a,t)=>{t.d(a,{Kd:()=>o,Zo:()=>l});var n=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=t("./public/app/features/alerting/unified/utils/datasource.ts"),r=t("./public/app/features/alerting/unified/utils/rules.ts"),i=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function l(e){const a=(0,i._)((e=>e.promRules)),t=(0,i._)((e=>e.rulerRules)),l=(0,n.useRef)({}),o=(0,n.useMemo)((()=>{if(e){const a=(0,s.o_)(e);if(!a)throw new Error(`Unknown rules source: ${e}`);return[a]}return(0,s.h_)()}),[e]);return(0,n.useMemo)((()=>o.map((e=>{var n,i;const o=(0,s.jq)(e)?e.name:e,u=null===(n=a[o])||void 0===n?void 0:n.result,p=null===(i=t[o])||void 0===i?void 0:i.result,d=l.current[o];if(d&&d.promRules===u&&d.rulerRules===p)return d.result;const m={};Object.entries(p||{}).forEach((a=>{let[t,n]=a;const s={rulesSource:e,name:t,groups:[]};m[t]=s,function(e,a){e.groups=a.map((a=>{const t={name:a.name,interval:a.interval,source_tenants:a.source_tenants,rules:[]};return t.rules=a.rules.map((a=>function(e,a,t){return(0,r.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:t}:(0,r.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:a,group:t}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:t}}(a,e,t))),t}))}(s,n)})),null==u||u.forEach((a=>{let{name:t,groups:n}=a;!function(e,a){a.forEach((a=>{var t;let n=e.groups.find((e=>e.name===a.name));n||(n={name:a.name,rules:[]},e.groups.push(n)),(null!==(t=a.rules)&&void 0!==t?t:[]).forEach((a=>{const t=function(e,a,t){var n;if((0,s.HY)(t))return a.rules.find((a=>a.name===e.name));return null!==(n=a.rules.find((a=>!a.promRule&&c(a,e,!0))))&&void 0!==n?n:a.rules.find((a=>!a.promRule&&c(a,e,!1)))}(a,n,e.rulesSource);t?t.promRule=a:n.rules.push(function(e,a,t){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,r.x_)(e)&&e.annotations||{},promRule:e,namespace:a,group:t}}(a,e,n))}))}))}(m[t]=m[t]||{rulesSource:e,name:t,groups:[]},n)}));const f=Object.values(m);return l.current[o]={promRules:u,rulerRules:p,result:f},f})).flat()),[a,t,o])}function o(e){return e.map((e=>{const a=Object.assign({},e,{groups:[]});var t;return a.groups.push({name:"default",rules:(t=e.groups.flatMap((e=>e.rules)),t.sort(((e,a)=>e.name.localeCompare(a.name))))}),a}))}function c(e,a){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===a.name&&JSON.stringify([t?u(e.query):"",e.labels,e.annotations])===JSON.stringify([t?u(a.query):"",a.labels||{},(0,r.x_)(a)&&a.annotations||{}])}function u(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},"./public/app/features/alerting/unified/hooks/useFolder.ts":(e,a,t)=>{t.d(a,{W:()=>o});var n=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=t("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),r=t("./public/app/features/alerting/unified/state/actions.ts"),i=t("./public/app/features/alerting/unified/utils/redux.ts"),l=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function o(e){const a=(0,s.useDispatch)(),t=(0,l._)((e=>e.folders));if((0,n.useEffect)((()=>{e&&a((0,r.sw)(e))}),[a,e]),e){const a=t[e]||i.oq;return{folder:a.result,loading:a.loading}}return{loading:!1}}},"./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts":(e,a,t)=>{t.d(a,{M:()=>o});var n=t("./public/app/core/services/context_srv.ts"),s=t("./public/app/features/alerting/unified/utils/access-control.ts"),r=t("./public/app/features/alerting/unified/utils/rules.ts"),i=t("./public/app/features/alerting/unified/hooks/useFolder.ts"),l=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function o(e,a){var t,o,c;const u=(0,l._)((e=>e.dataSources)),p=a&&(0,r.Pc)(a)?a.grafana_alert.namespace_uid:void 0,d=(0,s.Bz)(e),m=n.Vt.hasAccess(d.update,n.Vt.isEditor),f=n.Vt.hasAccess(d.delete,n.Vt.isEditor),{folder:g,loading:h}=(0,i.W)(p);if(!a)return{isEditable:!1,isRemovable:!1,loading:!1};if((0,r.Pc)(a)){if(!p)throw new Error(`Rule ${a.grafana_alert.title} does not have a folder uid, cannot determine if it is editable.`);return{isEditable:m&&(null==g?void 0:g.canSave),isRemovable:f&&(null==g?void 0:g.canSave),loading:h}}const x=Boolean(null===(t=u[e])||void 0===t||null===(o=t.result)||void 0===o?void 0:o.rulerConfig);return{isEditable:m&&x,isRemovable:f&&x,loading:null===(c=u[e])||void 0===c?void 0:c.loading}}}}]);
//# sourceMappingURL=4886.a87fd0ce1ff28bec28a3.js.map