{"version":3,"file":"DataSourceSettingsPage.a87fd0ce1ff28bec28a3.js","mappings":"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","sources":["webpack://grafana/./public/app/features/datasources/settings/BasicSettings.tsx","webpack://grafana/./public/app/features/datasources/settings/ButtonRow.tsx","webpack://grafana/./public/app/features/datasources/settings/CloudInfoBox.tsx","webpack://grafana/./public/app/features/datasources/settings/PluginSettings.tsx","webpack://grafana/./public/app/features/datasources/settings/DataSourceSettingsPage.tsx","webpack://grafana/./public/app/features/plugins/components/PluginStateInfo.tsx"],"sourcesContent":["import React, { FC } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { InlineField, InlineSwitch, Input } from '@grafana/ui';\n\nexport interface Props {\n  dataSourceName: string;\n  isDefault: boolean;\n  onNameChange: (name: string) => void;\n  onDefaultChange: (value: boolean) => void;\n}\n\nconst BasicSettings: FC<Props> = ({ dataSourceName, isDefault, onDefaultChange, onNameChange }) => {\n  return (\n    <div className=\"gf-form-group\" aria-label=\"Datasource settings page basic settings\">\n      <div className=\"gf-form-inline\">\n        <div className=\"gf-form max-width-30\">\n          <InlineField\n            label=\"Name\"\n            tooltip=\"The name is used when you select the data source in panels. The default data source is\n              'preselected in new panels.\"\n            grow\n          >\n            <Input\n              id=\"basic-settings-name\"\n              type=\"text\"\n              value={dataSourceName}\n              placeholder=\"Name\"\n              onChange={(event) => onNameChange(event.currentTarget.value)}\n              required\n              aria-label={selectors.pages.DataSource.name}\n            />\n          </InlineField>\n        </div>\n\n        <InlineField label=\"Default\" labelWidth={8}>\n          <InlineSwitch\n            id=\"basic-settings-default\"\n            value={isDefault}\n            onChange={(event: React.FormEvent<HTMLInputElement>) => {\n              onDefaultChange(event.currentTarget.checked);\n            }}\n          />\n        </InlineField>\n      </div>\n    </div>\n  );\n};\n\nexport default BasicSettings;\n","import React, { FC } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Button, LinkButton } from '@grafana/ui';\nimport { contextSrv } from 'app/core/core';\nimport { AccessControlAction } from 'app/types/';\n\nexport interface Props {\n  exploreUrl: string;\n  canSave: boolean;\n  canDelete: boolean;\n  onDelete: () => void;\n  onSubmit: (event: any) => void;\n  onTest: (event: any) => void;\n}\n\nconst ButtonRow: FC<Props> = ({ canSave, canDelete, onDelete, onSubmit, onTest, exploreUrl }) => {\n  const canExploreDataSources = contextSrv.hasPermission(AccessControlAction.DataSourcesExplore);\n\n  return (\n    <div className=\"gf-form-button-row\">\n      <Button variant=\"secondary\" fill=\"solid\" type=\"button\" onClick={() => history.back()}>\n        Back\n      </Button>\n      <LinkButton variant=\"secondary\" fill=\"solid\" href={exploreUrl} disabled={!canExploreDataSources}>\n        Explore\n      </LinkButton>\n      <Button\n        type=\"button\"\n        variant=\"destructive\"\n        disabled={!canDelete}\n        onClick={onDelete}\n        aria-label={selectors.pages.DataSource.delete}\n      >\n        Delete\n      </Button>\n      {canSave && (\n        <Button\n          type=\"submit\"\n          variant=\"primary\"\n          disabled={!canSave}\n          onClick={(event) => onSubmit(event)}\n          aria-label={selectors.pages.DataSource.saveAndTest}\n        >\n          Save &amp; test\n        </Button>\n      )}\n      {!canSave && (\n        <Button type=\"submit\" variant=\"primary\" onClick={onTest}>\n          Test\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default ButtonRow;\n","import React, { FC } from 'react';\n\nimport { DataSourceSettings } from '@grafana/data';\nimport { GrafanaEdition } from '@grafana/data/src/types/config';\nimport { Alert } from '@grafana/ui';\nimport { LocalStorageValueProvider } from 'app/core/components/LocalStorageValueProvider';\nimport { config } from 'app/core/config';\n\nconst LOCAL_STORAGE_KEY = 'datasources.settings.cloudInfoBox.isDismissed';\n\nexport interface Props {\n  dataSource: DataSourceSettings;\n}\n\nexport const CloudInfoBox: FC<Props> = ({ dataSource }) => {\n  let mainDS = '';\n  let extraDS = '';\n\n  // don't show for already configured data sources or provisioned data sources\n  if (dataSource.readOnly || (dataSource.version ?? 0) > 2) {\n    return null;\n  }\n\n  // Skip showing this info box in some editions\n  if (config.buildInfo.edition !== GrafanaEdition.OpenSource) {\n    return null;\n  }\n\n  switch (dataSource.type) {\n    case 'prometheus':\n      mainDS = 'Prometheus';\n      extraDS = 'Loki';\n      break;\n    case 'loki':\n      mainDS = 'Loki';\n      extraDS = 'Prometheus';\n      break;\n    default:\n      return null;\n  }\n\n  return (\n    <LocalStorageValueProvider<boolean> storageKey={LOCAL_STORAGE_KEY} defaultValue={false}>\n      {(isDismissed, onDismiss) => {\n        if (isDismissed) {\n          return null;\n        }\n        return (\n          <Alert\n            title={`Configure your ${mainDS} data source below`}\n            severity=\"info\"\n            bottomSpacing={4}\n            onRemove={() => {\n              onDismiss(true);\n            }}\n          >\n            Or skip the effort and get {mainDS} (and {extraDS}) as fully-managed, scalable, and hosted data sources from\n            Grafana Labs with the{' '}\n            <a\n              className=\"external-link\"\n              href={`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${dataSource.type}-settings`}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              title=\"The free plan includes 10k active metrics and 50gb storage.\"\n            >\n              free-forever Grafana Cloud plan\n            </a>\n            .\n          </Alert>\n        );\n      }}\n    </LocalStorageValueProvider>\n  );\n};\n","import { cloneDeep } from 'lodash';\nimport React, { PureComponent } from 'react';\n\nimport {\n  DataQuery,\n  DataSourceApi,\n  DataSourceJsonData,\n  DataSourcePlugin,\n  DataSourcePluginMeta,\n  DataSourceSettings,\n} from '@grafana/data';\nimport { AngularComponent, getAngularLoader } from '@grafana/runtime';\n\nexport type GenericDataSourcePlugin = DataSourcePlugin<DataSourceApi<DataQuery, DataSourceJsonData>>;\n\nexport interface Props {\n  plugin: GenericDataSourcePlugin;\n  dataSource: DataSourceSettings;\n  dataSourceMeta: DataSourcePluginMeta;\n  onModelChange: (dataSource: DataSourceSettings) => void;\n}\n\nexport class PluginSettings extends PureComponent<Props> {\n  element: HTMLDivElement | null = null;\n  component?: AngularComponent;\n  scopeProps: {\n    ctrl: { datasourceMeta: DataSourcePluginMeta; current: DataSourceSettings };\n    onModelChanged: (dataSource: DataSourceSettings) => void;\n  };\n\n  constructor(props: Props) {\n    super(props);\n\n    this.scopeProps = {\n      ctrl: { datasourceMeta: props.dataSourceMeta, current: cloneDeep(props.dataSource) },\n      onModelChanged: this.onModelChanged,\n    };\n    this.onModelChanged = this.onModelChanged.bind(this);\n  }\n\n  componentDidMount() {\n    const { plugin } = this.props;\n\n    if (!this.element) {\n      return;\n    }\n\n    if (!plugin.components.ConfigEditor) {\n      // React editor is not specified, let's render angular editor\n      // How to approach this better? Introduce ReactDataSourcePlugin interface and typeguard it here?\n      const loader = getAngularLoader();\n      const template = '<plugin-component type=\"datasource-config-ctrl\" />';\n\n      this.component = loader.load(this.element, this.scopeProps, template);\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { plugin } = this.props;\n    if (!plugin.components.ConfigEditor && this.props.dataSource !== prevProps.dataSource) {\n      this.scopeProps.ctrl.current = cloneDeep(this.props.dataSource);\n\n      this.component?.digest();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.component) {\n      this.component.destroy();\n    }\n  }\n\n  onModelChanged = (dataSource: DataSourceSettings) => {\n    this.props.onModelChange(dataSource);\n  };\n\n  render() {\n    const { plugin, dataSource } = this.props;\n\n    if (!plugin) {\n      return null;\n    }\n\n    return (\n      <div ref={(element) => (this.element = element)}>\n        {plugin.components.ConfigEditor &&\n          React.createElement(plugin.components.ConfigEditor, {\n            options: dataSource,\n            onOptionsChange: this.onModelChanged,\n          })}\n      </div>\n    );\n  }\n}\n\nexport default PluginSettings;\n","import React, { PureComponent } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\n\nimport { DataSourceSettings, urlUtil } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Alert, Button } from '@grafana/ui';\nimport { cleanUpAction } from 'app/core/actions/cleanUp';\nimport appEvents from 'app/core/app_events';\nimport Page from 'app/core/components/Page/Page';\nimport { contextSrv } from 'app/core/core';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { PluginStateInfo } from 'app/features/plugins/components/PluginStateInfo';\nimport { StoreState, AccessControlAction } from 'app/types/';\n\nimport { ShowConfirmModalEvent } from '../../../types/events';\nimport {\n  deleteDataSource,\n  initDataSourceSettings,\n  loadDataSource,\n  testDataSource,\n  updateDataSource,\n} from '../state/actions';\nimport { getDataSourceLoadingNav, buildNavModel, getDataSourceNav } from '../state/navModel';\nimport { dataSourceLoaded, setDataSourceName, setIsDefault } from '../state/reducers';\nimport { getDataSource, getDataSourceMeta } from '../state/selectors';\n\nimport BasicSettings from './BasicSettings';\nimport ButtonRow from './ButtonRow';\nimport { CloudInfoBox } from './CloudInfoBox';\nimport { PluginSettings } from './PluginSettings';\n\nexport interface OwnProps extends GrafanaRouteComponentProps<{ uid: string }> {}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps) {\n  const dataSourceId = props.match.params.uid;\n  const params = new URLSearchParams(props.location.search);\n  const dataSource = getDataSource(state.dataSources, dataSourceId);\n  const { plugin, loadError, loading, testingStatus } = state.dataSourceSettings;\n  const page = params.get('page');\n\n  const nav = plugin\n    ? getDataSourceNav(buildNavModel(dataSource, plugin), page || 'settings')\n    : getDataSourceLoadingNav('settings');\n\n  const navModel = getNavModel(\n    state.navIndex,\n    page ? `datasource-page-${page}` : `datasource-settings-${dataSourceId}`,\n    nav\n  );\n\n  return {\n    dataSource: getDataSource(state.dataSources, dataSourceId),\n    dataSourceMeta: getDataSourceMeta(state.dataSources, dataSource.type),\n    dataSourceId: dataSourceId,\n    page,\n    plugin,\n    loadError,\n    loading,\n    testingStatus,\n    navModel,\n  };\n}\n\nconst mapDispatchToProps = {\n  deleteDataSource,\n  loadDataSource,\n  setDataSourceName,\n  updateDataSource,\n  setIsDefault,\n  dataSourceLoaded,\n  initDataSourceSettings,\n  testDataSource,\n  cleanUpAction,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\nexport type Props = OwnProps & ConnectedProps<typeof connector>;\n\nexport class DataSourceSettingsPage extends PureComponent<Props> {\n  componentDidMount() {\n    const { initDataSourceSettings, dataSourceId } = this.props;\n    initDataSourceSettings(dataSourceId);\n  }\n\n  componentWillUnmount() {\n    this.props.cleanUpAction({\n      stateSelector: (state) => state.dataSourceSettings,\n    });\n  }\n\n  onSubmit = async (evt: React.FormEvent<HTMLFormElement>) => {\n    evt.preventDefault();\n\n    await this.props.updateDataSource({ ...this.props.dataSource });\n\n    this.testDataSource();\n  };\n\n  onTest = async (evt: React.FormEvent<HTMLFormElement>) => {\n    evt.preventDefault();\n\n    this.testDataSource();\n  };\n\n  onDelete = () => {\n    appEvents.publish(\n      new ShowConfirmModalEvent({\n        title: 'Delete',\n        text: `Are you sure you want to delete the \"${this.props.dataSource.name}\" data source?`,\n        yesText: 'Delete',\n        icon: 'trash-alt',\n        onConfirm: () => {\n          this.confirmDelete();\n        },\n      })\n    );\n  };\n\n  confirmDelete = () => {\n    this.props.deleteDataSource();\n  };\n\n  onModelChange = (dataSource: DataSourceSettings) => {\n    this.props.dataSourceLoaded(dataSource);\n  };\n\n  isReadOnly() {\n    return this.props.dataSource.readOnly === true;\n  }\n\n  renderIsReadOnlyMessage() {\n    return (\n      <Alert aria-label={selectors.pages.DataSource.readOnly} severity=\"info\" title=\"Provisioned data source\">\n        This data source was added by config and cannot be modified using the UI. Please contact your server admin to\n        update this data source.\n      </Alert>\n    );\n  }\n\n  renderMissingEditRightsMessage() {\n    return (\n      <Alert severity=\"info\" title=\"Missing rights\">\n        You are not allowed to modify this data source. Please contact your server admin to update this data source.\n      </Alert>\n    );\n  }\n\n  testDataSource() {\n    const { dataSource, testDataSource } = this.props;\n    testDataSource(dataSource.name);\n  }\n\n  get hasDataSource() {\n    return this.props.dataSource.id > 0;\n  }\n\n  onNavigateToExplore() {\n    const { dataSource } = this.props;\n    const exploreState = JSON.stringify({ datasource: dataSource.name, context: 'explore' });\n    const url = urlUtil.renderUrl('/explore', { left: exploreState });\n    return url;\n  }\n\n  renderLoadError() {\n    const { loadError, dataSource } = this.props;\n    const canDeleteDataSource =\n      !this.isReadOnly() && contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesDelete, dataSource);\n\n    const node = {\n      text: loadError!,\n      subTitle: 'Data Source Error',\n      icon: 'exclamation-triangle',\n    };\n    const nav = {\n      node: node,\n      main: node,\n    };\n\n    return (\n      <Page navModel={nav}>\n        <Page.Contents isLoading={this.props.loading}>\n          {this.isReadOnly() && this.renderIsReadOnlyMessage()}\n          <div className=\"gf-form-button-row\">\n            {canDeleteDataSource && (\n              <Button type=\"submit\" variant=\"destructive\" onClick={this.onDelete}>\n                Delete\n              </Button>\n            )}\n            <Button variant=\"secondary\" fill=\"outline\" type=\"button\" onClick={() => history.back()}>\n              Back\n            </Button>\n          </div>\n        </Page.Contents>\n      </Page>\n    );\n  }\n\n  renderConfigPageBody(page: string) {\n    const { plugin } = this.props;\n    if (!plugin || !plugin.configPages) {\n      return null; // still loading\n    }\n\n    for (const p of plugin.configPages) {\n      if (p.id === page) {\n        // Investigate is any plugins using this? We should change this interface\n        return <p.body plugin={plugin} query={{}} />;\n      }\n    }\n\n    return <div>Page not found: {page}</div>;\n  }\n\n  renderAlertDetails() {\n    const { testingStatus } = this.props;\n\n    return (\n      <>\n        {testingStatus?.details?.message}\n        {testingStatus?.details?.verboseMessage ? (\n          <details style={{ whiteSpace: 'pre-wrap' }}>{testingStatus?.details?.verboseMessage}</details>\n        ) : null}\n      </>\n    );\n  }\n\n  renderSettings() {\n    const { dataSourceMeta, setDataSourceName, setIsDefault, dataSource, plugin, testingStatus } = this.props;\n    const canWriteDataSource = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesWrite, dataSource);\n    const canDeleteDataSource = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesDelete, dataSource);\n\n    return (\n      <form onSubmit={this.onSubmit}>\n        {!canWriteDataSource && this.renderMissingEditRightsMessage()}\n        {this.isReadOnly() && this.renderIsReadOnlyMessage()}\n        {dataSourceMeta.state && (\n          <div className=\"gf-form\">\n            <label className=\"gf-form-label width-10\">Plugin state</label>\n            <label className=\"gf-form-label gf-form-label--transparent\">\n              <PluginStateInfo state={dataSourceMeta.state} />\n            </label>\n          </div>\n        )}\n\n        <CloudInfoBox dataSource={dataSource} />\n\n        <BasicSettings\n          dataSourceName={dataSource.name}\n          isDefault={dataSource.isDefault}\n          onDefaultChange={(state) => setIsDefault(state)}\n          onNameChange={(name) => setDataSourceName(name)}\n        />\n\n        {plugin && (\n          <PluginSettings\n            plugin={plugin}\n            dataSource={dataSource}\n            dataSourceMeta={dataSourceMeta}\n            onModelChange={this.onModelChange}\n          />\n        )}\n\n        {testingStatus?.message && (\n          <div className=\"gf-form-group p-t-2\">\n            <Alert\n              severity={testingStatus.status === 'error' ? 'error' : 'success'}\n              title={testingStatus.message}\n              aria-label={selectors.pages.DataSource.alert}\n            >\n              {testingStatus.details && this.renderAlertDetails()}\n            </Alert>\n          </div>\n        )}\n\n        <ButtonRow\n          onSubmit={(event) => this.onSubmit(event)}\n          canSave={!this.isReadOnly() && canWriteDataSource}\n          canDelete={!this.isReadOnly() && canDeleteDataSource}\n          onDelete={this.onDelete}\n          onTest={(event) => this.onTest(event)}\n          exploreUrl={this.onNavigateToExplore()}\n        />\n      </form>\n    );\n  }\n\n  render() {\n    const { navModel, page, loadError, loading } = this.props;\n\n    if (loadError) {\n      return this.renderLoadError();\n    }\n\n    return (\n      <Page navModel={navModel}>\n        <Page.Contents isLoading={loading}>\n          {this.hasDataSource ? <div>{page ? this.renderConfigPageBody(page) : this.renderSettings()}</div> : null}\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nexport default connector(DataSourceSettingsPage);\n","import React, { FC } from 'react';\n\nimport { PluginState } from '@grafana/data';\nimport { Badge, BadgeProps } from '@grafana/ui';\n\ninterface Props {\n  state?: PluginState;\n}\n\nexport const PluginStateInfo: FC<Props> = (props) => {\n  const display = getFeatureStateInfo(props.state);\n\n  if (!display) {\n    return null;\n  }\n\n  return <Badge color={display.color} title={display.tooltip} text={display.text} icon={display.icon} />;\n};\n\nfunction getFeatureStateInfo(state?: PluginState): BadgeProps | null {\n  switch (state) {\n    case PluginState.deprecated:\n      return {\n        text: 'Deprecated',\n        color: 'red',\n        tooltip: `This feature is deprecated and will be removed in a future release`,\n      };\n    case PluginState.alpha:\n      return {\n        text: 'Alpha',\n        color: 'blue',\n        tooltip: `This feature is experimental and future updates might not be backward compatible`,\n      };\n    case PluginState.beta:\n      return {\n        text: 'Beta',\n        color: 'blue',\n        tooltip: `This feature is close to complete but not fully tested`,\n      };\n    default:\n      return null;\n  }\n}\n"],"names":["dataSourceName","isDefault","onDefaultChange","onNameChange","className","InlineField","label","tooltip","grow","Input","id","type","value","placeholder","onChange","event","currentTarget","required","selectors","labelWidth","InlineSwitch","checked","canSave","canDelete","onDelete","onSubmit","onTest","exploreUrl","canExploreDataSources","contextSrv","AccessControlAction","Button","variant","fill","onClick","history","back","LinkButton","href","disabled","CloudInfoBox","dataSource","mainDS","extraDS","readOnly","version","config","GrafanaEdition","LocalStorageValueProvider","storageKey","defaultValue","isDismissed","onDismiss","Alert","title","severity","bottomSpacing","onRemove","target","rel","PluginSettings","PureComponent","constructor","props","super","this","onModelChange","scopeProps","ctrl","datasourceMeta","dataSourceMeta","current","cloneDeep","onModelChanged","bind","componentDidMount","plugin","element","components","ConfigEditor","loader","getAngularLoader","template","component","load","componentDidUpdate","prevProps","digest","componentWillUnmount","destroy","render","ref","React","options","onOptionsChange","mapDispatchToProps","deleteDataSource","loadDataSource","setDataSourceName","updateDataSource","setIsDefault","dataSourceLoaded","initDataSourceSettings","testDataSource","cleanUpAction","connector","connect","state","dataSourceId","match","params","uid","URLSearchParams","location","search","getDataSource","dataSources","loadError","loading","testingStatus","dataSourceSettings","page","get","nav","getDataSourceNav","buildNavModel","getDataSourceLoadingNav","navModel","getNavModel","navIndex","getDataSourceMeta","DataSourceSettingsPage","async","evt","preventDefault","appEvents","ShowConfirmModalEvent","text","name","yesText","icon","onConfirm","confirmDelete","stateSelector","isReadOnly","renderIsReadOnlyMessage","renderMissingEditRightsMessage","hasDataSource","onNavigateToExplore","exploreState","JSON","stringify","datasource","context","urlUtil","left","renderLoadError","canDeleteDataSource","node","subTitle","main","Page","isLoading","renderConfigPageBody","configPages","p","body","query","renderAlertDetails","details","message","verboseMessage","style","whiteSpace","renderSettings","canWriteDataSource","PluginStateInfo","status","display","PluginState","color","getFeatureStateInfo","Badge"],"sourceRoot":""}