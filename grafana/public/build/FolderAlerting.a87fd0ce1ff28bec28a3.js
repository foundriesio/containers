"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1324],{"./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts":(e,a,r)=>{r.d(a,{Kd:()=>i,Zo:()=>u});var n=r("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=r("./public/app/features/alerting/unified/utils/datasource.ts"),t=r("./public/app/features/alerting/unified/utils/rules.ts"),l=r("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function u(e){const a=(0,l._)((e=>e.promRules)),r=(0,l._)((e=>e.rulerRules)),u=(0,n.useRef)({}),i=(0,n.useMemo)((()=>{if(e){const a=(0,s.o_)(e);if(!a)throw new Error(`Unknown rules source: ${e}`);return[a]}return(0,s.h_)()}),[e]);return(0,n.useMemo)((()=>i.map((e=>{var n,l;const i=(0,s.jq)(e)?e.name:e,o=null===(n=a[i])||void 0===n?void 0:n.result,d=null===(l=r[i])||void 0===l?void 0:l.result,p=u.current[i];if(p&&p.promRules===o&&p.rulerRules===d)return p.result;const m={};Object.entries(d||{}).forEach((a=>{let[r,n]=a;const s={rulesSource:e,name:r,groups:[]};m[r]=s,function(e,a){e.groups=a.map((a=>{const r={name:a.name,interval:a.interval,source_tenants:a.source_tenants,rules:[]};return r.rules=a.rules.map((a=>function(e,a,r){return(0,t.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:r}:(0,t.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:a,group:r}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:r}}(a,e,r))),r}))}(s,n)})),null==o||o.forEach((a=>{let{name:r,groups:n}=a;!function(e,a){a.forEach((a=>{var r;let n=e.groups.find((e=>e.name===a.name));n||(n={name:a.name,rules:[]},e.groups.push(n)),(null!==(r=a.rules)&&void 0!==r?r:[]).forEach((a=>{const r=function(e,a,r){var n;if((0,s.HY)(r))return a.rules.find((a=>a.name===e.name));return null!==(n=a.rules.find((a=>!a.promRule&&c(a,e,!0))))&&void 0!==n?n:a.rules.find((a=>!a.promRule&&c(a,e,!1)))}(a,n,e.rulesSource);r?r.promRule=a:n.rules.push(function(e,a,r){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,t.x_)(e)&&e.annotations||{},promRule:e,namespace:a,group:r}}(a,e,n))}))}))}(m[r]=m[r]||{rulesSource:e,name:r,groups:[]},n)}));const f=Object.values(m);return u.current[i]={promRules:o,rulerRules:d,result:f},f})).flat()),[a,r,i])}function i(e){return e.map((e=>{const a=Object.assign({},e,{groups:[]});var r;return a.groups.push({name:"default",rules:(r=e.groups.flatMap((e=>e.rules)),r.sort(((e,a)=>e.name.localeCompare(a.name))))}),a}))}function c(e,a){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===a.name&&JSON.stringify([r?o(e.query):"",e.labels,e.annotations])===JSON.stringify([r?o(a.query):"",a.labels||{},(0,t.x_)(a)&&a.annotations||{}])}function o(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},"./public/app/features/alerting/unified/hooks/useURLSearchParams.ts":(e,a,r)=>{r.d(a,{j:()=>l});var n=r("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=r("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),t=r("./packages/grafana-runtime/src/index.ts");function l(){const{search:e}=(0,s.TH)();return[(0,n.useMemo)((()=>new URLSearchParams(e)),[e]),(0,n.useCallback)(((e,a)=>{t.locationService.partial(e,a)}),[])]}},"./public/app/features/folders/FolderAlerting.tsx":(e,a,r)=>{r.r(a),r.d(a,{default:()=>A});var n=r("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=r("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),t=r("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useAsync.js"),l=r("./public/app/core/components/Page/Page.tsx"),u=r("./public/app/core/selectors/navModel.ts"),i=r("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),c=r("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),o=r("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useDebounce.js"),d=r("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/0/cache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),p=r("./packages/grafana-ui/src/index.ts"),m=r("./public/app/core/constants.ts"),f=r("./public/app/core/utils/query.ts"),g=r("./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts");var b,h,v=r("./public/app/features/alerting/unified/hooks/useURLSearchParams.ts"),x=r("./public/app/features/alerting/unified/state/actions.ts"),_=r("./public/app/features/alerting/unified/utils/alertmanager.ts"),j=r("./public/app/features/alerting/unified/utils/datasource.ts"),y=r("./public/app/features/alerting/unified/utils/misc.ts"),S=r("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");!function(e){e.Ascending="alpha-asc",e.Descending="alpha-desc"}(h||(h={}));const C=[{label:"Alphabetically [A-Z]",value:h.Ascending},{label:"Alphabetically [Z-A]",value:h.Descending}],R=e=>{var a,r;let{folder:t}=e;const l=(0,p.useStyles2)(k),u=(0,s.useDispatch)(),i=e=>{const a=(0,_.Zh)(O),r=(0,_.tC)(e),n=(0,c.uniqWith)([...a,r],c.isEqual),s=(0,_.oI)(n);w(s)};(0,n.useEffect)((()=>{u((0,x.y6)({rulesSourceName:j.GC})),u((0,x.UR)({rulesSourceName:j.GC}))}),[u]);const R=(0,g.Zo)(j.GC),{nameFilter:N,labelFilter:O,sortOrder:A,setNameFilter:P,setLabelFilter:w,setSortOrder:q}=function(){var e,a;const[r,s]=(0,v.j)(),[t,l]=(0,n.useState)(null!==(e=r.get(F.nameFilter))&&void 0!==e?e:""),[u,i]=(0,n.useState)(null!==(a=r.get(F.labelFilter))&&void 0!==a?a:""),c=r.get(F.sortOrder),[d,p]=(0,n.useState)(c===h.Ascending?h.Ascending:c===h.Descending?h.Descending:void 0);return(0,o.Z)((()=>s({[F.nameFilter]:(0,f.sB)(t),[F.labelFilter]:(0,f.sB)(u),[F.sortOrder]:(0,f.sB)(d)},!0)),400,[t,u,d]),{nameFilter:t,labelFilter:u,sortOrder:d,setNameFilter:l,setLabelFilter:i,setSortOrder:p}}(),z=R.find((e=>e.name===t.title)),L=null!==(a=null==z||null===(r=z.groups[0])||void 0===r?void 0:r.rules)&&void 0!==a?a:[],Z=function(e,a,r,n){const s=(0,_.Zh)(r);let t=e.filter((e=>e.name.toLowerCase().includes(a.toLowerCase())&&(0,_.eD)(e.labels,s)));return(0,c.orderBy)(t,(e=>e.name),[n===h.Ascending?"asc":"desc"])}(L,N,O,null!=A?A:h.Ascending),I=0===L.length||0===Z.length,{page:D,numberOfPages:M,onPageChange:E,pageItems:$}=function(e,a,r){const[s,t]=(0,n.useState)(a),l=Math.ceil(e.length/r),u=r*(s-1),i=e.slice(u,u+r);return(0,n.useEffect)((()=>t(1)),[l]),{page:s,onPageChange:e=>{t(e)},numberOfPages:l,pageItems:i}}(Z,1,m.gN);return(0,S.jsx)("div",{className:l.container,children:(0,S.jsxs)(d.Stack,{direction:"column",gap:3,children:[(0,S.jsx)(p.FilterInput,{value:N,onChange:P,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,S.jsxs)(d.Stack,{direction:"row",children:[(0,S.jsx)(p.Select,{value:A,onChange:e=>{let{value:a}=e;return a&&q(a)},options:C,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,S.jsx)(p.Icon,{name:A===h.Ascending?"sort-amount-up":"sort-amount-down"})}),(0,S.jsx)(p.FilterInput,{value:O,onChange:w,placeholder:"Search alerts by labels",className:l.filterLabelsInput,"data-testid":"label-filter"})]}),(0,S.jsx)(d.Stack,{gap:1,children:$.map((e=>(0,S.jsxs)(p.Card,{href:(0,y.V2)("grafana",e,""),className:l.card,"data-testid":"alert-card-row",children:[(0,S.jsx)(p.Card.Heading,{children:e.name}),(0,S.jsx)(p.Card.Tags,{children:(0,S.jsx)(p.TagList,{onClick:i,tags:Object.entries(e.labels).map((e=>{let[a,r]=e;return`${a}=${r}`}))})}),(0,S.jsx)(p.Card.Meta,{children:(0,S.jsxs)("div",{children:[b||(b=(0,S.jsx)(p.Icon,{name:"folder"}))," ",t.title]})})]},e.name)))}),I&&(0,S.jsx)("div",{className:l.noResults,children:"No alert rules found"}),(0,S.jsx)("div",{className:l.pagination,children:(0,S.jsx)(p.Pagination,{currentPage:D,numberOfPages:M,onNavigate:E,hideWhenSinglePage:!0})})]})})};var F;!function(e){e.nameFilter="nameFilter",e.labelFilter="labelFilter",e.sortOrder="sort"}(F||(F={}));const k=e=>({container:i.css`
    padding: ${e.spacing(1)};
  `,card:i.css`
    grid-template-columns: auto 1fr 2fr;
    margin: 0;
  `,pagination:i.css`
    align-self: center;
  `,filterLabelsInput:i.css`
    flex: 1;
    width: auto;
    min-width: 240px;
  `,noResults:i.css`
    padding: ${e.spacing(2)};
    background-color: ${e.colors.background.secondary};
    font-style: italic;
  `});var N=r("./public/app/features/folders/state/actions.ts"),O=r("./public/app/features/folders/state/navModel.ts");const A=e=>{let{match:a}=e;const r=(0,s.useDispatch)(),n=(0,s.useSelector)((e=>e.navIndex)),i=(0,s.useSelector)((e=>e.folder)),c=a.params.uid,o=(0,u.h)(n,`folder-alerting-${c}`,(0,O._)(1)),{loading:d}=(0,t.Z)((async()=>r((0,N.Pb)(c))),[N.Pb,c]);return(0,S.jsx)(l.Z,{navModel:o,children:(0,S.jsx)(l.Z.Contents,{isLoading:d,children:(0,S.jsx)(R,{folder:i})})})}}}]);
//# sourceMappingURL=FolderAlerting.a87fd0ce1ff28bec28a3.js.map