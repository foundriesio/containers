(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6743],{"./public/app/plugins/datasource/cloudwatch/aws_url.ts":(e,t,n)=>{"use strict";n.d(t,{M:()=>o});const a=n("./.yarn/cache/jsurl-npm-0.1.5-9e17f93783-50b614908d.zip/node_modules/jsurl/index.js");function o(e,t){return`https://${t}.console.aws.amazon.com/cloudwatch/home?region=${t}#logs-insights:queryDetail=${a.stringify(e)}`}},"./public/app/plugins/datasource/cloudwatch/cloudwatch-sql/language.ts":(e,t,n)=>{"use strict";n.r(t),n.d(t,{AND:()=>f,ASC:()=>c,BY:()=>l,COMPARISON_OPERATORS:()=>x,DESC:()=>u,EQUALS:()=>y,FROM:()=>o,GROUP:()=>i,KEYWORDS:()=>h,LIMIT:()=>d,LOGICAL_OPERATORS:()=>v,NOT_EQUALS:()=>b,ORDER:()=>s,SCHEMA:()=>m,SELECT:()=>a,STATISTICS:()=>g,WHERE:()=>r,WITH:()=>p,conf:()=>C,language:()=>j});const a="SELECT",o="FROM",r="WHERE",i="GROUP",s="ORDER",l="BY",u="DESC",c="ASC",d="LIMIT",p="WITH",m="SCHEMA",h=[a,o,r,i,s,l,u,c,d,p,m],g=["AVG","COUNT","MAX","MIN","SUM"],f="AND",v=[f],y="=",b="!=",x=[y,b],j={defaultToken:"",tokenPostfix:".sql",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"}],keywords:h,operators:v,builtinFunctions:g,tokenizer:{root:[[/\$[a-zA-Z0-9-_]+/,"variable"],{include:"@comments"},{include:"@whitespace"},{include:"@numbers"},{include:"@strings"},{include:"@complexIdentifiers"},[/[;,.]/,"delimiter"],[/[()]/,"@brackets"],[/[\w@#$]+/,{cases:{"@keywords":"keyword","@operators":"operator","@builtinFunctions":"predefined","@default":"identifier"}}],[/[=!%&+\-*/|~^]/,"operator"]],whitespace:[[/\s+/,"white"]],comments:[[/--+.*/,"comment"]],comment:[[/[^*/]+/,"comment"],[/./,"comment"]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/N'/,{token:"string",next:"@string"}],[/'/,{token:"string",next:"@string"}],[/"/,{token:"type",next:"@string_double"}]],string:[[/[^']+/,"string"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],string_double:[[/[^\\"]+/,"type"],[/"/,"type","@pop"]],complexIdentifiers:[[/\[/,{token:"identifier.quote",next:"@bracketedIdentifier"}],[/"/,{token:"identifier.quote",next:"@quotedIdentifier"}]],bracketedIdentifier:[[/[^\]]+/,"identifier"],[/]]/,"identifier"],[/]/,{token:"identifier.quote",next:"@pop"}]],quotedIdentifier:[[/[^"]+/,"identifier"],[/""/,"identifier"],[/"/,{token:"identifier.quote",next:"@pop"}]]}},C={comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]}},"./public/app/plugins/datasource/cloudwatch/components/LogsQueryEditor.tsx":(e,t,n)=>{"use strict";n.d(t,{b:()=>E,Z:()=>q});var a,o=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./packages/grafana-ui/src/index.ts"),s=n("./public/app/plugins/datasource/cloudwatch/aws_url.ts"),l=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");class u extends r.Component{constructor(){var e,t,n;super(...arguments),n={href:""},(t="state")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}async componentDidUpdate(e){const{panelData:t}=this.props,{panelData:n}=e;if(n!==t&&null!=t&&t.request){const e=this.getExternalLink();this.setState({href:e})}}getExternalLink(){var e,t,n;const{query:a,panelData:o,datasource:r}=this.props,i=null==o||null===(e=o.request)||void 0===e?void 0:e.range;if(!i)return"";const l=i.from.toISOString(),u={end:i.to.toISOString(),start:l,timeType:"ABSOLUTE",tz:"UTC",editorString:null!==(t=a.expression)&&void 0!==t?t:"",isLiveTail:!1,source:null!==(n=a.logGroupNames)&&void 0!==n?n:[]};return(0,s.M)(u,r.getActualRegion(a.region))}render(){const{href:e}=this.state;return(0,l.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:[a||(a=(0,l.jsx)(i.Icon,{name:"share-alt"}))," CloudWatch Logs Insights"]})}}var c=n("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),d=n("./.yarn/cache/prismjs-npm-1.27.0-ca4e1667c6-85c7f4a3e9.zip/node_modules/prismjs/prism.js"),p=n("./public/app/core/actions/index.ts"),m=n("./public/app/core/copy/appNotification.ts"),h=n("./public/app/store/store.ts"),g=n("./public/app/plugins/datasource/cloudwatch/syntax.ts");const f=/\s+by\s+/im,v=/([\w$@().]+)(?:(\s+as\s+)([\w$]+))?\s*,?\s*/iy;function y(e){let t,n=[];if(t=e.match(f)){let a;for(v.lastIndex=t.index+t[0].length;a=v.exec(e);)n.push(a[2]?a[3]:a[1]),v.lastIndex=a.index+a[0].length}return n}var b=n("./public/app/plugins/datasource/cloudwatch/components/QueryHeader.tsx");function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const j=o.css`
  flex-grow: 1;
  min-height: 35px;
`,C=o.css`
  gap: 3px;
`;class w extends r.PureComponent{constructor(e,t){var n,a;super(e,t),x(this,"state",{selectedLogGroups:null!==(n=null===(a=this.props.query.logGroupNames)||void 0===a?void 0:a.map((e=>({value:e,label:e}))))&&void 0!==n?n:[],availableLogGroups:[],invalidLogGroups:!1,loadingLogGroups:!1,hint:void 0}),x(this,"plugins",void 0),x(this,"fetchLogGroupOptions",(async(e,t)=>{try{return(await this.props.datasource.describeLogGroups({refId:this.props.query.refId,region:e,logGroupNamePrefix:t})).map((e=>({value:e,label:e})))}catch(e){let t="unknown error";if("string"!=typeof e)try{t=JSON.stringify(e)}catch(e){}else t=e;return(0,h.WI)((0,p.$l)((0,m.t_)(t))),[]}})),x(this,"onLogGroupSearch",((e,t,n)=>{if("input-change"!==n.action)return Promise.resolve();return/^[\.\-_/#A-Za-z0-9]+$/.test(e)?(this.setState({loadingLogGroups:!0}),this.fetchLogGroupOptions(t,e).then((e=>{this.setState((t=>({availableLogGroups:(0,c.unionBy)(t.availableLogGroups,e,"value")})))})).finally((()=>{this.setState({loadingLogGroups:!1})}))):Promise.resolve()})),x(this,"onLogGroupSearchDebounced",(0,c.debounce)(this.onLogGroupSearch,300)),x(this,"componentDidMount",(()=>{const{query:e,onChange:t}=this.props;this.setState({loadingLogGroups:!0}),e.region&&this.fetchLogGroupOptions(e.region).then((n=>{this.setState((a=>{const o=a.selectedLogGroups;if(t){const n=Object.assign({},e,{logGroupNames:o.map((e=>e.value))});t(n)}return{loadingLogGroups:!1,availableLogGroups:n,selectedLogGroups:o}}))}))})),x(this,"onChangeQuery",(e=>{const{query:t,onChange:n}=this.props,{selectedLogGroups:a}=this.state;if(n){var o;n(Object.assign({},t,{expression:e,logGroupNames:null!==(o=null==a?void 0:a.map((e=>e.value)))&&void 0!==o?o:[],statsGroups:y(e)}))}})),x(this,"setSelectedLogGroups",(e=>{var t;this.setState({selectedLogGroups:e});const{onChange:n,query:a}=this.props;null==n||n(Object.assign({},a,{logGroupNames:null!==(t=e.map((e=>e.value)))&&void 0!==t?t:[]}))})),x(this,"setCustomLogGroups",(e=>{const t={value:e,label:e},n=[...this.state.selectedLogGroups,t];this.setSelectedLogGroups(n)})),x(this,"onRegionChange",(async e=>{this.setState({loadingLogGroups:!0});const t=await this.fetchLogGroupOptions(e);this.setState((e=>{const n=(0,c.intersectionBy)(e.selectedLogGroups,t,"value"),{onChange:a,query:o}=this.props;if(a){a(Object.assign({},o,{logGroupNames:n.map((e=>e.value))}))}return{availableLogGroups:t,selectedLogGroups:n,loadingLogGroups:!1}}))})),x(this,"onTypeahead",(async e=>{const{datasource:t,query:n}=this.props,{selectedLogGroups:a}=this.state;if(!t.languageProvider)return{suggestions:[]};const o=t.languageProvider,{history:r,absoluteRange:i}=this.props,{prefix:s,text:l,value:u,wrapperClasses:c,labelKey:d,editor:p}=e;return await o.provideCompletionItems({text:l,value:u,prefix:s,wrapperClasses:c,labelKey:d,editor:p},{history:r,absoluteRange:i,logGroupNames:a.map((e=>e.value)),region:n.region})})),x(this,"onQueryFieldClick",((e,t,n)=>{const{selectedLogGroups:a,loadingLogGroups:o}=this.state;(o||0===a.length)&&this.setState({invalidLogGroups:!0}),n()})),x(this,"onOpenLogGroupMenu",(()=>{this.setState({invalidLogGroups:!1})})),this.plugins=[(0,i.BracesPlugin)(),(0,i.SlatePrism)({onlyIn:e=>"block"===e.object&&"code_block"===e.type,getSyntax:e=>"cloudwatch"},Object.assign({},d.languages,{cloudwatch:g.ZP}))]}render(){var e,t;const{onRunQuery:n,onChange:a,ExtraFieldElement:o,data:r,query:s,datasource:u,allowCustomValue:d}=this.props,{selectedLogGroups:p,availableLogGroups:m,loadingLogGroups:h,hint:g,invalidLogGroups:f}=this.state,v=r&&r.error&&r.error.refId===s.refId,y=u.languageProvider?u.languageProvider.cleanText:void 0;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.Z,{query:s,onRunQuery:n,datasource:u,onChange:a,sqlCodeEditorIsDirty:!1,onRegionChange:this.onRegionChange}),(0,l.jsx)("div",{className:`gf-form gf-form--grow flex-grow-1 ${C}`,children:(0,l.jsx)(i.LegacyForms.FormField,{label:"Log Groups",labelWidth:6,className:"flex-grow-1",inputEl:(0,l.jsx)(i.MultiSelect,{"aria-label":"Log Groups",menuShouldPortal:!0,allowCustomValue:d,options:(0,c.unionBy)(m,p,"value"),value:p,onChange:e=>{this.setSelectedLogGroups(e)},onCreateOption:e=>{this.setCustomLogGroups(e)},onBlur:this.props.onRunQuery,className:j,closeMenuOnSelect:!1,isClearable:!0,invalid:f,isOptionDisabled:()=>p.length>=20,placeholder:"Choose Log Groups",maxVisibleValues:4,noOptionsMessage:"No log groups available",isLoading:h,onOpenMenu:this.onOpenLogGroupMenu,onInputChange:(e,t)=>{this.onLogGroupSearchDebounced(e,s.region,t)}})})}),(0,l.jsxs)("div",{className:"gf-form-inline gf-form-inline--nowrap flex-grow-1",children:[(0,l.jsx)("div",{className:"gf-form gf-form--grow flex-shrink-1",children:(0,l.jsx)(i.QueryField,{additionalPlugins:this.plugins,query:null!==(e=s.expression)&&void 0!==e?e:"",onChange:this.onChangeQuery,onClick:this.onQueryFieldClick,onRunQuery:this.props.onRunQuery,onTypeahead:this.onTypeahead,cleanText:y,placeholder:"Enter a CloudWatch Logs Insights query (run with Shift+Enter)",portalOrigin:"cloudwatch",disabled:h||0===p.length})}),o]}),g&&(0,l.jsx)("div",{className:"query-row-break",children:(0,l.jsxs)("div",{className:"text-warning",children:[g.message,(0,l.jsx)("a",{className:"text-link muted",onClick:g.fix.action,children:g.fix.label})]})}),v?(0,l.jsx)("div",{className:"query-row-break",children:(0,l.jsx)("div",{className:"prom-query-field-info text-error",children:null==r||null===(t=r.error)||void 0===t?void 0:t.message})}):null]})}}const S=o.css`
  margin-left: 3px;
  flex-grow: 0;
`,E=(0,r.memo)((function(e){var t,n;const{query:a,data:o,datasource:r,onRunQuery:s,onChange:c,exploreId:d,allowCustomValue:p=!1}=e;let m;if(null!=o&&null!==(t=o.request)&&void 0!==t&&null!==(n=t.range)&&void 0!==n&&n.from){const{range:e}=o.request;m={from:e.from.valueOf(),to:e.to.valueOf()}}else m={from:Date.now()-1e4,to:Date.now()};return(0,l.jsx)(w,{exploreId:d,datasource:r,query:a,onChange:c,onRunQuery:s,history:[],data:o,absoluteRange:m,allowCustomValue:p,ExtraFieldElement:(0,l.jsx)(i.InlineFormLabel,{className:`gf-form-label--btn ${S}`,width:"auto",tooltip:"Link to Graph in AWS",children:(0,l.jsx)(u,{query:a,panelData:o,datasource:r})})})})),q=E},"./public/app/plugins/datasource/cloudwatch/components/MetricStatEditor/index.ts":(e,t,n)=>{"use strict";n.d(t,{e:()=>u});n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var a=n("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/0/cache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),o=n("./packages/grafana-ui/src/index.ts"),r=n("./public/app/plugins/datasource/cloudwatch/components/index.ts"),i=n("./public/app/plugins/datasource/cloudwatch/hooks.ts"),s=n("./public/app/plugins/datasource/cloudwatch/utils/utils.ts"),l=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function u(e){var t;let{query:n,datasource:u,disableExpressions:c=!1,onChange:d,onRunQuery:p}=e;const{region:m,namespace:h,metricName:g,dimensions:f}=n,v=(0,i.JR)(u),y=(0,i.Bf)(u,m,h),b=(0,i.$K)(u,m,h,g,null!=f?f:{}),x=e=>{d(e),p()},j=async e=>{let{metricName:t,namespace:n,region:a}=e;return t?(await u.getMetrics(n,a).then((e=>{e.find((e=>e.value===t))||(t="")})),Object.assign({},e,{metricName:t})):e};return(0,l.jsxs)(a.EditorRows,{children:[(0,l.jsx)(a.EditorRow,{children:(0,l.jsxs)(a.EditorFieldGroup,{children:[(0,l.jsx)(a.EditorField,{label:"Namespace",width:26,children:(0,l.jsx)(o.Select,{"aria-label":"Namespace",value:n.namespace,allowCustomValue:!0,options:v,onChange:e=>{let{value:t}=e;t&&(async e=>{const t=await j(e);x(t)})(Object.assign({},n,{namespace:t}))}})}),(0,l.jsx)(a.EditorField,{label:"Metric name",width:16,children:(0,l.jsx)(o.Select,{"aria-label":"Metric name",value:n.metricName||null,allowCustomValue:!0,options:y,onChange:e=>{let{value:t}=e;t&&x(Object.assign({},n,{metricName:t}))}})}),(0,l.jsx)(a.EditorField,{label:"Statistic",width:16,children:(0,l.jsx)(o.Select,{inputId:`${n.refId}-metric-stat-editor-select-statistic`,allowCustomValue:!0,value:(0,s.E)(null!==(t=n.statistic)&&void 0!==t?t:u.standardStatistics[0]),options:(0,s._)(u,u.standardStatistics.filter((e=>e!==n.statistic)).map(s.E)),onChange:e=>{let{value:t}=e;t&&(u.standardStatistics.includes(t)||/^p\d{2}(?:\.\d{1,2})?$/.test(t)||t.startsWith("$"))&&x(Object.assign({},n,{statistic:t}))}})})]})}),(0,l.jsx)(a.EditorRow,{children:(0,l.jsx)(a.EditorField,{label:"Dimensions",children:(0,l.jsx)(r.Db,{query:n,onChange:e=>x(Object.assign({},n,{dimensions:e})),dimensionKeys:b,disableExpressions:c,datasource:u})})}),!c&&(0,l.jsx)(a.EditorRow,{children:(0,l.jsx)(a.EditorField,{label:"Match exact",optional:!0,tooltip:"Only show metrics that exactly match all defined dimension names.",children:(0,l.jsx)(o.Switch,{id:`${n.refId}-cloudwatch-match-exact`,value:!!n.matchExact,onChange:e=>{x(Object.assign({},n,{matchExact:e.currentTarget.checked}))}})})})]})}},"./public/app/plugins/datasource/cloudwatch/components/PanelQueryEditor.tsx":(e,t,n)=>{"use strict";n.d(t,{S:()=>y});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),o=n("./packages/grafana-data/src/index.ts"),r=n("./public/app/plugins/datasource/cloudwatch/components/LogsQueryEditor.tsx"),i=n("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/0/cache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),s=n("./packages/grafana-ui/src/index.ts");var l,u,c=n("./public/app/plugins/datasource/cloudwatch/types.ts"),d=n("./public/app/plugins/datasource/cloudwatch/components/QueryHeader.tsx"),p=n("./public/app/plugins/datasource/cloudwatch/components/index.ts"),m=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const h=["namespace","metricName","expression","dimensions","region","id","alias","statistic","period","sqlExpression","metricQueryType","metricEditorMode"];function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const f=e=>{let{namespace:t,metricName:n,expression:a,dimensions:o,region:r,id:i,alias:s,statistic:l,period:u,sqlExpression:d,metricQueryType:p,metricEditorMode:m}=e,g=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,h);const f=Object.assign({queryMode:"Metrics",namespace:null!=t?t:"",metricName:null!=n?n:"",expression:null!=a?a:"",dimensions:null!=o?o:{},region:null!=r?r:"default",id:null!=i?i:"",alias:null!=s?s:"",statistic:null!=l?l:"Average",period:null!=u?u:"",metricQueryType:null!=p?p:c.$5.Search,metricEditorMode:null!=m?m:c.MQ.Builder,sqlExpression:null!=d?d:""},g);return g.hasOwnProperty("matchExact")?f:Object.assign({},f,{matchExact:!0})};class v extends a.PureComponent{constructor(){super(...arguments),g(this,"state",{sqlCodeEditorIsDirty:!1}),g(this,"componentDidMount",(()=>{const e=this.props.query,t=f(e);this.props.onChange(t)})),g(this,"onChange",(e=>{const{onChange:t,onRunQuery:n}=this.props;t(e),n()}))}render(){var e,t,n;const{onRunQuery:a,datasource:o}=this.props,r=this.props.query,h=f(r);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(d.Z,{query:h,onRunQuery:a,datasource:o,onChange:e=>{(e=>"Metrics"===e.queryMode)(e)&&e.metricEditorMode!==h.metricEditorMode&&this.setState({sqlCodeEditorIsDirty:!1}),this.onChange(e)},sqlCodeEditorIsDirty:this.state.sqlCodeEditorIsDirty}),l||(l=(0,m.jsx)(i.Space,{v:.5})),h.metricQueryType===c.$5.Search&&(0,m.jsxs)(m.Fragment,{children:[h.metricEditorMode===c.MQ.Builder&&(0,m.jsx)(p.eL,Object.assign({},Object.assign({},this.props,{query:h}))),h.metricEditorMode===c.MQ.Code&&(0,m.jsx)(p.M_,{onRunQuery:a,expression:null!==(e=h.expression)&&void 0!==e?e:"",onChange:e=>this.props.onChange(Object.assign({},h,{expression:e})),datasource:o})]}),h.metricQueryType===c.$5.Query&&(0,m.jsxs)(m.Fragment,{children:[h.metricEditorMode===c.MQ.Code&&(0,m.jsx)(p.tJ,{region:h.region,sql:null!==(t=h.sqlExpression)&&void 0!==t?t:"",onChange:e=>{this.state.sqlCodeEditorIsDirty||this.setState({sqlCodeEditorIsDirty:!0}),this.props.onChange(Object.assign({},r,{sqlExpression:e}))},onRunQuery:a,datasource:o}),h.metricEditorMode===c.MQ.Builder&&(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(p.Ex,{query:h,onChange:this.props.onChange,onRunQuery:a,datasource:o})})]}),u||(u=(0,m.jsx)(i.Space,{v:.5})),(0,m.jsxs)(i.EditorRow,{children:[(0,m.jsx)(i.EditorField,{label:"ID",width:26,optional:!0,tooltip:"ID can be used to reference other queries in math expressions. The ID can include numbers, letters, and underscore, and must start with a lowercase letter.",children:(0,m.jsx)(s.Input,{id:`${h.refId}-cloudwatch-metric-query-editor-id`,onBlur:a,onChange:e=>this.onChange(Object.assign({},r,{id:e.target.value})),type:"text",invalid:!!h.id&&!/^$|^[a-z][a-zA-Z0-9_]*$/.test(h.id),value:h.id})}),(0,m.jsx)(i.EditorField,{label:"Period",width:26,tooltip:"Minimum interval between points in seconds.",children:(0,m.jsx)(s.Input,{id:`${h.refId}-cloudwatch-metric-query-editor-period`,value:h.period||"",placeholder:"auto",onBlur:a,onChange:e=>this.onChange(Object.assign({},r,{period:e.target.value}))})}),(0,m.jsx)(i.EditorField,{label:"Alias",width:26,optional:!0,tooltip:"Change time series legend name using this field. See documentation for replacement variable formats.",children:(0,m.jsx)(p.V8,{value:null!==(n=r.alias)&&void 0!==n?n:"",onChange:e=>this.onChange(Object.assign({},r,{alias:e}))})})]})]})}}class y extends a.PureComponent{render(){var e;const{query:t}=this.props,n=null!==(e=t.queryMode)&&void 0!==e?e:"Metrics";return(0,m.jsx)(m.Fragment,{children:n===o.ExploreMode.Logs?(0,m.jsx)(r.Z,Object.assign({},this.props,{allowCustomValue:!0})):(0,m.jsx)(v,Object.assign({},this.props))})}}},"./public/app/plugins/datasource/cloudwatch/components/QueryHeader.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var a,o=n("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./packages/grafana-data/src/index.ts"),s=n("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/0/cache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),l=n("./public/app/plugins/datasource/cloudwatch/hooks.ts"),u=n("./packages/grafana-ui/src/index.ts"),c=n("./public/app/plugins/datasource/cloudwatch/types.ts"),d=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const p=[{label:"Metric Search",value:c.$5.Search},{label:"Metric Query",value:c.$5.Query}],m=[{label:"Builder",value:c.MQ.Builder},{label:"Code",value:c.MQ.Code}],h=e=>{let{query:t,sqlCodeEditorIsDirty:n,onChange:o,onRunQuery:i}=e;const{metricEditorMode:l,metricQueryType:h}=t,[g,f]=(0,r.useState)(!1),v=(0,r.useCallback)((e=>{n&&h===c.$5.Query&&l===c.MQ.Code?f(!0):o(Object.assign({},t,{metricEditorMode:e}))}),[f,o,n,t,l,h]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.InlineSelect,{"aria-label":"Metric editor mode",value:p.find((e=>e.value===h)),options:p,onChange:e=>{let{value:n}=e;o(Object.assign({},t,{metricQueryType:n}))}}),a||(a=(0,d.jsx)(s.FlexItem,{grow:1})),(0,d.jsx)(u.RadioButtonGroup,{options:m,size:"sm",value:l,onChange:v}),t.metricQueryType===c.$5.Query&&t.metricEditorMode===c.MQ.Code&&(0,d.jsx)(u.Button,{variant:"secondary",size:"sm",onClick:()=>i(),children:"Run query"}),(0,d.jsx)(u.ConfirmModal,{isOpen:g,title:"Are you sure?",body:"You will lose manual changes done to the query if you go back to the visual builder.",confirmText:"Yes, I am sure.",dismissText:"No, continue editing the query manually.",icon:"exclamation-triangle",onConfirm:()=>{f(!1),o(Object.assign({},t,{metricEditorMode:c.MQ.Builder}))},onDismiss:()=>f(!1)})]})},g=[{label:"CloudWatch Metrics",value:"Metrics"},{label:"CloudWatch Logs",value:"Logs"}],f=e=>{let{query:t,sqlCodeEditorIsDirty:n,datasource:a,onChange:r,onRunQuery:u,onRegionChange:c}=e;const{queryMode:p,region:m}=t,[f,v]=(0,l.eH)(a);return(0,d.jsxs)(s.EditorHeader,{children:[(0,d.jsx)(s.InlineSelect,{label:"Region",value:m,placeholder:"Select region",allowCustomValue:!0,onChange:e=>{let{value:n}=e;return n&&(async e=>{let{value:n}=e;c&&await c(null!=n?n:"default"),r(Object.assign({},t,{region:n}))})({value:n})},options:f,isLoading:v}),(0,d.jsx)(s.InlineSelect,{"aria-label":"Query mode",value:p,options:g,onChange:e=>{let{value:n}=e;if(n!==p){const e=(0,o.pick)(t,"id","region","namespace","refId","hide","key","queryType","datasource");r(Object.assign({},e,{queryMode:n}))}}}),p!==i.ExploreMode.Logs&&(0,d.jsx)(h,{query:t,datasource:a,onChange:r,onRunQuery:u,sqlCodeEditorIsDirty:n})]})}},"./public/app/plugins/datasource/cloudwatch/components/index.ts":(e,t,n)=>{"use strict";n.d(t,{V8:()=>v,Db:()=>g,M_:()=>K,eL:()=>y.e,Ex:()=>z,tJ:()=>Z});var a=n("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),o=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=n("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/0/cache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),i=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=n("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useAsyncFn.js"),l=n("./packages/grafana-data/src/index.ts"),u=n("./packages/grafana-ui/src/index.ts"),c=n("./public/app/plugins/datasource/cloudwatch/utils/utils.ts"),d=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const p={value:"*",label:"*"},m=e=>{let{filter:t,query:{region:n,namespace:a,metricName:m,dimensions:g},datasource:f,dimensionKeys:v,disableExpressions:y,onChange:b,onDelete:x}=e;const j=(0,o.useMemo)((()=>((e,t)=>Object.entries(null!=e?e:{}).reduce(((e,n)=>{let[a,o]=n;return a!==t?Object.assign({},e,{[a]:o}):e}),{}))(null!=g?g:{},t.key)),[g,t]),[C,w]=(0,s.Z)((async()=>t.key?f.getDimensionValues(n,a,m,t.key,j).then((e=>(e.length&&!y&&e.unshift(p),(0,c._)(f,e)))):[]),[t.key,g]),S=(0,u.useTheme2)(),E=h(S);return(0,d.jsx)("div",{"data-testid":"cloudwatch-dimensions-filter-item",children:(0,d.jsxs)(r.InputGroup,{children:[(0,d.jsx)(u.Select,{"aria-label":"Dimensions filter key",inputId:"cloudwatch-dimensions-filter-item-key",width:"auto",value:t.key?(0,l.toOption)(t.key):null,allowCustomValue:!0,options:v,onChange:e=>{e.label&&b({key:e.label,value:void 0})}}),(0,d.jsx)("span",{className:(0,i.cx)(E.root),children:"="}),(0,d.jsx)(u.Select,{"aria-label":"Dimensions filter value",inputId:"cloudwatch-dimensions-filter-item-value",onOpenMenu:w,width:"auto",value:t.value?(0,l.toOption)(t.value):null,allowCustomValue:!0,isLoading:C.loading,options:C.value,onChange:e=>{e.value&&b(Object.assign({},t,{value:e.value}))}}),(0,d.jsx)(r.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:x})]})})},h=(0,u.stylesFactory)((e=>({root:(0,i.css)({padding:e.spacing(0,1),alignSelf:"center"})}))),g=e=>{let{query:t,datasource:n,dimensionKeys:i,disableExpressions:s,onChange:l}=e;const u=(0,o.useMemo)((()=>{return e=t.dimensions,Object.entries(null!=e?e:{}).reduce(((e,t)=>{let[n,a]=t;if(a&&"string"==typeof a){const t={key:n,value:a,operator:"="};return[...e,t]}return e}),[]);var e}),[t.dimensions]),[c,p]=(0,o.useState)(u);return(0,d.jsx)(r.EditorList,{items:c,onChange:e=>{p(e);const n=e.reduce(((e,t)=>{let{key:n,value:a}=t;return n&&a?Object.assign({},e,{[n]:a}):e}),{});(0,a.isEqual)(n,t.dimensions)||l(n)},renderItem:f(n,t,i,s)})};function f(e,t,n,a){return function(o,r,i){return(0,d.jsx)(m,{filter:o,onChange:e=>r(e),datasource:e,query:t,disableExpressions:a,dimensionKeys:n,onDelete:i})}}const v=e=>{let{value:t="",onChange:n}=e;const[r,i]=(0,o.useState)(t),s=(0,a.debounce)(n,1500);return n=e=>{i(e.target.value),s(e.target.value)},(0,d.jsx)(u.Input,{type:"text",value:r,onChange:n,"aria-label":"Optional alias"})};n("./public/app/plugins/datasource/cloudwatch/components/PanelQueryEditor.tsx"),n("./public/app/plugins/datasource/cloudwatch/components/LogsQueryEditor.tsx");var y=n("./public/app/plugins/datasource/cloudwatch/components/MetricStatEditor/index.ts"),b=n("./public/app/features/templating/template_srv.ts");let x,j;!function(e){e.String="string"}(x||(x={})),function(e){e.Property="property",e.Operator="operator",e.Or="or",e.And="and",e.GroupBy="groupBy",e.Function="function",e.FunctionParameter="functionParameter"}(j||(j={}));class C{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,b.J)();this.templateSrv=e,this.templateSrv=e}expressionToSqlQuery(e){var t,n,a;let{select:o,from:r,where:i,groupBy:s,orderBy:l,orderByDirection:u,limit:c}=e;if(!r||null==o||!o.name||null==o||null===(t=o.parameters)||void 0===t||!t.length)return;let d=[];return this.appendSelect(o,d),this.appendFrom(r,d),this.appendWhere(i,d,!0,null!==(n=null==i||null===(a=i.expressions)||void 0===a?void 0:a.length)&&void 0!==n?n:0),this.appendGroupBy(s,d),this.appendOrderBy(l,u,d),this.appendLimit(c,d),d.join(" ")}appendSelect(e,t){t.push("SELECT"),this.appendFunction(e,t)}appendFrom(e,t){var n,a;t.push("FROM"),(null==e?void 0:e.type)===j.Function?this.appendFunction(e,t):t.push(this.formatValue(null!==(n=null==e||null===(a=e.property)||void 0===a?void 0:a.name)&&void 0!==n?n:""))}appendWhere(e,t,n,a){if(!e)return;const o="expressions"in e&&e.expressions.length>0;if(n&&o&&t.push("WHERE"),e.type===j.And){const o=[];if(e.expressions.map((e=>this.appendWhere(e,o,!1,a))),0===o.length)return;const r=o.join(" AND "),i=!n&&a>1&&o.length>1;return t.push(i?`(${r})`:r)}if(e.type!==j.Or)return e.type===j.Operator?this.appendOperator(e,t):void 0;{const o=[];if(e.expressions.map((e=>this.appendWhere(e,o,!1,a))),0===o.length)return;const r=o.join(" OR "),i=!n&&a>1&&o.length>1;t.push(i?`(${r})`:r)}}appendGroupBy(e,t){const n=[];for(const t of null!==(a=null==e?void 0:e.expressions)&&void 0!==a?a:[]){var a;(null==t?void 0:t.type)===j.GroupBy&&t.property.name&&n.push(this.formatValue(t.property.name))}n.length>0&&t.push(`GROUP BY ${n.join(", ")}`)}appendOrderBy(e,t,n){e&&(n.push("ORDER BY"),this.appendFunction(e,n),n.push(null!=t?t:"ASC"))}appendLimit(e,t){e&&t.push(`LIMIT ${e}`)}appendOperator(e,t,n){const{property:a,operator:o}=e;a.name&&o.name&&o.value&&t.push(`${this.formatValue(a.name)} ${o.name} '${o.value}'`)}appendFunction(e,t){var n;if(null==e||!e.name)return;const a=(null!==(n=e.parameters)&&void 0!==n?n:[]).map((e=>e.name&&this.formatValue(e.name))).filter(Boolean).join(", ");t.push(`${e.name}(${a})`)}formatValue(e){const t=this.templateSrv.replace(e,{},"raw");return/[/\s\.-]/.test(t)?`"${e}"`:e}}var w=n("./public/app/plugins/datasource/cloudwatch/cloudwatch-sql/language.ts"),S=n("./public/app/plugins/datasource/cloudwatch/hooks.ts");function E(e){var t;return null==e||null===(t=e.parameters)||void 0===t?void 0:t[0].name}function q(e){return(null==e?void 0:e.type)===j.Property?e.property.name:(null==e?void 0:e.type)===j.Function?null===(t=e.parameters)||void 0===t?void 0:t[0].name:void 0;var t}function O(e){var t,n,a;const o=null===(t=e.property)||void 0===t?void 0:t.name,r=null===(n=e.operator)||void 0===n?void 0:n.value,i=null===(a=e.operator)||void 0===a?void 0:a.name;if(o&&r&&i)return{type:j.Operator,property:{type:x.String,name:o},operator:{value:r,name:i}}}function I(e){return e.flatMap((e=>e.type===j.Operator?e:e.type===j.And||e.type===j.Or?I(e.expressions):[]))}function R(e){var t;const n=e.where;return I(null!==(t=null==n?void 0:n.expressions)&&void 0!==t?t:[])}function M(e){var t;const n=e.groupBy;return(null!==(t=null==n?void 0:n.expressions)&&void 0!==t?t:[]).flatMap((e=>e.type===j.GroupBy?e:[]))}function k(e,t){var n;return Object.assign({},e,{sql:Object.assign({},null!==(n=e.sql)&&void 0!==n?n:{},t)})}function L(e,t){var n,a;return k(e,{select:Object.assign({type:j.Function},null!==(n=null===(a=e.sql)||void 0===a?void 0:a.select)&&void 0!==n?n:{},{name:t})})}const _=w.STATISTICS.map(l.toOption),F=e=>{var t,n;let{datasource:a,query:i,onQueryChange:s}=e;const p=null!==(t=i.sql)&&void 0!==t?t:{},m=null===(n=p.select)||void 0===n?void 0:n.name;(0,o.useEffect)((()=>{m||s(L(i,w.STATISTICS[0]))}),[m,s,i]);const h=E(p.select),g=q(p.from),f=function(e){var t;if((null==e?void 0:e.type)===j.Function&&null!=e&&null!==(t=e.parameters)&&void 0!==t&&t.length){var n;return(null==e||null===(n=e.parameters)||void 0===n?void 0:n.length)<=1?[]:(null==e?void 0:e.parameters.slice(1)).reduce(((e,t)=>t.name?[...e,t.name]:e),[])}}(p.from),v=(null==(y=p.from)?void 0:y.type)===j.Function&&y.name===w.SCHEMA;var y;const b=(0,S.JR)(a),C=(0,S.Bf)(a,i.region,g),O=(0,o.useMemo)((()=>(null!=f?f:[]).reduce(((e,t)=>t?Object.assign({},e,{[t]:null}):e),{})),[f]),I=(0,S.$K)(a,i.region,g,h,O),R=(0,o.useMemo)((()=>null!=f&&f.length?[...I,...f.map(l.toOption)]:I),[I,f]),M=async e=>{let{region:t,sql:n}=e;return await a.getMetrics(e.namespace,t).then((t=>{t.some((e=>e.value===h))||(n=function(e){var t,n;const a=Object.assign({},e);return null===(t=a.sql)||void 0===t||null===(n=t.select)||void 0===n||delete n.parameters,a}(e).sql)})),Object.assign({},e,{sql:n})};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.EditorFieldGroup,{children:[(0,d.jsx)(r.EditorField,{label:"Namespace",width:16,children:(0,d.jsx)(u.Select,{"aria-label":"Namespace",value:g?(0,l.toOption)(g):null,inputId:`${i.refId}-cloudwatch-sql-namespace`,options:b,allowCustomValue:!0,onChange:e=>{let{value:t}=e;return t&&(async e=>{const t=await M(e);s(t)})(function(e,t){var n;const a=null!==(n=e.sql)&&void 0!==n?n:{};if(e.namespace=t||"",void 0===t)return k(e,{from:void 0});if(!a.from||a.from.type===j.Property)return k(e,{from:{type:j.Property,property:{type:x.String,name:t}}});if(a.from.type===j.Function){var o;const n={type:j.FunctionParameter,name:t},r=(null!==(o=a.from.parameters)&&void 0!==o?o:[]).slice(1);return k(e,{from:{type:j.Function,name:w.SCHEMA,parameters:[n,...r]}})}return e}(i,t))},menuShouldPortal:!0})}),(0,d.jsx)(r.EditorField,{label:"With schema",children:(0,d.jsx)(u.Switch,{id:`${i.refId}-cloudwatch-sql-withSchema`,value:v,onChange:e=>e.target instanceof HTMLInputElement&&s(function(e,t){var n;const a=q((null!==(n=e.sql)&&void 0!==n?n:{}).from);if(t){const t={type:j.FunctionParameter,name:a};return k(e,{from:{type:j.Function,name:w.SCHEMA,parameters:[t]}})}return k(e,{from:{type:j.Property,property:{type:x.String,name:a}}})}(i,e.target.checked))})}),v&&(0,d.jsx)(r.EditorField,{label:"Schema labels",children:(0,d.jsx)(u.Select,{id:`${i.refId}-cloudwatch-sql-schema-label-keys`,width:"auto",isMulti:!0,disabled:!g,value:f?f.map(l.toOption):null,options:R,allowCustomValue:!0,onChange:e=>e&&s(function(e,t){var n,a,o;const r=null!==(n=e.sql)&&void 0!==n?n:{};if(t=Array.isArray(t)?t.map((e=>e.value)):[t.value],(null===(a=r.from)||void 0===a?void 0:a.type)===j.Function&&null!==(o=r.from.parameters)&&void 0!==o&&o.length){var i,s;const n=(null!==(i=t)&&void 0!==i?i:[]).map((e=>({type:j.FunctionParameter,name:e}))),a=(null!==(s=r.from.parameters)&&void 0!==s?s:[])[0];return k(e,{from:{type:j.Function,name:w.SCHEMA,parameters:[a,...n]}})}return e}(i,e)),menuShouldPortal:!0})})]}),(0,d.jsxs)(r.EditorFieldGroup,{children:[(0,d.jsx)(r.EditorField,{label:"Metric name",width:16,children:(0,d.jsx)(u.Select,{"aria-label":"Metric name",value:h?(0,l.toOption)(h):null,options:C,allowCustomValue:!0,onChange:e=>{let{value:t}=e;return t&&s(function(e,t){var n,a;const o={type:j.FunctionParameter,name:t};return k(e,{select:Object.assign({type:j.Function},null!==(n=null===(a=e.sql)||void 0===a?void 0:a.select)&&void 0!==n?n:{},{parameters:[o]})})}(i,t))},menuShouldPortal:!0})}),(0,d.jsx)(r.EditorField,{label:"Aggregation",width:16,children:(0,d.jsx)(u.Select,{"aria-label":"Aggregation",value:m?(0,l.toOption)(m):null,options:(0,c._)(a,_),onChange:e=>{let{value:t}=e;return t&&s(L(i,t))},menuShouldPortal:!0})})]})]})},G=w.COMPARISON_OPERATORS.map(l.toOption);function A(e,t){return function(n,a,o){return(0,d.jsx)(P,{datasource:e,query:t,filter:n,onChange:a,onDelete:o})}}const Q=e=>{let{query:t,onQueryChange:n,datasource:a}=e;const i=(0,o.useMemo)((()=>{var e;return R(null!==(e=t.sql)&&void 0!==e?e:{})}),[t.sql]),[s,l]=(0,o.useState)(i);return(0,d.jsx)(r.EditorList,{items:s,onChange:e=>{const a=e.map((e=>{var t,n;return{type:j.Operator,property:null!==(t=e.property)&&void 0!==t?t:{type:x.String},operator:null!==(n=e.operator)&&void 0!==n?n:{name:w.EQUALS}}}));l(a);const o=[];for(const e of a){const t=O(e);t&&o.push(t)}const r=o.length?{type:j.And,expressions:o}:void 0;n(k(t,{where:r}))},renderItem:A(a,t)})},P=e=>{var t,n,a,o,i,p,m,h;const{datasource:g,query:f,filter:v,onChange:y,onDelete:b}=e,C=null!==(t=f.sql)&&void 0!==t?t:{},w=q(C.from),O=E(C.select),I=(0,S.$K)(g,f.region,w,O),[R,M]=(0,s.Z)((async()=>{var e;return null!==(e=v.property)&&void 0!==e&&e.name?g.getDimensionValues(f.region,w,O,v.property.name,{}).then((e=>(0,c._)(g,e))):[]}),[f.region,w,O,null===(n=v.property)||void 0===n?void 0:n.name]);return(0,d.jsxs)(r.InputGroup,{children:[(0,d.jsx)(u.Select,{width:"auto",value:null!==(a=v.property)&&void 0!==a&&a.name?(0,l.toOption)(null===(o=v.property)||void 0===o?void 0:o.name):null,options:I,allowCustomValue:!0,onChange:e=>{let{value:t}=e;return t&&y((n=v,a=t,{type:j.Operator,property:{type:x.String,name:a},operator:null!==(o=n.operator)&&void 0!==o?o:{}}));var n,a,o},menuShouldPortal:!0}),(0,d.jsx)(u.Select,{width:"auto",value:(null===(i=v.operator)||void 0===i?void 0:i.name)&&(0,l.toOption)(v.operator.name),options:G,onChange:e=>{let{value:t}=e;return t&&y((n=v,a=t,{type:j.Operator,property:null!==(o=n.property)&&void 0!==o?o:{type:x.String},operator:Object.assign({},n.operator,{name:a})}));var n,a,o},menuShouldPortal:!0}),(0,d.jsx)(u.Select,{width:"auto",isLoading:R.loading,value:null!==(p=v.operator)&&void 0!==p&&p.value&&"string"==typeof(null===(m=v.operator)||void 0===m?void 0:m.value)?(0,l.toOption)(null===(h=v.operator)||void 0===h?void 0:h.value):null,options:R.value,allowCustomValue:!0,onOpenMenu:M,onChange:e=>{let{value:t}=e;return t&&y(function(e,t){var n;return{type:j.Operator,property:null!==(n=e.property)&&void 0!==n?n:{type:x.String},operator:Object.assign({},e.operator,{value:t})}}(v,t))},menuShouldPortal:!0}),(0,d.jsx)(r.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:b})]})};function T(e){return function(t,n,a){return(0,d.jsx)(D,{options:e,item:t,onChange:n,onDelete:a})}}const D=e=>{var t;const{options:n,item:a,onChange:o,onDelete:i}=e,s=null===(t=a.property)||void 0===t?void 0:t.name;return(0,d.jsxs)(r.InputGroup,{children:[(0,d.jsx)(u.Select,{"aria-label":`Group by ${null!=s?s:"filter key"}`,width:"auto",value:s?(0,l.toOption)(s):null,options:n,allowCustomValue:!0,onChange:e=>{let{value:t}=e;return t&&o((n=t,{type:j.GroupBy,property:{type:x.String,name:n}}));var n},menuShouldPortal:!0}),(0,d.jsx)(r.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:i})]})},N=e=>{var t;let{query:n,datasource:a,onQueryChange:i}=e;const s=null!==(t=n.sql)&&void 0!==t?t:{},l=(0,o.useMemo)((()=>{var e;return M(null!==(e=n.sql)&&void 0!==e?e:{})}),[n.sql]),[u,c]=(0,o.useState)(l),p=q(s.from),m=E(s.select),h=(0,S.$K)(a,n.region,p,m),g=(0,o.useMemo)((()=>h.filter((e=>!l.some((t=>t.property.name===e.value))))),[h,l]);return(0,d.jsx)(r.EditorList,{items:u,onChange:e=>{const t=e.map((e=>{var t;return{type:j.GroupBy,property:{type:x.String,name:null===(t=e.property)||void 0===t?void 0:t.name}}}));c(t);const a=t.filter((e=>{var t;return null===(t=e.property)||void 0===t?void 0:t.name})),o=a.length?{type:j.And,expressions:a}:void 0;i(k(n,{groupBy:o}))},renderItem:T(g)})},$=[{label:w.ASC,value:w.ASC},{label:w.DESC,value:w.DESC}],B=e=>{var t,n;let{query:a,onQueryChange:o,datasource:i}=e;const s=null!==(t=a.sql)&&void 0!==t?t:{},p=null===(n=s.orderBy)||void 0===n?void 0:n.name,m=s.orderByDirection;return(0,d.jsxs)(r.EditorFieldGroup,{children:[(0,d.jsx)(r.EditorField,{label:"Order by",optional:!0,width:16,children:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u.Select,{"aria-label":"Order by",onChange:e=>{let{value:t}=e;return t&&o(function(e,t){return k(e,{orderBy:{type:j.Function,name:t}})}(a,t))},options:(0,c._)(i,w.STATISTICS.map(l.toOption)),value:p?(0,l.toOption)(p):null,menuShouldPortal:!0}),p&&(0,d.jsx)(r.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>o(k(a,{orderBy:void 0}))})]})}),(0,d.jsx)(r.EditorField,{label:"Direction",width:16,children:(0,d.jsx)(u.Select,{"aria-label":"Direction",inputId:"cloudwatch-sql-order-by-direction",disabled:!p,value:m?(0,l.toOption)(m):$[0],options:(0,c._)(i,$),onChange:e=>e&&o(k(a,{orderByDirection:e.value})),menuShouldPortal:!0})})]})};function z(e){var t;let{query:n,datasource:a,onChange:i,onRunQuery:s}=e;const l=null!==(t=n.sql)&&void 0!==t?t:{},c=(0,o.useCallback)((e=>{var t;const n=(new C).expressionToSqlQuery(null!==(t=e.sql)&&void 0!==t?t:{}),a=Object.assign({},e,{sqlExpression:n});i(a),s()}),[i,s]),[p,m]=(0,o.useState)();return(0,o.useEffect)((()=>{var e;const t=(new C).expressionToSqlQuery(null!==(e=n.sql)&&void 0!==e?e:{});p!==t&&m(t)}),[n,p,m]),(0,d.jsxs)(r.EditorRows,{children:[(0,d.jsx)(r.EditorRow,{children:(0,d.jsx)(F,{query:n,onQueryChange:c,datasource:a})}),(0,d.jsx)(r.EditorRow,{children:(0,d.jsx)(r.EditorField,{label:"Filter",optional:!0,children:(0,d.jsx)(Q,{query:n,onQueryChange:c,datasource:a})})}),(0,d.jsxs)(r.EditorRow,{children:[(0,d.jsx)(r.EditorField,{label:"Group by",optional:!0,children:(0,d.jsx)(N,{query:n,onQueryChange:c,datasource:a})}),(0,d.jsx)(B,{query:n,onQueryChange:c,datasource:a}),(0,d.jsx)(r.EditorField,{label:"Limit",optional:!0,children:(0,d.jsx)(u.Input,{id:`${n.refId}-cloudwatch-sql-builder-editor-limit`,value:l.limit,onChange:e=>{const t=e.currentTarget.valueAsNumber;c(k(n,{limit:isNaN(t)?void 0:t}))},type:"number",min:1})})]}),p&&(0,d.jsxs)(r.EditorRow,{children:[!1,(0,d.jsx)("pre",{children:null!=p?p:""})]})]})}const V={id:"cloudwatch-MetricMath",extensions:[],aliases:[],mimetypes:[],loader:()=>n.e(2786).then(n.bind(n,"./public/app/plugins/datasource/cloudwatch/metric-math/language.ts"))};var W=n("./public/app/plugins/datasource/cloudwatch/monarch/commands.ts");const H=(e,t,n)=>{const{id:a,loader:o}=t;e.languages.getLanguages().find((e=>e.id===a))||(e.languages.register({id:a}),o().then((o=>{e.languages.setMonarchTokensProvider(a,o.language),e.languages.setLanguageConfiguration(a,o.conf),e.languages.registerCompletionItemProvider(a,n.getCompletionProvider(e,t))})))};function K(e){let{expression:t,onChange:n,onRunQuery:a,datasource:r}=e;const i=(0,o.useRef)(null),s=(0,o.useCallback)(((e,t)=>{e.onDidFocusEditorText((()=>e.trigger(W.w.id,W.w.id,{}))),e.addCommand(t.KeyMod.Shift|t.KeyCode.Enter,(()=>{const t=e.getValue();n(t),a()}));const o=()=>{const t=i.current;if(null!==t&&e.getContentHeight()<200){const n=e.getContentHeight();t.style.height=`${n}px`,t.style.width="100%";const a=t.clientWidth;e.layout({width:a,height:n})}};e.onDidContentSizeChange(o),o()}),[n,a]);return(0,d.jsx)("div",{ref:i,children:(0,d.jsx)(u.CodeEditor,{monacoOptions:{scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"off",renderLineHighlight:"none",scrollbar:{vertical:"hidden",horizontal:"hidden"},suggestFontSize:12,wordWrap:"on"},language:V.id,value:t,onBlur:e=>{e!==t&&(n(e),a())},onBeforeEditorMount:e=>H(e,V,r.metricMathCompletionItemProvider),onEditorDidMount:s})})}const U={id:"cloudwatch-sql",extensions:[".cloudwatchSql"],aliases:["CloudWatch","cloudwatch","CloudWatchSQL"],mimetypes:[],loader:()=>Promise.resolve().then(n.bind(n,"./public/app/plugins/datasource/cloudwatch/cloudwatch-sql/language.ts"))},Z=e=>{let{region:t,sql:n,onChange:a,onRunQuery:r,datasource:i}=e;(0,o.useEffect)((()=>{i.sqlCompletionItemProvider.setRegion(t)}),[t,i]);const s=(0,o.useCallback)(((e,t)=>{e.onDidFocusEditorText((()=>e.trigger(W.w.id,W.w.id,{}))),e.addCommand(t.KeyMod.Shift|t.KeyCode.Enter,(()=>{const t=e.getValue();a(t),r()}))}),[a,r]);return(0,d.jsx)(u.CodeEditor,{height:"150px",language:U.id,value:n,onBlur:e=>{e!==n&&a(e)},showMiniMap:!1,showLineNumbers:!0,onBeforeEditorMount:e=>H(e,U,i.sqlCompletionItemProvider),onEditorDidMount:s})}},"./public/app/plugins/datasource/cloudwatch/hooks.ts":(e,t,n)=>{"use strict";n.d(t,{$K:()=>m,Bf:()=>p,JR:()=>d,eH:()=>c});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");const o=function(e,t,n){var o=(0,a.useRef)(void 0);o.current&&n(t,o.current)||(o.current=t),(0,a.useEffect)(e,o.current)};var r=n("./.yarn/cache/fast-deep-equal-npm-3.1.3-790edcfcf5-e21a9d8d84.zip/node_modules/fast-deep-equal/react.js");const i=n.n(r)();const s=function(e,t){o(e,t,i)};var l=n("./packages/grafana-data/src/index.ts"),u=n("./public/app/plugins/datasource/cloudwatch/utils/utils.ts");const c=e=>{const[t,n]=(0,a.useState)(!1),[o,r]=(0,a.useState)([{label:"default",value:"default"}]);return(0,a.useEffect)((()=>{n(!0);const t={label:"Template Variables",options:e.getVariables().map(l.toOption)};e.getRegions().then((e=>r([...e,t]))).finally((()=>n(!1)))}),[e]),[o,t]},d=e=>{const[t,n]=(0,a.useState)([]);return(0,a.useEffect)((()=>{e.getNamespaces().then((t=>{n((0,u._)(e,t))}))}),[e]),t},p=(e,t,n)=>{const[o,r]=(0,a.useState)([]);return(0,a.useEffect)((()=>{e.getMetrics(n,t).then((t=>{r((0,u._)(e,t))}))}),[e,t,n]),o},m=(e,t,n,o,r)=>{const[i,l]=(0,a.useState)([]);return s((()=>{e.getDimensionKeys(n,t,r,o).then((t=>{l((0,u._)(e,t))}))}),[e,t,n,o,r]),i}},"./public/app/plugins/datasource/cloudwatch/monarch/commands.ts":(e,t,n)=>{"use strict";n.d(t,{w:()=>a});const a={id:"editor.action.triggerSuggest",title:""}},"./public/app/plugins/datasource/cloudwatch/syntax.ts":(e,t,n)=>{"use strict";n.d(t,{Ak:()=>d,Bn:()=>r,Ie:()=>s,OV:()=>o,QZ:()=>u,ZP:()=>m,aH:()=>l,ae:()=>i,lD:()=>a});const a=[{label:"fields",documentation:"Retrieves the specified fields from log events"},{label:"display",documentation:"Specifies which fields to display in the query results"},{label:"filter",documentation:"Filters the results of a query based on one or more conditions"},{label:"stats",documentation:"Calculates aggregate statistics based on the values of log fields"},{label:"sort",documentation:"Sorts the retrieved log events"},{label:"limit",documentation:"Specifies the number of log events returned by the query"},{label:"parse",documentation:"Extracts data from a log field, creating one or more ephemeral fields that you can process further in the query"}],o=[{label:"abs",detail:"abs(a)",documentation:"Absolute value."},{label:"ceil",detail:"ceil(a)",documentation:"Round to ceiling (the smallest integer that is greater than the value of a)."},{label:"floor",detail:"floor(a)",documentation:"Round to floor (the largest integer that is smaller than the value of a)."},{label:"greatest",detail:"greatest(a,b, ... z)",documentation:"Returns the largest value."},{label:"least",detail:"least(a, b, ... z)",documentation:"Returns the smallest value."},{label:"log",detail:"log(a)",documentation:"Natural logarithm."},{label:"sqrt",detail:"sqrt(a)",documentation:"Square root."}],r=[{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"concat",detail:"concat(string1, string2, ... stringz)",documentation:"Concatenates the strings."},{label:"ltrim",detail:"ltrim(string) or ltrim(string1, string2)",documentation:"Remove white space from the left of the string. If the function has a second string argument, it removes the characters of string2 from the left of string1."},{label:"rtrim",detail:"rtrim(string) or rtrim(string1, string2)",documentation:"Remove white space from the right of the string. If the function has a second string argument, it removes the characters of string2 from the right of string1."},{label:"trim",detail:"trim(string) or trim(string1, string2)",documentation:"Remove white space from both ends of the string. If the function has a second string argument, it removes the characters of string2 from both sides of string1."},{label:"strlen",detail:"strlen(string)",documentation:"Returns the length of the string in Unicode code points."},{label:"toupper",detail:"toupper(string)",documentation:"Converts the string to uppercase."},{label:"tolower",detail:"tolower(string)",documentation:"Converts the string to lowercase."},{label:"substr",detail:"substr(string1, x), or substr(string1, x, y)",documentation:"Returns a substring from the index specified by the number argument to the end of the string. If the function has a second number argument, it contains the length of the substring to be retrieved."},{label:"replace",detail:"replace(string1, string2, string3)",documentation:"Replaces all instances of string2 in string1 with string3."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."}],i=[{label:"bin",detail:"bin(period)",documentation:"Rounds the value of @timestamp to the given period and then truncates."},{label:"datefloor",detail:"datefloor(a, period)",documentation:"Truncates the timestamp to the given period."},{label:"dateceil",detail:"dateceil(a, period)",documentation:"Rounds up the timestamp to the given period and then truncates."},{label:"fromMillis",detail:"fromMillis(fieldname)",documentation:"Interprets the input field as the number of milliseconds since the Unix epoch and converts it to a timestamp."},{label:"toMillis",detail:"toMillis(fieldname)",documentation:"Converts the timestamp found in the named field into a number representing the milliseconds since the Unix epoch."}],s=[{label:"isValidIp",detail:"isValidIp(fieldname)",documentation:"Returns true if the field is a valid v4 or v6 IP address."},{label:"isValidIpV4",detail:"isValidIpV4(fieldname)",documentation:"Returns true if the field is a valid v4 IP address."},{label:"isValidIpV6",detail:"isValidIpV6(fieldname)",documentation:"Returns true if the field is a valid v6 IP address."},{label:"isIpInSubnet",detail:"isIpInSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 or v6 IP address within the specified v4 or v6 subnet."},{label:"isIpv4InSubnet",detail:"isIpv4InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 IP address within the specified v4 subnet."},{label:"isIpv6InSubnet",detail:"isIpv6InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v6 IP address within the specified v6 subnet."}],l=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."},...s],u=[{label:"avg",detail:"avg(NumericFieldname)",documentation:"The average of the values in the specified field."},{label:"count",detail:"count(fieldname) or count(*)",documentation:"Counts the log records."},{label:"count_distinct",detail:"count_distinct(fieldname)",documentation:"Returns the number of unique values for the field."},{label:"max",detail:"max(fieldname)",documentation:"The maximum of the values for this log field in the queried logs."},{label:"min",detail:"min(fieldname)",documentation:"The minimum of the values for this log field in the queried logs."},{label:"pct",detail:"pct(fieldname, value)",documentation:"A percentile indicates the relative standing of a value in a datas."},{label:"stddev",detail:"stddev(NumericFieldname)",documentation:"The standard deviation of the values in the specified field."},{label:"sum",detail:"sum(NumericFieldname)",documentation:"The sum of the values in the specified field."}],c=[...u,{label:"earliest",detail:"earliest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the earliest time stamp in the queried logs."},{label:"latest",detail:"latest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the latest time stamp in the queried logs."},{label:"sortsFirst",detail:"sortsFirst(fieldname)",documentation:"Returns the value of fieldName that sorts first in the queried logs."},{label:"sortsLast",detail:"sortsLast(fieldname)",documentation:"Returns the value of fieldName that sorts last in the queried logs."}],d=[...o,{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"coalesce",detail:"coalesce(fieldname1, fieldname2, ... fieldnamex)",documentation:"Returns the first non-null value from the list."},...r,...i,...s],p=[...d,...c],m={comment:{pattern:/^#.*/,greedy:!0},backticks:{pattern:/`.*?`/,alias:"string",greedy:!0},quote:{pattern:/".*?"/,alias:"string",greedy:!0},regex:{pattern:/\/.*?\/(?=\||\s*$|,)/,greedy:!0},"query-command":{pattern:new RegExp(`\\b(?:${a.map((e=>e.label)).join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${p.map((e=>e.label)).join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${["as","like","by","in","desc","asc"].join("|")})(?=\\s+)`,"i"),lookbehind:!0},"field-name":{pattern:/(@?[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,"command-separator":{pattern:/\|/,alias:"punctuation"},"comparison-operator":{pattern:/([<>]=?)|(!?=)/},punctuation:/[{}()`,.]/,whitespace:/\s+/}},"./public/app/plugins/datasource/cloudwatch/utils/utils.ts":(e,t,n)=>{"use strict";n.d(t,{E:()=>a,_:()=>o});const a=e=>({label:e,value:e}),o=(e,t)=>[...t,{label:"Template Variables",options:e.getVariables().map(a)}]},"./.yarn/cache/fast-deep-equal-npm-3.1.3-790edcfcf5-e21a9d8d84.zip/node_modules/fast-deep-equal/react.js":e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var a,o,r;if(Array.isArray(t)){if((a=t.length)!=n.length)return!1;for(o=a;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((a=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=a;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,r[o]))return!1;for(o=a;0!=o--;){var i=r[o];if(("_owner"!==i||!t.$$typeof)&&!e(t[i],n[i]))return!1}return!0}return t!=t&&n!=n}},"./.yarn/cache/jsurl-npm-0.1.5-9e17f93783-50b614908d.zip/node_modules/jsurl/index.js":(e,t,n)=>{e.exports=n("./.yarn/cache/jsurl-npm-0.1.5-9e17f93783-50b614908d.zip/node_modules/jsurl/lib/jsurl.js")},"./.yarn/cache/jsurl-npm-0.1.5-9e17f93783-50b614908d.zip/node_modules/jsurl/lib/jsurl.js":(e,t)=>{!function(e){"use strict";e.stringify=function e(t){function n(e){return/[^\w-.]/.test(e)?e.replace(/[^\w-.]/g,(function(e){return"$"===e?"!":(e=e.charCodeAt(0))<256?"*"+("00"+e.toString(16)).slice(-2):"**"+("0000"+e.toString(16)).slice(-4)})):e}var a;switch(typeof t){case"number":return isFinite(t)?"~"+t:"~null";case"boolean":return"~"+t;case"string":return"~'"+n(t);case"object":if(!t)return"~null";if(a=[],Array.isArray(t)){for(var o=0;o<t.length;o++)a[o]=e(t[o])||"~null";return"~("+(a.join("")||"~")+")"}for(var r in t)if(t.hasOwnProperty(r)){var i=e(t[r]);i&&a.push(n(r)+i)}return"~("+a.join("~")+")";default:return}};var t={true:!0,false:!1,null:null};e.parse=function(e){if(!e)return e;e=e.replace(/%(25)*27/g,"'");var n=0,a=e.length;function o(t){if(e.charAt(n)!==t)throw new Error("bad JSURL syntax: expected "+t+", got "+(e&&e.charAt(n)));n++}function r(){for(var t,o=n,r="";n<a&&"~"!==(t=e.charAt(n))&&")"!==t;)switch(t){case"*":o<n&&(r+=e.substring(o,n)),"*"===e.charAt(n+1)?(r+=String.fromCharCode(parseInt(e.substring(n+2,n+6),16)),o=n+=6):(r+=String.fromCharCode(parseInt(e.substring(n+1,n+3),16)),o=n+=3);break;case"!":o<n&&(r+=e.substring(o,n)),r+="$",o=++n;break;default:n++}return r+e.substring(o,n)}return function i(){var s,l,u;switch(o("~"),l=e.charAt(n)){case"(":if(n++,"~"===e.charAt(n))if(s=[],")"===e.charAt(n+1))n++;else do{s.push(i())}while("~"===e.charAt(n));else if(s={},")"!==e.charAt(n))do{s[r()]=i()}while("~"===e.charAt(n)&&++n);o(")");break;case"'":n++,s=r();break;default:for(u=n++;n<a&&/[^)~]/.test(e.charAt(n));)n++;var c=e.substring(u,n);if(/[\d\-]/.test(l))s=parseFloat(c);else if(void 0===(s=t[c]))throw new Error("bad value keyword: "+c)}return s}()},e.tryParse=function(t,n){try{return e.parse(t)}catch(e){return n}}}(t)}}]);
//# sourceMappingURL=6743.a87fd0ce1ff28bec28a3.js.map